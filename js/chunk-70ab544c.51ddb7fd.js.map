{"version":3,"sources":["webpack:///./node_modules/ol-ext/control/LayerSwitcher.js","webpack:///./node_modules/ol/CollectionEventType.js","webpack:///./node_modules/ol/Kinetic.js","webpack:///./node_modules/ol/Feature.js","webpack:///./node_modules/ol-ext/util/element.js","webpack:///./node_modules/ol/ImageTile.js","webpack:///./node_modules/ol/AssertionError.js","webpack:///./node_modules/ol/ImageState.js","webpack:///./node_modules/ol-ext/util/ext.js","webpack:///./node_modules/ol-ext/control/Toggle.js","webpack:///./node_modules/ol-ext/control/TextButton.js","webpack:///./node_modules/ol-ext/interaction/Delete.js","webpack:///./node_modules/ol-ext/geom/GeomUtils.js","webpack:///./node_modules/ol-ext/style/defaultStyle.js","webpack:///./node_modules/ol-ext/interaction/Offset.js","webpack:///./node_modules/ol-ext/geom/LineStringSplitAt.js","webpack:///./node_modules/ol-ext/interaction/Split.js","webpack:///./node_modules/ol-ext/interaction/Transform.js","webpack:///./node_modules/ol-ext/interaction/ModifyFeature.js","webpack:///./node_modules/ol-ext/interaction/DrawRegular.js","webpack:///./node_modules/ol-ext/interaction/DrawHole.js","webpack:///./node_modules/ol-ext/control/EditBar.js","webpack:///./node_modules/ol-ext/source/Vector.js","webpack:///./node_modules/ol-ext/interaction/UndoRedo.js","webpack:///./node_modules/ol/Disposable.js","webpack:///./node_modules/ol/Collection.js","webpack:///./node_modules/ol-ext/control/Button.js","webpack:///./node_modules/ol/ImageBase.js","webpack:///./node_modules/ol/ImageCanvas.js","webpack:///./node_modules/ol-ext/control/Bar.js"],"names":["ol_control_LayerSwitcher","options","element","self","this","dcount","show_progress","oninfo","onextent","hasextent","extent","hastrash","trash","reordering","_layers","_layerGroup","layerGroup","getLayers","displayInLayerSwitcher","target","create","className","switcherClass","collapsed","classList","add","button","type","parent","addEventListener","e","toggle","dispatchEvent","contains","preventDefault","overflow","mouseover","remove","topv","click","botv","panel_","addListener","Math","max","min","wheelDelta","detail","stopPropagation","header_","call","set","drawDelay","prototype","tip","up","down","info","plus","layer","get","setMap","map","drawPanel","_listener","change","moveend","size","on","viewChange","bind","getLayerGroup","show","hide","isOpen","setHeader","html","setHTML","dir","hidden","setStyle","height","h","outerHeight","hp","dh","offsetTop","top","lh","getStyle","querySelectorAll","round","_setLayerForLI","li","listeners","push","setLayerOpacity","setLayerVisibility","key","i","querySelector","style","left","getOpacity","checked","getVisible","_clearLayerForLI","forEach","l","_getLayerForLI","testLayerVisibility","getMap","setTimeout","drawPanel_","dragging_","drawList","switchLayerVisibility","layers","setVisible","res","getView","getResolution","getMaxResolution","getMinResolution","ex0","getExtent","ex","calculateExtent","getSize","dragOrdering_","pageY","dragElt","group","elt","currentTarget","parentNode","start","panel","pageY0","touches","length","changedTouches","stop","drop","collection","getArray","removeAt","j","insertAt","removeListener","document","move","abs","innerHTML","position","offsetLeft","opacity","width","outerWidth","offsetRect","scrollTop","elementFromPoint","clientX","clientY","tagName","dragOpacity_","x","pageX","delta","nextElementSibling","setOpacity","ul","setVisibility","onInfo","zoomExtent","fit","removeLayer","getLength","layer_buttons","d","title","unselectable","userSelect","nb","p","setprogress_","layerswitcher_progress","op","offsetX","ul2","loaded","loading","draw","toFixed","getSource","ADD","REMOVE","Kinetic","decay","minVelocity","delay","decay_","minVelocity_","delay_","points_","angle_","initialVelocity_","begin","update","y","Date","now","end","lastIndex","firstIndex","duration","dx","dy","atan2","sqrt","getDistance","getAngle","Feature","BaseObject","opt_geometryOrProperties","id_","undefined","geometryName_","style_","styleFunction_","geometryChangeKey_","handleGeometryChanged_","getSimplifiedGeometry","geometry","setGeometry","properties","setProperties","__proto__","Object","constructor","clone","getProperties","setGeometryName","getGeometryName","getGeometry","getId","getStyleFunction","handleGeometryChange_","changed","CHANGE","createStyleFunction","setId","id","name","obj","styles","Array","isArray","getZIndex","ol_ext_element","createTextNode","appendChild","attr","createElement","test","setAttribute","trim","Element","label","input","after","value","val","text","eventType","fn","useCapture","split","removeEventListener","display","el","st","s","styleProp","defaultView","ownerDocument","getComputedStyle","replace","toLowerCase","getPropertyValue","currentStyle","str","letter","toUpperCase","oldLeft","oldRsLeft","runtimeStyle","pixelLeft","parseInt","offsetHeight","offsetWidth","rect","getBoundingClientRect","window","pageYOffset","documentElement","body","pageXOffset","scrollLeft","bottom","right","pos","speed","dt","onmove","page","vertical","scroll","moving","ondragstart","animate","to","step","mousewheel","eventName","event","CustomEvent","createEvent","initCustomEvent","ImageTile","Tile","tileCoord","state","src","crossOrigin","tileLoadFunction","opt_options","crossOrigin_","src_","image_","Image","imageListenerKeys_","tileLoadFunction_","disposeInternal","LOADING","unlistenImage_","getBlankImage","interimTile","dispose","ABORT","getImage","getKey","handleImageError_","ERROR","handleImageLoad_","image","naturalWidth","naturalHeight","LOADED","EMPTY","load","IDLE","LOAD","ctx","fillStyle","fillRect","canvas","AssertionError","Error","code","path","message","ol","ext","ol_ext_inherits","child","inherits","NodeList","removeChild","ol_control_Toggle","interaction_","interaction","setActive","active","getActive","toggleFn","onToggle","handleClick","autoActivate","bar","setSubBar","setDisable","disable","removeInteraction","subbar_","removeControl","addInteraction","addControl","getSubBar","setTarget","getDisable","disabled","b","oldValue","setInteraction","getInteraction","ol_control_TextButton","ol_interaction_Delete","getFeatures","clear","delete","selected","_getSources","sources","concat","features","delFeatures","source","f","removeFeature","ol_extent_intersection","ol_coordinate_dist2d","p1","p2","ol_coordinate_equal","ol_coordinate_offsetCoords","coords","offset","mi","mi1","li1","ri","ri1","si","si1","Xi1","Yi1","p0","N","isClosed","pop","ol_coordinate_findSegment","pt","index","segment","d0","v0","d1","v1","splitX","pts","splice","splitY","polygon","poly","getType","geom","getCoordinates","g","c","ol_coordinate_sampleAt","dl","sampleAt","result","mpoly","a","intersection","resolution","ol_extent","getCenter","getRadius","simplify","r","hasout","ring","console","warn","ol_style_Style_defaultStyle","white","blue","defaultEditStyle","stroke","color","radius","fill","edit","fillColor","ol_interaction_Offset","handleDownEvent","handleDownEvent_","handleDragEvent","handleDragEvent_","handleMoveEvent","handleMoveEvent_","handleUpEvent","handleUpEvent_","features_","layers_","duplicate","source_","_style","previousCursor_","getFeatureAtPixel_","forEachFeatureAtPixel","pixel","feature","current","typeGeom","getClosestPoint","coordinate","frameState","viewState","hit","coordinates","geomType","hitTolerance","current_","currentStyle_","originalEvent","ctrlKey","addFeature","_modifystart","seg","v2","getTargetElement","cursor","splitAt","tol","k","getFirstCoordinate","getLastCoordinate","c0","ci","d2","ol_interaction_Split","handleEvent","snapDistance_","snapDistance","tolerance_","tolerance","cursor_","sources_","filterSplit_","filter","sketchStyle","featureStyle","overlayLayer_","useSpatialIndex","_sketch_","getClosestFeature","fi","getClosestFeatureToCoordinate","gi","di","coord","getNearestCoord","getPixelFromCoordinate","link","dm","Number","MAX_VALUE","evt","tosplit","original","linkGeometry","ol_interaction_Transform","selection_","handles_","wrapX","_filter","_handleEvent","condition","addFn_","addCondition","translateFeature","translate","translateBBox","stretch","scale","rotate","keepAspectRatio","shiftKey","modifyCenter","metaKey","noFlip","selection","enableRotatedTransform","drawSketch_","setDefaultStyle","Cursors","oldMap","targetElement","select","isTouch","getViewport","pointStroke","strokedash","lineDash","fill0","pointFill","circle","points","getAnchor","bigpt","angle","PI","smallpt","createStyle","img","olstyle","im","setScale","tx","getText","setOffsetX","found","bbox_","handle","constraint","option","some","getGeometryRotateToZero_","origGeom","viewRotation","getRotation","rotGeom","center","item","extendExt","ispt_","center_","getCoordinateFromPixel","iscircle_","addFeatures","indexOf","watchFeatures_","setSelection","_featureListeners","isUpdating_","sel","mode_","opt_","constraint_","coordinate_","pixel_","geoms_","rotatedGeoms_","rotExtent","extent_","rotatedExtent_","rotate0","setCenter","pt0","ispt","setCenterAndRadius","deltaX","deltaY","extentCoordinates","downCoordinate","dragCoordinate","downPoint","dragPoint","scx","scy","centerPoint","applyTransform","g1","g2","dim","default","oldgeom","oldgeoms","ol_interaction_ModifyFeature","dragging","modifying","_deleteCondition","pixelTolerance","_condition","deleteCondition","_insertVertexCondition","insertVertexCondition","currentFeature","deselected","dist","lstring","getLineStrings","lring","getLinearRings","getPolygons","getGeometries","getArcs","arcs","coord1","coord2","node","shift","c1","nbpt","closed","typeg","error","getFeaturesInExtent","_modifiedFeatures","_removePoint","getModifiedFeatures","removePoint","_getModification","geoms","setGeometries","setCoordinates","setArcCoordinates","getCurrentFeature","ol_interaction_DrawRegular","squaredClickTolerance_","clickTolerance","maxCircleCoordinates_","maxCircleCoordinates","squareFn_","squareCondition","centeredFn_","centerCondition","canRotate_","canRotate","geometryName","setSides","sides","defaultStyle","sketch_","handleEvent_","reset","started_","sides_","getSides","startAngle","3","4","getGeom_","coord_","dmax","centerPx","square_","centered_","coordPx_","hasrotation","sc","sign","t","feature_","drawPoint_","noclear","_eventTime","downPx_","start_","_longTouch","lastEvent","end_","upPx_","finishDrawing","startCoordinate","square","centered","ol_interaction_DrawHole","_select","geometryFn","geomFn","geometryFunction","_geometryFn","_features","_startDrawing","_finishDrawing","removeLastPoint","_feature","getPolygon","_polygon","_current","intersectsCoordinate","_polygonIndex","layerFilter","hole","pi","newGeom","appendLinearRing","appendPolygon","lastOKCoord","ol_control_EditBar","interactions","toggleOne","_source","_interactions","_setSelectInteraction","edition","_setEditInteraction","_setModifyInteraction","Delete","ModifySelect","_getTitle","selectCtrl","sbar","del","slice","mapBrowserEvent","Info","Select","getControls","DrawPoint","pedit","DrawLine","nbpts","ledit","controls","UndoDraw","FinishDraw","DrawPolygon","_setDrawPolygon","DrawHole","DrawRegular","regular","div","textContent","ctrl","fedit","Transform","transform","Split","Offset","opt_fast","ol_interaction_UndoRedo","_undoStack","_redoStack","_undo","_redo","level","_level","view","zoom","getZoom","action","_reduce","_doShift","_doClear","_block","_record","_defs","define","undoFn","redoFn","undo","redo","setMaxLength","setMaxSize","getStack","prop","custom","_mapListener","blockStart","blockEnd","_watchSources","_watchInteractions","getVectorLayers","init","_sourceListener","vectors","_onAddRemove","_interactionListener","getInteractions","_onInteraction","setattributestart","newp","assign","oldp","newProperties","oldProperties","rotatestart","translatestart","scalestart","modifystart","m","oldGeom","beforesplit","deletestart","aftersplit","deleteend","_handleDo","unset","hasUndo","hasRedo","Disposable","disposed_","Property","LENGTH","CollectionEvent","Event","opt_element","Collection","opt_array","unique_","unique","array_","ii","assertUnique_","updateLength_","extend","arr","array","elem","n","prev","setAt","opt_except","ol_control_Button","bt","button_","evtFunction","firstElementChild","setTitle","setHtml","getButtonElement","EventTarget","ImageBase","pixelRatio","pixelRatio_","EventType","getPixelRatio","getState","ImageCanvas","opt_loader","ImageState","loader_","canvas_","error_","getError","handleLoad_","err","ol_control_Bar","classes","apply","autoDeactivate","controls_","setPosition","onActivateControl_","deactivateControls","except","getActiveControls","sb","ctrls","getControlsByName","control"],"mappings":"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","file":"js/chunk-70ab544c.51ddb7fd.js","sourcesContent":["/*\tCopyright (c) 2015 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\nimport ol_ext_inherits from '../util/ext'\r\nimport {unByKey as ol_Observable_unByKey} from 'ol/Observable'\r\nimport ol_control_Control from 'ol/control/Control'\r\nimport ol_layer_Tile from 'ol/layer/Tile'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_layer_VectorTile from 'ol/layer/VectorTile'\r\nimport ol_layer_Image from 'ol/layer/Image'\r\nimport ol_layer_Heatmap from 'ol/layer/Heatmap'\r\nimport {intersects as ol_extent_intersects} from 'ol/extent'\r\n\r\nimport ol_ext_element from '../util/element'\r\n\r\n/** Layer Switcher Control.\r\n * @fires drawlist\r\n * @fires toggle\r\n * @fires reorder-start\r\n * @fires reorder-end\r\n * @fires layer:visible\r\n * @fires layer:opacity\r\n * \r\n * @constructor\r\n * @extends {ol_control_Control}\r\n * @param {Object=} options\r\n *  @param {function} options.displayInLayerSwitcher function that takes a layer and return a boolean if the layer is displayed in the switcher, default test the displayInLayerSwitcher layer attribute\r\n *  @param {boolean} options.show_progress show a progress bar on tile layers, default false\r\n *  @param {boolean} options.mouseover show the panel on mouseover, default false\r\n *  @param {boolean} options.reordering allow layer reordering, default true\r\n *  @param {boolean} options.trash add a trash button to delete the layer, default false\r\n *  @param {function} options.oninfo callback on click on info button, if none no info button is shown DEPRECATED: use on(info) instead\r\n *  @param {boolean} options.extent add an extent button to zoom to the extent of the layer\r\n *  @param {function} options.onextent callback when click on extent, default fits view to extent\r\n *  @param {number} options.drawDelay delay in ms to redraw the layer (usefull to prevent flickering when manipulating the layers)\r\n *  @param {boolean} options.collapsed collapse the layerswitcher at beginning, default true\r\n *  @param {ol.layer.Group} options.layerGroup a layer group to display in the switcher, default display all layers of the map\r\n *\r\n * Layers attributes that control the switcher\r\n *\t- allwaysOnTop {boolean} true to force layer stay on top of the others while reordering, default false\r\n *\t- displayInLayerSwitcher {boolean} display the layer in switcher, default true\r\n *\t- noSwitcherDelete {boolean} to prevent layer deletion (w. trash option = true), default false\r\n */\r\nvar ol_control_LayerSwitcher = function(options) {\r\n  options = options || {};\r\n  var self = this;\r\n  this.dcount = 0;\r\n  this.show_progress = options.show_progress;\r\n  this.oninfo = (typeof (options.oninfo) == \"function\" ? options.oninfo: null);\r\n  this.onextent = (typeof (options.onextent) == \"function\" ? options.onextent: null);\r\n  this.hasextent = options.extent || options.onextent;\r\n  this.hastrash = options.trash;\r\n  this.reordering = (options.reordering!==false);\r\n  this._layers = [];\r\n  this._layerGroup = (options.layerGroup && options.layerGroup.getLayers) ? options.layerGroup : null;\r\n\r\n  // displayInLayerSwitcher\r\n  if (typeof(options.displayInLayerSwitcher) === 'function') {\r\n    this.displayInLayerSwitcher = options.displayInLayerSwitcher;\r\n  }\r\n\r\n  var element;\r\n  if (options.target) {\r\n    element = ol_ext_element.create('DIV', {\r\n      className: options.switcherClass || \"ol-layerswitcher\"\r\n    });\r\n  } else {\r\n    element = ol_ext_element.create('DIV', {\r\n      className: (options.switcherClass || \"ol-layerswitcher\") +' ol-unselectable ol-control'\r\n    });\r\n    if (options.collapsed !== false) element.classList.add('ol-collapsed'); \r\n    else element.classList.add('ol-forceopen'); \r\n  \r\n    this.button = ol_ext_element.create('BUTTON', {\r\n      type: 'button',\r\n      parent: element\r\n    });\r\n    this.button.addEventListener('touchstart', function(e){\r\n      element.classList.toggle('ol-collapsed');\r\n      self.dispatchEvent({ type: 'toggle', collapsed: element.classList.contains('ol-collapsed') });\r\n      e.preventDefault(); \r\n      self.overflow();\r\n    });\r\n    this.button.addEventListener('click', function(){\r\n      element.classList.toggle('ol-forceopen');\r\n      element.classList.add('ol-collapsed'); \r\n      self.dispatchEvent({ type: 'toggle', collapsed: !element.classList.contains('ol-forceopen') });\r\n      self.overflow();\r\n    });\r\n\r\n    if (options.mouseover) {\r\n      element.addEventListener ('mouseleave', function(){ \r\n        element.classList.add(\"ol-collapsed\"); \r\n        self.dispatchEvent({ type: 'toggle', collapsed: true });\r\n      });\r\n      element.addEventListener ('mouseover', function(){ \r\n        element.classList.remove(\"ol-collapsed\"); \r\n        self.dispatchEvent({ type: 'toggle', collapsed: false });\r\n      });\r\n    }\r\n\r\n    this.topv = ol_ext_element.create('DIV', {\r\n      className: 'ol-switchertopdiv',\r\n      parent: element,\r\n      click: function() {\r\n        self.overflow(\"+50%\");\r\n      }\r\n    });\r\n\r\n    this.botv = ol_ext_element.create('DIV', {\r\n      className: 'ol-switcherbottomdiv',\r\n      parent: element,\r\n      click: function() {\r\n        self.overflow(\"-50%\");\r\n      }\r\n    });\r\n  }\r\n\r\n  this.panel_ = ol_ext_element.create ('UL', {\r\n    className: 'panel',\r\n    parent: element\r\n  });\r\n  ol_ext_element.addListener (this.panel_, 'mousewheel DOMMouseScroll onmousewheel', function(e) {\r\n    if (self.overflow(Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail))))) {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    }\r\n  });\r\n\r\n  this.header_ = ol_ext_element.create('LI', {\r\n    className: 'ol-header',\r\n    parent: this.panel_\r\n  });\r\n\r\n  ol_control_Control.call (this, {\r\n    element: element,\r\n    target: options.target\r\n  });\r\n\r\n  this.set('drawDelay',options.drawDelay||0);\r\n};\r\nol_ext_inherits(ol_control_LayerSwitcher, ol_control_Control);\r\n\r\n/** List of tips for internationalization purposes\r\n*/\r\nol_control_LayerSwitcher.prototype.tip = {\r\n  up: \"up/down\",\r\n  down: \"down\",\r\n  info: \"informations...\",\r\n  extent: \"zoom to extent\",\r\n  trash: \"remove layer\",\r\n  plus: \"expand/shrink\"\r\n};\r\n\r\n/** Test if a layer should be displayed in the switcher\r\n * @param {ol.layer} layer\r\n * @return {boolean} true if the layer is displayed\r\n */\r\nol_control_LayerSwitcher.prototype.displayInLayerSwitcher = function(layer) {\r\n  return (layer.get('displayInLayerSwitcher')!==false);\r\n};\r\n\r\n/**\r\n * Set the map instance the control is associated with.\r\n * @param {_ol_Map_} map The map instance.\r\n */\r\nol_control_LayerSwitcher.prototype.setMap = function(map) {\r\n  ol_control_Control.prototype.setMap.call(this, map);\r\n  this.drawPanel();\r\n  \r\n  if (this._listener) {\r\n    if (this._listener) ol_Observable_unByKey(this._listener.change);\r\n    if (this._listener) ol_Observable_unByKey(this._listener.moveend);\r\n    if (this._listener) ol_Observable_unByKey(this._listener.size);\r\n  }\r\n  this._listener = null;\r\n\r\n  // Get change (new layer added or removed)\r\n  if (map) {\r\n    this._listener = {\r\n      moveend: map.on('moveend', this.viewChange.bind(this)),\r\n      size: map.on('change:size', this.overflow.bind(this))\r\n    }\r\n    // Listen to a layer group\r\n    if (this._layerGroup) {\r\n      this._listener.change = this._layerGroup.getLayers().on('change:length', this.drawPanel.bind(this));\r\n    } else  {\r\n      //Listen to all layers\r\n      this._listener.change = map.getLayerGroup().getLayers().on('change:length', this.drawPanel.bind(this));\r\n    }\r\n  }\r\n};\r\n\r\n/** Show control\r\n */\r\nol_control_LayerSwitcher.prototype.show = function() {\r\n  this.element.classList.add(\"ol-forceopen\");\r\n  this.overflow();\r\n};\r\n\r\n/** Hide control\r\n */\r\nol_control_LayerSwitcher.prototype.hide = function() {\r\n  this.element.classList.remove(\"ol-forceopen\");\r\n  this.overflow();\r\n};\r\n\r\n/** Toggle control\r\n */\r\nol_control_LayerSwitcher.prototype.toggle = function() {\r\n  this.element.classList.toggle(\"ol-forceopen\");\r\n  this.overflow();\r\n};\r\n\r\n/** Is control open\r\n * @return {boolean}\r\n */\r\nol_control_LayerSwitcher.prototype.isOpen = function() {\r\n  return this.element.classList.contains(\"ol-forceopen\");\r\n};\r\n\r\n/** Add a custom header\r\n * @param {Element|string} html content html\r\n */\r\nol_control_LayerSwitcher.prototype.setHeader = function(html) {\r\n  ol_ext_element.setHTML(this.header_, html);\r\n};\r\n\r\n/** Calculate overflow and add scrolls\r\n *\t@param {Number} dir scroll direction -1|0|1|'+50%'|'-50%'\r\n */\r\nol_control_LayerSwitcher.prototype.overflow = function(dir) {\t\r\n  if (this.button) {\r\n    // Nothing to show\r\n    if (ol_ext_element.hidden(this.panel_)) {\r\n      ol_ext_element.setStyle(this.element, { height: 'auto' });\r\n      return;\r\n    }\r\n    // Calculate offset\r\n    var h = ol_ext_element.outerHeight(this.element);\r\n    var hp = ol_ext_element.outerHeight(this.panel_);\r\n    var dh = this.button.offsetTop + ol_ext_element.outerHeight(this.button);\r\n    //var dh = this.button.position().top + this.button.outerHeight(true);\r\n\r\n    var top = this.panel_.offsetTop - dh;\r\n    if (hp > h-dh) {\r\n      // Bug IE: need to have an height defined\r\n      ol_ext_element.setStyle(this.element, { height: '100%' });\r\n      var lh = 2 * ol_ext_element.getStyle(this.panel_.querySelectorAll('li.visible .li-content')[0], 'height');\r\n      switch (dir) {\r\n        case 1: top += lh; break;\r\n        case -1: top -= lh; break;\r\n        case \"+50%\": top += Math.round(h/2); break;\r\n        case \"-50%\": top -= Math.round(h/2); break;\r\n        default: break;\r\n      }\r\n      // Scroll div\r\n      if (top+hp <= h-3*dh/2) {\r\n        top = h-3*dh/2-hp;\r\n        ol_ext_element.hide(this.botv);\r\n      } else {\r\n        ol_ext_element.show(this.botv);\r\n      }\r\n      if (top >= 0) {\r\n        top = 0;\r\n        ol_ext_element.hide(this.topv);\r\n      } else {\r\n        ol_ext_element.show(this.topv);\r\n      }\r\n      // Scroll ?\r\n      ol_ext_element.setStyle(this.panel_, { top: top+\"px\" });\r\n      return true;\r\n    } else {\r\n      ol_ext_element.setStyle(this.element, { height: \"auto\" });\r\n      ol_ext_element.setStyle(this.panel_, { top: 0 });\r\n      ol_ext_element.hide(this.botv);\r\n      ol_ext_element.hide(this.topv);\r\n      return false;\r\n    }\r\n  }\r\n  else return false;\r\n};\r\n\r\n/** Set the layer associated with a li\r\n * @param {Element} li\r\n * @param {ol.layer} layer\r\n */\r\nol_control_LayerSwitcher.prototype._setLayerForLI = function(li, layer) {\r\n  var listeners = [];\r\n  if (layer.getLayers) {\r\n    listeners.push(layer.getLayers().on('change:length', this.drawPanel.bind(this)));\r\n  }\r\n  if (li) {\r\n    // Handle opacity change\r\n    listeners.push(layer.on('change:opacity', (function() {\r\n      this.setLayerOpacity(layer, li);\r\n    }).bind(this)));\r\n    // Handle visibility chage\r\n    listeners.push(layer.on('change:visible', (function() {\r\n      this.setLayerVisibility(layer, li);\r\n    }).bind(this)));\r\n  }\r\n  // Other properties\r\n  listeners.push(layer.on('propertychange', (function(e) {\r\n    if (e.key === 'displayInLayerSwitcher'\r\n      || e.key === 'openInLayerSwitcher') {\r\n      this.drawPanel(e);\r\n    }\r\n  }).bind(this)));\r\n  this._layers.push({ li:li, layer:layer, listeners: listeners });\r\n};\r\n\r\n/** Set opacity for a layer\r\n * @param {ol.layer.Layer} layer\r\n * @param {Element} li the list element\r\n * @api\r\n */\r\nol_control_LayerSwitcher.prototype.setLayerOpacity = function(layer, li) {\r\n  var i = li.querySelector('.layerswitcher-opacity-cursor')\r\n  if (i) i.style.left = (layer.getOpacity()*100)+\"%\"\r\n  this.dispatchEvent({ type: 'layer:opacity', layer: layer });\r\n};\r\n\r\n/** Set visibility for a layer\r\n * @param {ol.layer.Layer} layer\r\n * @param {Element} li the list element\r\n * @api\r\n */\r\nol_control_LayerSwitcher.prototype.setLayerVisibility = function(layer, li) {\r\n  var i = li.querySelector('.ol-visibility');\r\n  if (i) i.checked = layer.getVisible();\r\n  if (layer.getVisible()) li.classList.add('ol-visible');\r\n  else li.classList.remove('ol-visible');\r\n  this.dispatchEvent({ type: 'layer:visible', layer: layer });\r\n};\r\n\r\n/** Clear layers associated with li\r\n */\r\nol_control_LayerSwitcher.prototype._clearLayerForLI = function() {\r\n  this._layers.forEach(function (li) {\r\n    li.listeners.forEach(function(l) {\r\n      ol_Observable_unByKey(l);\r\n    });\r\n  })\r\n  this._layers = [];\r\n};\r\n\r\n/** Get the layer associated with a li\r\n * @param {Element} li\r\n * @return {ol.layer}\r\n */\r\nol_control_LayerSwitcher.prototype._getLayerForLI = function(li) {\r\n  for (var i=0, l; l=this._layers[i]; i++) {\r\n    if (l.li===li) return l.layer;\r\n  }\r\n  return null;\r\n};\r\n\r\n/**\r\n * On view change hide layer depending on resolution / extent\r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype.viewChange = function() {\r\n  this.panel_.querySelectorAll('li').forEach( function(li) {\r\n    var l = this._getLayerForLI(li);\r\n    if (l) {\r\n      if (this.testLayerVisibility(l)) li.classList.remove('ol-layer-hidden');\r\n      else li.classList.add('ol-layer-hidden');\r\n    }\r\n  }.bind(this));\r\n};\r\n\r\n/**\r\n *\tDraw the panel control (prevent multiple draw due to layers manipulation on the map with a delay function)\r\n*/\r\nol_control_LayerSwitcher.prototype.drawPanel = function() {\r\n  if (!this.getMap()) return;\r\n  var self = this;\r\n  // Multiple event simultaneously / draw once => put drawing in the event queue\r\n  this.dcount++;\r\n  setTimeout (function(){ self.drawPanel_(); }, this.get('drawDelay') || 0);\r\n};\r\n\r\n/** Delayed draw panel control \r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype.drawPanel_ = function() {\r\n  if (--this.dcount || this.dragging_) return;\r\n  // Remove existing layers\r\n  this._clearLayerForLI();\r\n  this.panel_.querySelectorAll('li').forEach (function(li) {\r\n    if (!li.classList.contains('ol-header')) li.remove();\r\n  }.bind(this));\r\n  // Draw list\r\n  this.drawList (this.panel_, this._layerGroup ?  this._layerGroup.getLayers() : this.getMap().getLayers());\r\n};\r\n\r\n/** Change layer visibility according to the baselayer option\r\n * @param {ol.layer}\r\n * @param {Array<ol.layer>} related layers\r\n */\r\nol_control_LayerSwitcher.prototype.switchLayerVisibility = function(l, layers) {\r\n  if (!l.get('baseLayer')) {\r\n    l.setVisible(!l.getVisible());\r\n  } else {\r\n    if (!l.getVisible()) l.setVisible(true);\r\n    layers.forEach(function(li) {\r\n      if (l!==li && li.get('baseLayer') && li.getVisible()) li.setVisible(false);\r\n    });\r\n  }\r\n};\r\n\r\n/** Check if layer is on the map (depending on zoom and extent)\r\n * @param {ol.layer}\r\n * @return {boolean}\r\n */\r\nol_control_LayerSwitcher.prototype.testLayerVisibility = function(layer) {\r\n  if (!this.getMap()) return true;\r\n  var res = this.getMap().getView().getResolution();\r\n  if (layer.getMaxResolution()<=res || layer.getMinResolution()>=res) {\r\n    return false;\r\n  } else {\r\n    var ex0 = layer.getExtent();\r\n    if (ex0) {\r\n      var ex = this.getMap().getView().calculateExtent(this.getMap().getSize());\r\n      return ol_extent_intersects(ex, ex0);\r\n    }\r\n    return true;\r\n  }\r\n};\r\n\r\n\r\n/** Start ordering the list\r\n*\t@param {event} e drag event\r\n*\t@private\r\n*/\r\nol_control_LayerSwitcher.prototype.dragOrdering_ = function(e) {\r\n  e.stopPropagation();\r\n  e.preventDefault();\r\n  // Get params\r\n  var self = this;\r\n  var elt = e.currentTarget.parentNode.parentNode;\r\n  var start = true;\r\n  var panel = this.panel_; \r\n  var pageY;\r\n  var pageY0 = e.pageY \r\n    || (e.touches && e.touches.length && e.touches[0].pageY) \r\n    || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageY);\r\n  var target, dragElt;\r\n  var layer, group;\r\n  elt.parentNode.classList.add('drag');\r\n\r\n  // Stop ordering\r\n  function stop() {\r\n    if (target) {\r\n      // Get drag on parent\r\n      var drop = layer;\r\n      if (drop && target) {\r\n        var collection ;\r\n        if (group) collection = group.getLayers();\r\n        else collection = self._layerGroup ?  self._layerGroup.getLayers() : self.getMap().getLayers();\r\n        var layers = collection.getArray();\r\n        // Switch layers\r\n        for (var i=0; i<layers.length; i++) {\r\n          if (layers[i]==drop) {\r\n            collection.removeAt (i);\r\n            break;\r\n          }\r\n        }\r\n        for (var j=0; j<layers.length; j++) {\r\n          if (layers[j]==target) {\r\n            if (i>j) collection.insertAt (j,drop);\r\n            else collection.insertAt (j+1,drop);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      self.dispatchEvent({ type: \"reorder-end\", layer: drop, group: group });\r\n    }\r\n    \r\n    elt.parentNode.querySelectorAll('li').forEach(function(li){\r\n      li.classList.remove('dropover');\r\n      li.classList.remove('dropover-after');\r\n      li.classList.remove('dropover-before');\r\n    });\r\n    elt.classList.remove(\"drag\");\r\n    elt.parentNode.classList.remove(\"drag\");\r\n    self.element.classList.remove('drag');\r\n    if (dragElt) dragElt.remove();\r\n\r\n    ol_ext_element.removeListener(document, 'mousemove touchmove', move);\r\n    ol_ext_element.removeListener(document, 'mouseup touchend touchcancel', stop);\r\n  }\r\n\r\n  // Ordering\r\n  function move(e) {\r\n    // First drag (more than 2 px) => show drag element (ghost)\r\n    pageY = e.pageY \r\n        || (e.touches && e.touches.length && e.touches[0].pageY) \r\n        || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageY);\r\n    if (start && Math.abs(pageY0 - pageY) > 2) {\r\n      start = false;\r\n      elt.classList.add(\"drag\");\r\n      layer = self._getLayerForLI(elt);\r\n      target = false;\r\n      group = self._getLayerForLI(elt.parentNode.parentNode);\r\n      // Ghost div\r\n      dragElt = ol_ext_element.create('LI', { \r\n        className: 'ol-dragover',\r\n        html: elt.innerHTML,\r\n        style: { \r\n          position: \"absolute\", \r\n          \"z-index\": 10000, \r\n          left: elt.offsetLeft, \r\n          opacity: 0.5,\r\n          width: ol_ext_element.outerWidth(elt),\r\n          height: ol_ext_element.getStyle(elt,'height'),\r\n        },\r\n        parent: panel \r\n      });\r\n      self.element.classList.add('drag');\r\n      self.dispatchEvent({ type: \"reorder-start\", layer: layer, group: group });\r\n    }\r\n    // Start a new drag sequence\r\n    if (!start) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      // Ghost div\r\n      ol_ext_element.setStyle(dragElt, { top: pageY - ol_ext_element.offsetRect(panel).top + panel.scrollTop +5 });\r\n      \r\n      var li;\r\n      if (!e.touches) {\r\n        li = e.target;\r\n      } else {\r\n        li = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);\r\n      }\r\n      if (li.classList.contains(\"ol-switcherbottomdiv\")) {\r\n        self.overflow(-1);\r\n      } else if (li.classList.contains(\"ol-switchertopdiv\")) {\r\n        self.overflow(1);\r\n      }\r\n      // Get associated li\r\n      while (li && li.tagName!=='LI') {\r\n        li = li.parentNode;\r\n      }\r\n      if (!li || !li.classList.contains('dropover')) {\r\n        elt.parentNode.querySelectorAll('li').forEach(function(li) {\r\n          li.classList.remove('dropover');\r\n          li.classList.remove('dropover-after');\r\n          li.classList.remove('dropover-before');\r\n        });\r\n      }\r\n      if (li && li.parentNode.classList.contains('drag') && li !== elt) {\r\n        target = self._getLayerForLI(li);\r\n        // Don't mix layer level\r\n        if (target && !target.get('allwaysOnTop') == !layer.get('allwaysOnTop')) {\r\n          li.classList.add(\"dropover\");\r\n          li.classList.add((elt.offsetTop < li.offsetTop) ? 'dropover-after' : 'dropover-before');\r\n        } else {\r\n          target = false;\r\n        }\r\n        ol_ext_element.show(dragElt);\r\n      } else {\r\n        target = false;\r\n        if (li===elt) ol_ext_element.hide(dragElt);\r\n        else ol_ext_element.show(dragElt);\r\n      }\r\n      \r\n      if (!target) dragElt.classList.add(\"forbidden\");\r\n      else dragElt.classList.remove(\"forbidden\");\r\n    }\r\n  }\r\n\r\n  // Start ordering\r\n  ol_ext_element.addListener(document, 'mousemove touchmove', move);\r\n  ol_ext_element.addListener(document, 'mouseup touchend touchcancel', stop);\r\n};\r\n\r\n\r\n/** Change opacity on drag \r\n*\t@param {event} e drag event\r\n*\t@private\r\n*/\r\nol_control_LayerSwitcher.prototype.dragOpacity_ = function(e) {\r\n  e.stopPropagation();\r\n  e.preventDefault();\r\n  var self = this\r\n  // Register start params\r\n  var elt = e.target;\r\n  var layer = this._getLayerForLI(elt.parentNode.parentNode.parentNode);\r\n  if (!layer) return;\r\n  var x = e.pageX \r\n    || (e.touches && e.touches.length && e.touches[0].pageX) \r\n    || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageX);\r\n  var start = ol_ext_element.getStyle (elt, 'left') - x;\r\n  self.dragging_ = true;\r\n\r\n  // stop dragging\r\n  function stop() {\r\n    ol_ext_element.removeListener(document, \"mouseup touchend touchcancel\", stop);\r\n    ol_ext_element.removeListener(document, \"mousemove touchmove\", move);\r\n    self.dragging_ = false;\r\n  }\r\n  // On draggin\r\n  function move(e) {\r\n    var x = e.pageX \r\n      || (e.touches && e.touches.length && e.touches[0].pageX) \r\n      || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageX);\r\n    var delta = (start + x) / ol_ext_element.getStyle(elt.parentNode, 'width');\r\n    var opacity = Math.max (0, Math.min(1, delta));\r\n    ol_ext_element.setStyle (elt, { left: (opacity*100) + \"%\" });\r\n    elt.parentNode.nextElementSibling.innerHTML = Math.round(opacity*100);\r\n    layer.setOpacity(opacity);\r\n  }\r\n  // Register move\r\n  ol_ext_element.addListener(document, \"mouseup touchend touchcancel\", stop);\r\n  ol_ext_element.addListener(document, \"mousemove touchmove\", move);\r\n};\r\n\r\n\r\n/** Render a list of layer\r\n * @param {Elemen} element to render\r\n * @layers {Array{ol.layer}} list of layer to show\r\n * @api stable\r\n */\r\nol_control_LayerSwitcher.prototype.drawList = function(ul, collection) {\r\n  var self = this;\r\n  var layers = collection.getArray();\r\n\r\n  // Change layer visibility\r\n  var setVisibility = function(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n    var l = self._getLayerForLI(this.parentNode.parentNode);\r\n    self.switchLayerVisibility(l, collection);\r\n  };\r\n  // Info button click\r\n  function onInfo(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault(); \r\n    var l = self._getLayerForLI(this.parentNode.parentNode);\r\n    self.oninfo(l); \r\n    self.dispatchEvent({ type: \"info\", layer: l });\r\n  }\r\n  // Zoom to extent button\r\n  function zoomExtent(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault(); \r\n    var l = self._getLayerForLI(this.parentNode.parentNode);\r\n    if (self.onextent) self.onextent(l); \r\n    else self.getMap().getView().fit (l.getExtent(), self.getMap().getSize()); \r\n    self.dispatchEvent({ type: \"extent\", layer: l });\r\n  }\r\n  // Remove a layer on trash click\r\n  function removeLayer(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n    var li = this.parentNode.parentNode.parentNode.parentNode;\r\n    var layer, group = self._getLayerForLI(li);\r\n    // Remove the layer from a group or from a map\r\n    if (group) {\r\n      layer = self._getLayerForLI(this.parentNode.parentNode);\r\n      group.getLayers().remove(layer);\r\n      if (group.getLayers().getLength()==0 && !group.get('noSwitcherDelete')) {\r\n        removeLayer.call(li.querySelectorAll('.layerTrash')[0], e);\r\n      }\r\n    } else {\r\n      li = this.parentNode.parentNode;\r\n      self.getMap().removeLayer(self._getLayerForLI(li));\r\n    }\r\n  }\r\n  \r\n  // Add the layer list\r\n  for (var i=layers.length-1; i>=0; i--) {\r\n    var layer = layers[i];\r\n\r\n    if (!self.displayInLayerSwitcher(layer)) {\r\n      this._setLayerForLI(null, layer);\r\n      continue;\r\n    } \r\n\r\n    var li = ol_ext_element.create('LI', {\r\n      className: (layer.getVisible()?\"visible \":\" \")+(layer.get('baseLayer')?\"baselayer\":\"\"),\r\n      parent: ul\r\n    });\r\n    this._setLayerForLI(li, layer);\r\n\r\n    var layer_buttons = ol_ext_element.create('DIV', {\r\n      className: 'ol-layerswitcher-buttons',\r\n      parent: li\r\n    });\r\n\r\n    // Content div\r\n    var d = ol_ext_element.create('DIV', {\r\n      className: 'li-content',// + (this.testLayerVisibility(layer) ? '' : ' ol-layer-hidden'),\r\n      parent: li\r\n    });\r\n    \r\n    // Visibility\r\n    ol_ext_element.create('INPUT', {\r\n      type: layer.get('baseLayer') ? 'radio' : 'checkbox',\r\n      className: 'ol-visibility',\r\n      checked: layer.getVisible(),\r\n      click: setVisibility,\r\n      parent: d\r\n    });\r\n    // Label\r\n    ol_ext_element.create('LABEL', {\r\n      html: layer.get(\"title\") || layer.get(\"name\"),\r\n      title: layer.get(\"title\") || layer.get(\"name\"),\r\n      click: setVisibility,\r\n      unselectable: 'on',\r\n      style: {\r\n        userSelect: 'none'\r\n      },\r\n      parent: d\r\n    }).addEventListener('selectstart', function(){ return false; });\r\n\r\n    //  up/down\r\n    if (this.reordering) {\r\n      if ( (i<layers.length-1 && (layer.get(\"allwaysOnTop\") || !layers[i+1].get(\"allwaysOnTop\")) )\r\n      || (i>0 && (!layer.get(\"allwaysOnTop\") || layers[i-1].get(\"allwaysOnTop\")) ) ) {\r\n        ol_ext_element.create('DIV', {\r\n          className: 'layerup',\r\n          title: this.tip.up,\r\n          on: { 'mousedown touchstart': function(e) { self.dragOrdering_(e) } },\r\n          parent: layer_buttons\r\n        });\r\n      }\r\n    }\r\n\r\n    // Show/hide sub layers\r\n    if (layer.getLayers) {\r\n      var nb = 0;\r\n      layer.getLayers().forEach(function(l) {\r\n        if (self.displayInLayerSwitcher(l)) nb++;\r\n      });\r\n      if (nb) {\r\n        ol_ext_element.create('DIV', {\r\n          className: layer.get(\"openInLayerSwitcher\") ? \"collapse-layers\" : \"expend-layers\",\r\n          title: this.tip.plus,\r\n          click: function() {\r\n            var l = self._getLayerForLI(this.parentNode.parentNode);\r\n            l.set(\"openInLayerSwitcher\", !l.get(\"openInLayerSwitcher\") )\r\n          },\r\n          parent: layer_buttons\r\n        });\r\n      }\r\n    }\r\n\r\n    // Info button\r\n    if (this.oninfo) {\r\n      ol_ext_element.create('DIV', {\r\n        className: 'layerInfo',\r\n        title: this.tip.info,\r\n        click: onInfo,\r\n        parent: layer_buttons\r\n      });\r\n    }\r\n    // Layer remove\r\n    if (this.hastrash && !layer.get(\"noSwitcherDelete\")) {\r\n      ol_ext_element.create('DIV', {\r\n        className: 'layerTrash',\r\n        title: this.tip.trash,\r\n        click: removeLayer,\r\n        parent: layer_buttons\r\n      });\r\n    }\r\n    // Layer extent\r\n    if (this.hasextent && layers[i].getExtent()) {\r\n      var ex = layers[i].getExtent();\r\n      if (ex.length==4 && ex[0]<ex[2] && ex[1]<ex[3]) {\r\n        ol_ext_element.create('DIV', {\r\n          className: 'layerExtent',\r\n          title: this.tip.extent,\r\n          click: zoomExtent,\r\n          parent: layer_buttons  \r\n        });\r\n      }\r\n    }\r\n\r\n    // Progress\r\n    if (this.show_progress && layer instanceof ol_layer_Tile) {\r\n      var p = ol_ext_element.create('DIV', {\r\n        className: 'layerswitcher-progress',\r\n        parent: d\r\n      });\r\n      this.setprogress_(layer);\r\n      layer.layerswitcher_progress = ol_ext_element.create('DIV', { parent: p });\r\n    }\r\n\r\n    // Opacity\r\n    var opacity = ol_ext_element.create('DIV', {\r\n      className: 'layerswitcher-opacity',\r\n      // Click on the opacity line\r\n      click: function(e){\r\n        if (e.target !== this) return;\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        var op = Math.max ( 0, Math.min( 1, e.offsetX / ol_ext_element.getStyle(this, 'width')));\r\n        self._getLayerForLI(this.parentNode.parentNode).setOpacity(op);\r\n      },\r\n      parent: d\r\n    });\r\n    // Start dragging\r\n    ol_ext_element.create('DIV', {\r\n      className: 'layerswitcher-opacity-cursor',\r\n      style: { left: (layer.getOpacity()*100)+\"%\" },\r\n      on: {\r\n        'mousedown touchstart': function(e) { self.dragOpacity_ (e); }\r\n      },\r\n      parent: opacity\r\n    });\r\n    // Percent\r\n    ol_ext_element.create('DIV', {\r\n      className: 'layerswitcher-opacity-label',\r\n      html: Math.round(layer.getOpacity()*100),\r\n      parent: d\r\n    });\r\n\r\n    // Layer group\r\n    if (layer.getLayers) {\r\n      li.classList.add('ol-layer-group');\r\n      if (layer.get(\"openInLayerSwitcher\") === true) {\r\n        var ul2 = ol_ext_element.create('UL', {\r\n          parent: li\r\n        });\r\n        this.drawList (ul2, layer.getLayers());\r\n      }\r\n    }\r\n    else if (layer instanceof ol_layer_Vector) li.classList.add('ol-layer-vector');\r\n    else if (layer instanceof ol_layer_VectorTile) li.classList.add('ol-layer-vector');\r\n    else if (layer instanceof ol_layer_Tile) li.classList.add('ol-layer-tile');\r\n    else if (layer instanceof ol_layer_Image) li.classList.add('ol-layer-image');\r\n    else if (layer instanceof ol_layer_Heatmap) li.classList.add('ol-layer-heatmap');\r\n\r\n    // Dispatch a dralist event to allow customisation\r\n    this.dispatchEvent({ type:'drawlist', layer:layer, li:li });\r\n  }\r\n\r\n  this.viewChange();\r\n\r\n  if (ul === this.panel_) this.overflow();\r\n};\r\n\r\n/** Handle progress bar for a layer\r\n*\t@private\r\n*/\r\nol_control_LayerSwitcher.prototype.setprogress_ = function(layer) {\r\n  if (!layer.layerswitcher_progress) {\r\n    var loaded = 0;\r\n    var loading = 0;\r\n    var draw = function() {\r\n      if (loading === loaded) {\r\n        loading = loaded = 0;\r\n        ol_ext_element.setStyle(layer.layerswitcher_progress, { width: 0 });// layer.layerswitcher_progress.width(0);\r\n      } else {\r\n        ol_ext_element.setStyle(layer.layerswitcher_progress, { width: (loaded / loading * 100).toFixed(1) + '%' });// layer.layerswitcher_progress.css('width', (loaded / loading * 100).toFixed(1) + '%');\r\n      }\r\n    }\r\n    layer.getSource().on('tileloadstart', function() {\r\n      loading++;\r\n      draw();\r\n    });\r\n    layer.getSource().on('tileloadend', function() {\r\n      loaded++;\r\n      draw();\r\n    });\r\n    layer.getSource().on('tileloaderror', function() {\r\n      loaded++;\r\n      draw();\r\n    });\r\n  }\r\n};\r\n\r\nexport default ol_control_LayerSwitcher\r\n","/**\n * @module ol/CollectionEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  /**\n   * Triggered when an item is added to the collection.\n   * @event module:ol/Collection.CollectionEvent#add\n   * @api\n   */\n  ADD: 'add',\n  /**\n   * Triggered when an item is removed from the collection.\n   * @event module:ol/Collection.CollectionEvent#remove\n   * @api\n   */\n  REMOVE: 'remove'\n};\n\n//# sourceMappingURL=CollectionEventType.js.map","/**\n * @module ol/Kinetic\n */\n\n/**\n * @classdesc\n * Implementation of inertial deceleration for map movement.\n *\n * @api\n */\nvar Kinetic = function Kinetic(decay, minVelocity, delay) {\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.decay_ = decay;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.minVelocity_ = minVelocity;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.delay_ = delay;\n\n  /**\n   * @private\n   * @type {Array<number>}\n   */\n  this.points_ = [];\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.angle_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.initialVelocity_ = 0;\n};\n\n/**\n * FIXME empty description for jsdoc\n */\nKinetic.prototype.begin = function begin () {\n  this.points_.length = 0;\n  this.angle_ = 0;\n  this.initialVelocity_ = 0;\n};\n\n/**\n * @param {number} x X.\n * @param {number} y Y.\n */\nKinetic.prototype.update = function update (x, y) {\n  this.points_.push(x, y, Date.now());\n};\n\n/**\n * @return {boolean} Whether we should do kinetic animation.\n */\nKinetic.prototype.end = function end () {\n  if (this.points_.length < 6) {\n    // at least 2 points are required (i.e. there must be at least 6 elements\n    // in the array)\n    return false;\n  }\n  var delay = Date.now() - this.delay_;\n  var lastIndex = this.points_.length - 3;\n  if (this.points_[lastIndex + 2] < delay) {\n    // the last tracked point is too old, which means that the user stopped\n    // panning before releasing the map\n    return false;\n  }\n\n  // get the first point which still falls into the delay time\n  var firstIndex = lastIndex - 3;\n  while (firstIndex > 0 && this.points_[firstIndex + 2] > delay) {\n    firstIndex -= 3;\n  }\n\n  var duration = this.points_[lastIndex + 2] - this.points_[firstIndex + 2];\n  // we don't want a duration of 0 (divide by zero)\n  // we also make sure the user panned for a duration of at least one frame\n  // (1/60s) to compute sane displacement values\n  if (duration < 1000 / 60) {\n    return false;\n  }\n\n  var dx = this.points_[lastIndex] - this.points_[firstIndex];\n  var dy = this.points_[lastIndex + 1] - this.points_[firstIndex + 1];\n  this.angle_ = Math.atan2(dy, dx);\n  this.initialVelocity_ = Math.sqrt(dx * dx + dy * dy) / duration;\n  return this.initialVelocity_ > this.minVelocity_;\n};\n\n/**\n * @return {number} Total distance travelled (pixels).\n */\nKinetic.prototype.getDistance = function getDistance () {\n  return (this.minVelocity_ - this.initialVelocity_) / this.decay_;\n};\n\n/**\n * @return {number} Angle of the kinetic panning animation (radians).\n */\nKinetic.prototype.getAngle = function getAngle () {\n  return this.angle_;\n};\n\nexport default Kinetic;\n\n//# sourceMappingURL=Kinetic.js.map","/**\n * @module ol/Feature\n */\nimport {assert} from './asserts.js';\nimport {listen, unlisten, unlistenByKey} from './events.js';\nimport EventType from './events/EventType.js';\nimport BaseObject, {getChangeEventType} from './Object.js';\n\n/**\n * @typedef {typeof Feature|typeof import(\"./render/Feature.js\").default} FeatureClass\n */\n\n/**\n * @typedef {Feature|import(\"./render/Feature.js\").default} FeatureLike\n */\n\n/**\n * @classdesc\n * A vector object for geographic features with a geometry and other\n * attribute properties, similar to the features in vector file formats like\n * GeoJSON.\n *\n * Features can be styled individually with `setStyle`; otherwise they use the\n * style of their vector layer.\n *\n * Note that attribute properties are set as {@link module:ol/Object} properties on\n * the feature object, so they are observable, and have get/set accessors.\n *\n * Typically, a feature has a single geometry property. You can set the\n * geometry using the `setGeometry` method and get it with `getGeometry`.\n * It is possible to store more than one geometry on a feature using attribute\n * properties. By default, the geometry used for rendering is identified by\n * the property name `geometry`. If you want to use another geometry property\n * for rendering, use the `setGeometryName` method to change the attribute\n * property associated with the geometry for the feature.  For example:\n *\n * ```js\n *\n * import Feature from 'ol/Feature';\n * import Polygon from 'ol/geom/Polygon';\n * import Point from 'ol/geom/Point';\n *\n * var feature = new Feature({\n *   geometry: new Polygon(polyCoords),\n *   labelPoint: new Point(labelCoords),\n *   name: 'My Polygon'\n * });\n *\n * // get the polygon geometry\n * var poly = feature.getGeometry();\n *\n * // Render the feature as a point using the coordinates from labelPoint\n * feature.setGeometryName('labelPoint');\n *\n * // get the point geometry\n * var point = feature.getGeometry();\n * ```\n *\n * @api\n */\nvar Feature = /*@__PURE__*/(function (BaseObject) {\n  function Feature(opt_geometryOrProperties) {\n\n    BaseObject.call(this);\n\n    /**\n     * @private\n     * @type {number|string|undefined}\n     */\n    this.id_ = undefined;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.geometryName_ = 'geometry';\n\n    /**\n     * User provided style.\n     * @private\n     * @type {import(\"./style/Style.js\").StyleLike}\n     */\n    this.style_ = null;\n\n    /**\n     * @private\n     * @type {import(\"./style/Style.js\").StyleFunction|undefined}\n     */\n    this.styleFunction_ = undefined;\n\n    /**\n     * @private\n     * @type {?import(\"./events.js\").EventsKey}\n     */\n    this.geometryChangeKey_ = null;\n\n    listen(\n      this, getChangeEventType(this.geometryName_),\n      this.handleGeometryChanged_, this);\n\n    if (opt_geometryOrProperties) {\n      if (typeof /** @type {?} */ (opt_geometryOrProperties).getSimplifiedGeometry === 'function') {\n        var geometry = /** @type {import(\"./geom/Geometry.js\").default} */ (opt_geometryOrProperties);\n        this.setGeometry(geometry);\n      } else {\n        /** @type {Object<string, *>} */\n        var properties = opt_geometryOrProperties;\n        this.setProperties(properties);\n      }\n    }\n  }\n\n  if ( BaseObject ) Feature.__proto__ = BaseObject;\n  Feature.prototype = Object.create( BaseObject && BaseObject.prototype );\n  Feature.prototype.constructor = Feature;\n\n  /**\n   * Clone this feature. If the original feature has a geometry it\n   * is also cloned. The feature id is not set in the clone.\n   * @return {Feature} The clone.\n   * @api\n   */\n  Feature.prototype.clone = function clone () {\n    var clone = new Feature(this.getProperties());\n    clone.setGeometryName(this.getGeometryName());\n    var geometry = this.getGeometry();\n    if (geometry) {\n      clone.setGeometry(geometry.clone());\n    }\n    var style = this.getStyle();\n    if (style) {\n      clone.setStyle(style);\n    }\n    return clone;\n  };\n\n  /**\n   * Get the feature's default geometry.  A feature may have any number of named\n   * geometries.  The \"default\" geometry (the one that is rendered by default) is\n   * set when calling {@link module:ol/Feature~Feature#setGeometry}.\n   * @return {import(\"./geom/Geometry.js\").default|undefined} The default geometry for the feature.\n   * @api\n   * @observable\n   */\n  Feature.prototype.getGeometry = function getGeometry () {\n    return (\n      /** @type {import(\"./geom/Geometry.js\").default|undefined} */ (this.get(this.geometryName_))\n    );\n  };\n\n  /**\n   * Get the feature identifier.  This is a stable identifier for the feature and\n   * is either set when reading data from a remote source or set explicitly by\n   * calling {@link module:ol/Feature~Feature#setId}.\n   * @return {number|string|undefined} Id.\n   * @api\n   */\n  Feature.prototype.getId = function getId () {\n    return this.id_;\n  };\n\n  /**\n   * Get the name of the feature's default geometry.  By default, the default\n   * geometry is named `geometry`.\n   * @return {string} Get the property name associated with the default geometry\n   *     for this feature.\n   * @api\n   */\n  Feature.prototype.getGeometryName = function getGeometryName () {\n    return this.geometryName_;\n  };\n\n  /**\n   * Get the feature's style. Will return what was provided to the\n   * {@link module:ol/Feature~Feature#setStyle} method.\n   * @return {import(\"./style/Style.js\").StyleLike} The feature style.\n   * @api\n   */\n  Feature.prototype.getStyle = function getStyle () {\n    return this.style_;\n  };\n\n  /**\n   * Get the feature's style function.\n   * @return {import(\"./style/Style.js\").StyleFunction|undefined} Return a function\n   * representing the current style of this feature.\n   * @api\n   */\n  Feature.prototype.getStyleFunction = function getStyleFunction () {\n    return this.styleFunction_;\n  };\n\n  /**\n   * @private\n   */\n  Feature.prototype.handleGeometryChange_ = function handleGeometryChange_ () {\n    this.changed();\n  };\n\n  /**\n   * @private\n   */\n  Feature.prototype.handleGeometryChanged_ = function handleGeometryChanged_ () {\n    if (this.geometryChangeKey_) {\n      unlistenByKey(this.geometryChangeKey_);\n      this.geometryChangeKey_ = null;\n    }\n    var geometry = this.getGeometry();\n    if (geometry) {\n      this.geometryChangeKey_ = listen(geometry,\n        EventType.CHANGE, this.handleGeometryChange_, this);\n    }\n    this.changed();\n  };\n\n  /**\n   * Set the default geometry for the feature.  This will update the property\n   * with the name returned by {@link module:ol/Feature~Feature#getGeometryName}.\n   * @param {import(\"./geom/Geometry.js\").default|undefined} geometry The new geometry.\n   * @api\n   * @observable\n   */\n  Feature.prototype.setGeometry = function setGeometry (geometry) {\n    this.set(this.geometryName_, geometry);\n  };\n\n  /**\n   * Set the style for the feature.  This can be a single style object, an array\n   * of styles, or a function that takes a resolution and returns an array of\n   * styles. If it is `null` the feature has no style (a `null` style).\n   * @param {import(\"./style/Style.js\").StyleLike} style Style for this feature.\n   * @api\n   * @fires module:ol/events/Event~Event#event:change\n   */\n  Feature.prototype.setStyle = function setStyle (style) {\n    this.style_ = style;\n    this.styleFunction_ = !style ? undefined : createStyleFunction(style);\n    this.changed();\n  };\n\n  /**\n   * Set the feature id.  The feature id is considered stable and may be used when\n   * requesting features or comparing identifiers returned from a remote source.\n   * The feature id can be used with the\n   * {@link module:ol/source/Vector~VectorSource#getFeatureById} method.\n   * @param {number|string|undefined} id The feature id.\n   * @api\n   * @fires module:ol/events/Event~Event#event:change\n   */\n  Feature.prototype.setId = function setId (id) {\n    this.id_ = id;\n    this.changed();\n  };\n\n  /**\n   * Set the property name to be used when getting the feature's default geometry.\n   * When calling {@link module:ol/Feature~Feature#getGeometry}, the value of the property with\n   * this name will be returned.\n   * @param {string} name The property name of the default geometry.\n   * @api\n   */\n  Feature.prototype.setGeometryName = function setGeometryName (name) {\n    unlisten(\n      this, getChangeEventType(this.geometryName_),\n      this.handleGeometryChanged_, this);\n    this.geometryName_ = name;\n    listen(\n      this, getChangeEventType(this.geometryName_),\n      this.handleGeometryChanged_, this);\n    this.handleGeometryChanged_();\n  };\n\n  return Feature;\n}(BaseObject));\n\n\n/**\n * Convert the provided object into a feature style function.  Functions passed\n * through unchanged.  Arrays of Style or single style objects wrapped\n * in a new feature style function.\n * @param {!import(\"./style/Style.js\").StyleFunction|!Array<import(\"./style/Style.js\").default>|!import(\"./style/Style.js\").default} obj\n *     A feature style function, a single style, or an array of styles.\n * @return {import(\"./style/Style.js\").StyleFunction} A style function.\n */\nexport function createStyleFunction(obj) {\n  if (typeof obj === 'function') {\n    return obj;\n  } else {\n    /**\n     * @type {Array<import(\"./style/Style.js\").default>}\n     */\n    var styles;\n    if (Array.isArray(obj)) {\n      styles = obj;\n    } else {\n      assert(typeof /** @type {?} */ (obj).getZIndex === 'function',\n        41); // Expected an `import(\"./style/Style.js\").Style` or an array of `import(\"./style/Style.js\").Style`\n      var style = /** @type {import(\"./style/Style.js\").default} */ (obj);\n      styles = [style];\n    }\n    return function() {\n      return styles;\n    };\n  }\n}\nexport default Feature;\n\n//# sourceMappingURL=Feature.js.map","/** Vanilla JS helper to manipulate DOM without jQuery\r\n * @see https://github.com/nefe/You-Dont-Need-jQuery\r\n * @see https://plainjs.com/javascript/\r\n * @see http://youmightnotneedjquery.com/\r\n */\r\n var ol_ext_element = {};\r\n\r\n/**\r\n * Create an element\r\n * @param {string} tagName The element tag, use 'TEXT' to create a text node\r\n * @param {*} options\r\n *  @param {string} options.className className The element class name \r\n *  @param {Element} options.parent Parent to append the element as child\r\n *  @param {Element|string} options.html Content of the element\r\n *  @param {string} options.* Any other attribut to add to the element\r\n */\r\nol_ext_element.create = function (tagName, options) {\r\n  options = options || {};\r\n  var elt;\r\n  // Create text node\r\n  if (tagName === 'TEXT') {\r\n    elt = document.createTextNode(options.html||'');\r\n    if (options.parent) options.parent.appendChild(elt);\r\n  } else {\r\n    // Other element\r\n    elt = document.createElement(tagName);\r\n    if (/button/i.test(tagName)) elt.setAttribute('type', 'button');\r\n    for (var attr in options) {\r\n      switch (attr) {\r\n        case 'className': {\r\n          if (options.className && options.className.trim) elt.setAttribute('class', options.className.trim());\r\n          break;\r\n        }\r\n        case 'html': {\r\n          if (options.html instanceof Element) elt.appendChild(options.html)\r\n          else if (options.html!==undefined) elt.innerHTML = options.html;\r\n          break;\r\n        }\r\n        case 'parent': {\r\n          if (options.parent) options.parent.appendChild(elt);\r\n          break;\r\n        }\r\n        case 'style': {\r\n          this.setStyle(elt, options.style);\r\n          break;\r\n        }\r\n        case 'change':\r\n        case 'click': {\r\n          ol_ext_element.addListener(elt, attr, options[attr]);\r\n          break;\r\n        }\r\n        case 'on': {\r\n          for (var e in options.on) {\r\n            ol_ext_element.addListener(elt, e, options.on[e]);\r\n          }\r\n          break;\r\n        }\r\n        case 'checked': {\r\n          elt.checked = !!options.checked;\r\n          break;\r\n        }\r\n        default: {\r\n          elt.setAttribute(attr, options[attr]);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return elt;\r\n};\r\n\r\n/** Create a toggle switch input\r\n * @param {*} options\r\n *  @param {string|Element} options.html\r\n *  @param {string|Element} options.after\r\n *  @param {boolean} options.checked\r\n *  @param {*} [options.on] a list of actions\r\n *  @param {function} [options.click]\r\n *  @param {function} [options.change]\r\n *  @param {Element} options.parent\r\n */\r\nol_ext_element.createSwitch = function (options) {\r\n  var label = ol_ext_element.create('LABEL',{ \r\n    html: options.html,\r\n    className: 'ol-ext-toggle-switch',\r\n    parent: options.parent\r\n  });\r\n  var input = ol_ext_element.create('INPUT', {\r\n    type: 'checkbox',\r\n    checked: options.checked,\r\n    click: options.click,\r\n    change: options.change,\r\n    on: options.on,\r\n    parent: label\r\n  });\r\n  ol_ext_element.create('SPAN', { parent: label });\r\n  if (options.after) {\r\n    label.appendChild(document.createTextNode(options.after));\r\n  }\r\n  return input;\r\n};\r\n\r\n/** Create a toggle switch input\r\n * @param {*} options\r\n *  @param {string|Element} options.html\r\n *  @param {string|Element} options.after\r\n *  @param {string} [options.name] input name\r\n *  @param {string} [options.type=checkbox] input type: radio or checkbox\r\n *  @param {string} options.value input value\r\n *  @param {*} [options.on] a list of actions\r\n *  @param {function} [options.click]\r\n *  @param {function} [options.change]\r\n *  @param {Element} options.parent\r\n */\r\nol_ext_element.createCheck = function (options) {\r\n  var label = ol_ext_element.create('LABEL', {\r\n    className: 'ol-ext-check ' + (options.type==='radio' ? 'ol-ext-radio' : 'ol-ext-checkbox'),\r\n    html: options.html,\r\n    parent: options.parent\r\n  });\r\n  var input = ol_ext_element.create('INPUT', {\r\n    name: options.name,\r\n    type: (options.type==='radio' ? 'radio' : 'checkbox'),\r\n    value: options.val,\r\n    change: options.change,\r\n    click: options.click,\r\n    on: options.on,\r\n    parent: label\r\n  });\r\n  ol_ext_element.create('SPAN', {\r\n    parent: label\r\n  });\r\n  if (options.after) {\r\n    label.appendChild(document.createTextNode(options.after));\r\n  }\r\n  return input;\r\n};\r\n\r\n\r\n/** Set inner html or append a child element to an element\r\n * @param {Element} element\r\n * @param {Element|string} html Content of the element\r\n */\r\nol_ext_element.setHTML = function(element, html) {\r\n  if (html instanceof Element) element.appendChild(html)\r\n  else if (html!==undefined) element.innerHTML = html;\r\n};\r\n\r\n/** Append text into an elemnt\r\n * @param {Element} element\r\n * @param {string} text text content\r\n */\r\nol_ext_element.appendText = function(element, text) {\r\n  element.appendChild(document.createTextNode(text||''));\r\n};\r\n\r\n/**\r\n * Add a set of event listener to an element\r\n * @param {Element} element\r\n * @param {string|Array<string>} eventType\r\n * @param {function} fn\r\n */\r\nol_ext_element.addListener = function (element, eventType, fn, useCapture ) {\r\n  if (typeof eventType === 'string') eventType = eventType.split(' ');\r\n  eventType.forEach(function(e) {\r\n    element.addEventListener(e, fn, useCapture);\r\n  });\r\n};\r\n\r\n/**\r\n * Add a set of event listener to an element\r\n * @param {Element} element\r\n * @param {string|Array<string>} eventType\r\n * @param {function} fn\r\n */\r\nol_ext_element.removeListener = function (element, eventType, fn) {\r\n  if (typeof eventType === 'string') eventType = eventType.split(' ');\r\n  eventType.forEach(function(e) {\r\n    element.removeEventListener(e, fn);\r\n  });\r\n};\r\n\r\n/**\r\n * Show an element\r\n * @param {Element} element\r\n */\r\nol_ext_element.show = function (element) {\r\n  element.style.display = '';\r\n};\r\n\r\n/**\r\n * Hide an element\r\n * @param {Element} element\r\n */\r\nol_ext_element.hide = function (element) {\r\n  element.style.display = 'none';\r\n};\r\n\r\n/**\r\n * Test if an element is hihdden\r\n * @param {Element} element\r\n * @return {boolean}\r\n */\r\nol_ext_element.hidden = function (element) {\r\n  return ol_ext_element.getStyle(element, 'display') === 'none';\r\n};\r\n\r\n/**\r\n * Toggle an element\r\n * @param {Element} element\r\n */\r\nol_ext_element.toggle = function (element) {\r\n  element.style.display = (element.style.display==='none' ? '' : 'none');\r\n};\r\n\r\n/** Set style of an element\r\n * @param {DOMElement} el the element\r\n * @param {*} st list of style\r\n */\r\nol_ext_element.setStyle = function(el, st) {\r\n  for (var s in st) {\r\n    switch (s) {\r\n      case 'top':\r\n      case 'left':\r\n      case 'bottom':\r\n      case 'right':\r\n      case 'minWidth':\r\n      case 'maxWidth':\r\n      case 'width':\r\n      case 'height': {\r\n        if (typeof(st[s]) === 'number') {\r\n          el.style[s] = st[s]+'px';\r\n        } else {\r\n          el.style[s] = st[s];\r\n        }\r\n        break;\r\n      }\r\n      default: {\r\n        el.style[s] = st[s];\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Get style propertie of an element\r\n * @param {DOMElement} el the element\r\n * @param {string} styleProp Propertie name\r\n * @return {*} style value\r\n */\r\nol_ext_element.getStyle = function(el, styleProp) {\r\n  var value, defaultView = (el.ownerDocument || document).defaultView;\r\n  // W3C standard way:\r\n  if (defaultView && defaultView.getComputedStyle) {\r\n    // sanitize property name to css notation\r\n    // (hypen separated words eg. font-Size)\r\n    styleProp = styleProp.replace(/([A-Z])/g, \"-$1\").toLowerCase();\r\n    value = defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);\r\n  } else if (el.currentStyle) { // IE\r\n    // sanitize property name to camelCase\r\n    styleProp = styleProp.replace(/-(\\w)/g, function(str, letter) {\r\n      return letter.toUpperCase();\r\n    });\r\n    value = el.currentStyle[styleProp];\r\n    // convert other units to pixels on IE\r\n    if (/^\\d+(em|pt|%|ex)?$/i.test(value)) { \r\n      return (function(value) {\r\n        var oldLeft = el.style.left, oldRsLeft = el.runtimeStyle.left;\r\n        el.runtimeStyle.left = el.currentStyle.left;\r\n        el.style.left = value || 0;\r\n        value = el.style.pixelLeft + \"px\";\r\n        el.style.left = oldLeft;\r\n        el.runtimeStyle.left = oldRsLeft;\r\n        return value;\r\n      })(value);\r\n    }\r\n  }\r\n  if (/px$/.test(value)) return parseInt(value);\r\n  return value;\r\n};\r\n\r\n/** Get outerHeight of an elemen\r\n * @param {DOMElement} elt\r\n * @return {number}\r\n */\r\nol_ext_element.outerHeight = function(elt) {\r\n  return elt.offsetHeight + ol_ext_element.getStyle(elt, 'marginBottom')\r\n};\r\n\r\n/** Get outerWidth of an elemen\r\n * @param {DOMElement} elt\r\n * @return {number}\r\n */\r\nol_ext_element.outerWidth = function(elt) {\r\n  return elt.offsetWidth + ol_ext_element.getStyle(elt, 'marginLeft')\r\n};\r\n\r\n/** Get element offset rect\r\n * @param {DOMElement} elt\r\n * @return {*} \r\n */\r\nol_ext_element.offsetRect = function(elt) {\r\n  var rect = elt.getBoundingClientRect();\r\n  return {\r\n    top: rect.top + (window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0),\r\n    left: rect.left + (window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0),\r\n    height: rect.height || (rect.bottom - rect.top),\r\n    width: rect.width || (rect.right - rect.left)\r\n  }\r\n};\r\n\r\n/** Make a div scrollable without scrollbar.\r\n * On touch devices the default behavior is preserved\r\n * @param {DOMElement} elt\r\n * @param {*} options\r\n *  @param {function} options.onmove a function that takes a boolean indicating that the div is scrolling\r\n *  @param {boolean} [options.vertical=false] \r\n *  @param {boolean} [options.animate=true] add kinetic to scroll\r\n */\r\nol_ext_element.scrollDiv = function(elt, options) {\r\n  var pos = false;\r\n  var speed = 0;\r\n  var d, dt = 0;\r\n\r\n  var onmove = (typeof(options.onmove) === 'function' ? options.onmove : function(){});\r\n  var page = options.vertical ? 'pageY' : 'pageX';\r\n  var scroll = options.vertical ? 'scrollTop' : 'scrollLeft';\r\n  var moving = false;\r\n\r\n  // Prevent image dragging\r\n  elt.querySelectorAll('img').forEach(function(i) {\r\n    i.ondragstart = function(){ return false; };\r\n  });\r\n  elt.style['touch-action'] = 'none';\r\n  \r\n  // Start scrolling\r\n  ol_ext_element.addListener(elt, ['pointerdown'], function(e) {\r\n    moving = false;\r\n    pos = e[page];\r\n    dt = new Date();\r\n    elt.classList.add('ol-move');\r\n  });\r\n  \r\n  // Register scroll\r\n  ol_ext_element.addListener(window, ['pointermove'], function(e) {\r\n    moving = true;\r\n    if (pos !== false) {\r\n      var delta = pos - e[page];\r\n      elt[scroll] += delta;\r\n      d = new Date();\r\n      if (d-dt) {\r\n        speed = (speed + delta / (d - dt))/2;\r\n      }\r\n      pos = e[page];\r\n      dt = d;\r\n      // Tell we are moving\r\n      if (delta) onmove(true);\r\n    }\r\n  });\r\n  \r\n  // Animate scroll\r\n  var animate = function(to) {\r\n    var step = (to>0) ? Math.min(100, to/2) : Math.max(-100, to/2);\r\n    to -= step;\r\n    elt[scroll] += step;\r\n    if (-1 < to && to < 1) {\r\n      if (moving) setTimeout(function() { elt.classList.remove('ol-move'); });\r\n      else elt.classList.remove('ol-move');\r\n      moving = false;\r\n      onmove(false);\r\n    } else {\r\n      setTimeout(function() {\r\n        animate(to);\r\n      }, 40);\r\n    }\r\n  }\r\n\r\n  // Stop scrolling\r\n  ol_ext_element.addListener(window, ['pointerup','pointercancel'], function(e) {\r\n    dt = new Date() - dt;\r\n    if (dt>100) {\r\n      // User stop: no speed\r\n      speed = 0;\r\n    } else if (dt>0) {\r\n      // Calculate new speed\r\n      speed = ((speed||0) + (pos - e[page]) / dt) / 2;\r\n    }\r\n    animate(options.animate===false ? 0 : speed*200);\r\n    pos = false;\r\n    speed = 0;\r\n    dt = 0;\r\n  });\r\n\r\n  // Handle mousewheel\r\n  if (options.mousewheel) { // && !elt.classList.contains('ol-touch')) {\r\n    ol_ext_element.addListener(elt, \r\n      ['mousewheel', 'DOMMouseScroll', 'onmousewheel'], \r\n      function(e) {\r\n        var delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail)));\r\n        elt.classList.add('ol-move');\r\n        elt[scroll] -= delta*30;\r\n        elt.classList.remove('ol-move');\r\n        return false;\r\n      }\r\n    );\r\n  }\r\n};\r\n\r\n/** Dispatch an event to an Element \r\n * @param {string} eventName\r\n * @param {Element} element\r\n*/\r\nol_ext_element.dispatchEvent = function (eventName, element) {\r\n  var event;\r\n  try {\r\n    event = new CustomEvent(eventName);\r\n  } catch(e) {\r\n    // Try customevent on IE\r\n    event = document.createEvent(\"CustomEvent\");\r\n    event.initCustomEvent(eventName, true, true, {});\r\n  }\r\n  element.dispatchEvent(event);\r\n};\r\n\r\nexport default ol_ext_element\r\n","/**\n * @module ol/ImageTile\n */\nimport Tile from './Tile.js';\nimport TileState from './TileState.js';\nimport {createCanvasContext2D} from './dom.js';\nimport {listenOnce, unlistenByKey} from './events.js';\nimport EventType from './events/EventType.js';\n\n\nvar ImageTile = /*@__PURE__*/(function (Tile) {\n  function ImageTile(tileCoord, state, src, crossOrigin, tileLoadFunction, opt_options) {\n\n    Tile.call(this, tileCoord, state, opt_options);\n\n    /**\n     * @private\n     * @type {?string}\n     */\n    this.crossOrigin_ = crossOrigin;\n\n    /**\n     * Image URI\n     *\n     * @private\n     * @type {string}\n     */\n    this.src_ = src;\n\n    /**\n     * @private\n     * @type {HTMLImageElement|HTMLCanvasElement}\n     */\n    this.image_ = new Image();\n    if (crossOrigin !== null) {\n      this.image_.crossOrigin = crossOrigin;\n    }\n\n    /**\n     * @private\n     * @type {Array<import(\"./events.js\").EventsKey>}\n     */\n    this.imageListenerKeys_ = null;\n\n    /**\n     * @private\n     * @type {import(\"./Tile.js\").LoadFunction}\n     */\n    this.tileLoadFunction_ = tileLoadFunction;\n\n  }\n\n  if ( Tile ) ImageTile.__proto__ = Tile;\n  ImageTile.prototype = Object.create( Tile && Tile.prototype );\n  ImageTile.prototype.constructor = ImageTile;\n\n  /**\n   * @inheritDoc\n   */\n  ImageTile.prototype.disposeInternal = function disposeInternal () {\n    if (this.state == TileState.LOADING) {\n      this.unlistenImage_();\n      this.image_ = getBlankImage();\n    }\n    if (this.interimTile) {\n      this.interimTile.dispose();\n    }\n    this.state = TileState.ABORT;\n    this.changed();\n    Tile.prototype.disposeInternal.call(this);\n  };\n\n  /**\n   * Get the HTML image element for this tile (may be a Canvas, Image, or Video).\n   * @return {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} Image.\n   * @api\n   */\n  ImageTile.prototype.getImage = function getImage () {\n    return this.image_;\n  };\n\n  /**\n   * @inheritDoc\n   */\n  ImageTile.prototype.getKey = function getKey () {\n    return this.src_;\n  };\n\n  /**\n   * Tracks loading or read errors.\n   *\n   * @private\n   */\n  ImageTile.prototype.handleImageError_ = function handleImageError_ () {\n    this.state = TileState.ERROR;\n    this.unlistenImage_();\n    this.image_ = getBlankImage();\n    this.changed();\n  };\n\n  /**\n   * Tracks successful image load.\n   *\n   * @private\n   */\n  ImageTile.prototype.handleImageLoad_ = function handleImageLoad_ () {\n    var image = /** @type {HTMLImageElement} */ (this.image_);\n    if (image.naturalWidth && image.naturalHeight) {\n      this.state = TileState.LOADED;\n    } else {\n      this.state = TileState.EMPTY;\n    }\n    this.unlistenImage_();\n    this.changed();\n  };\n\n  /**\n   * @inheritDoc\n   * @api\n   */\n  ImageTile.prototype.load = function load () {\n    if (this.state == TileState.ERROR) {\n      this.state = TileState.IDLE;\n      this.image_ = new Image();\n      if (this.crossOrigin_ !== null) {\n        this.image_.crossOrigin = this.crossOrigin_;\n      }\n    }\n    if (this.state == TileState.IDLE) {\n      this.state = TileState.LOADING;\n      this.changed();\n      this.imageListenerKeys_ = [\n        listenOnce(this.image_, EventType.ERROR,\n          this.handleImageError_, this),\n        listenOnce(this.image_, EventType.LOAD,\n          this.handleImageLoad_, this)\n      ];\n      this.tileLoadFunction_(this, this.src_);\n    }\n  };\n\n  /**\n   * Discards event handlers which listen for load completion or errors.\n   *\n   * @private\n   */\n  ImageTile.prototype.unlistenImage_ = function unlistenImage_ () {\n    this.imageListenerKeys_.forEach(unlistenByKey);\n    this.imageListenerKeys_ = null;\n  };\n\n  return ImageTile;\n}(Tile));\n\n\n/**\n * Get a 1-pixel blank image.\n * @return {HTMLCanvasElement} Blank image.\n */\nfunction getBlankImage() {\n  var ctx = createCanvasContext2D(1, 1);\n  ctx.fillStyle = 'rgba(0,0,0,0)';\n  ctx.fillRect(0, 0, 1, 1);\n  return ctx.canvas;\n}\n\nexport default ImageTile;\n\n//# sourceMappingURL=ImageTile.js.map","/**\n * @module ol/AssertionError\n */\nimport {VERSION} from './util.js';\n\n/**\n * Error object thrown when an assertion failed. This is an ECMA-262 Error,\n * extended with a `code` property.\n * See https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error.\n */\nvar AssertionError = /*@__PURE__*/(function (Error) {\n  function AssertionError(code) {\n    var path = VERSION === 'latest' ? VERSION : 'v' + VERSION.split('-')[0];\n    var message = 'Assertion failed. See https://openlayers.org/en/' + path +\n    '/doc/errors/#' + code + ' for details.';\n\n    Error.call(this, message);\n\n    /**\n     * Error code. The meaning of the code can be found on\n     * https://openlayers.org/en/latest/doc/errors/ (replace `latest` with\n     * the version found in the OpenLayers script's header comment if a version\n     * other than the latest is used).\n     * @type {number}\n     * @api\n     */\n    this.code = code;\n\n    /**\n     * @type {string}\n     */\n    this.name = 'AssertionError';\n\n    // Re-assign message, see https://github.com/Rich-Harris/buble/issues/40\n    this.message = message;\n  }\n\n  if ( Error ) AssertionError.__proto__ = Error;\n  AssertionError.prototype = Object.create( Error && Error.prototype );\n  AssertionError.prototype.constructor = AssertionError;\n\n  return AssertionError;\n}(Error));\n\nexport default AssertionError;\n\n//# sourceMappingURL=AssertionError.js.map","/**\n * @module ol/ImageState\n */\n\n/**\n * @enum {number}\n */\nexport default {\n  IDLE: 0,\n  LOADING: 1,\n  LOADED: 2,\n  ERROR: 3\n};\n\n//# sourceMappingURL=ImageState.js.map","/** @namespace  ol.ext\r\n */\r\n/*global ol*/\r\nif (window.ol && !ol.ext) {\r\n  ol.ext = {};\r\n}\r\n\r\n/** Inherit the prototype methods from one constructor into another.\r\n * replace deprecated ol method\r\n *\r\n * @param {!Function} childCtor Child constructor.\r\n * @param {!Function} parentCtor Parent constructor.\r\n * @function module:ol.inherits\r\n * @api\r\n */\r\nvar ol_ext_inherits = function(child,parent) {\r\n  child.prototype = Object.create(parent.prototype);\r\n  child.prototype.constructor = child;\r\n};\r\n\r\n// Compatibilty with ol > 5 to be removed when v6 is out\r\nif (window.ol) {\r\n  if (!ol.inherits) ol.inherits = ol_ext_inherits;\r\n}\r\n\r\n/* IE Polyfill */\r\n// NodeList.forEach\r\nif (window.NodeList && !NodeList.prototype.forEach) {\r\n  NodeList.prototype.forEach = Array.prototype.forEach;\r\n}\r\n// Element.remove\r\nif (window.Element && !Element.prototype.remove) {\r\n  Element.prototype.remove = function() {\r\n    if (this.parentNode) this.parentNode.removeChild(this);\r\n  }\r\n}\r\n/* End Polyfill */\r\n\r\nexport {ol_ext_inherits}\r\nexport default ol_ext_inherits\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO,\r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Button from './Button'\r\n\r\n/** A simple toggle control\r\n * The control can be created with an interaction to control its activation.\r\n *\r\n * @constructor\r\n * @extends {ol_control_Button}\r\n * @fires change:active, change:disable\r\n * @param {Object=} options Control options.\r\n *  @param {String} options.className class of the control\r\n *  @param {String} options.title title of the control\r\n *  @param {String} options.html html to insert in the control\r\n *  @param {ol.interaction} options.interaction interaction associated with the control\r\n *  @param {bool} options.active the control is created active, default false\r\n *  @param {bool} options.disable the control is created disabled, default false\r\n *  @param {ol.control.Bar} options.bar a subbar associated with the control (drawn when active if control is nested in a ol.control.Bar)\r\n *  @param {bool} options.autoActive the control will activate when shown in an ol.control.Bar, default false\r\n *  @param {function} options.onToggle callback when control is clicked (or use change:active event)\r\n */\r\nvar ol_control_Toggle = function(options) {\r\n  options = options || {};\r\n  var self = this;\r\n\r\n  this.interaction_ = options.interaction;\r\n  if (this.interaction_) {\r\n    this.interaction_.setActive(options.active);\r\n    this.interaction_.on(\"change:active\", function() {\r\n      self.setActive(self.interaction_.getActive());\r\n    });\r\n  }\r\n\r\n  if (options.toggleFn) options.onToggle = options.toggleFn; // compat old version\r\n  options.handleClick = function() {\r\n    self.toggle();\r\n    if (options.onToggle) options.onToggle.call(self, self.getActive());\r\n  };\r\n  options.className = (options.className||\"\") + \" ol-toggle\";\r\n  ol_control_Button.call(this, options);\r\n\r\n  this.set(\"title\", options.title);\r\n\r\n  this.set (\"autoActivate\", options.autoActivate);\r\n  if (options.bar) this.setSubBar(options.bar);\r\n\r\n  this.setActive (options.active);\r\n  this.setDisable (options.disable);\r\n};\r\nol_ext_inherits(ol_control_Toggle, ol_control_Button);\r\n\r\n/**\r\n * Set the map instance the control is associated with\r\n * and add interaction attached to it to this map.\r\n * @param {_ol_Map_} map The map instance.\r\n */\r\nol_control_Toggle.prototype.setMap = function(map) {\r\n  if (!map && this.getMap()) {\r\n    if (this.interaction_) {\r\n      this.getMap().removeInteraction (this.interaction_);\r\n    }\r\n    if (this.subbar_) this.getMap().removeControl (this.subbar_);\r\n  }\r\n\r\n  ol_control_Button.prototype.setMap.call(this, map);\r\n\r\n  if (map) {\r\n    if (this.interaction_) map.addInteraction (this.interaction_);\r\n    if (this.subbar_) map.addControl (this.subbar_);\r\n  }\r\n};\r\n\r\n/** Get the subbar associated with a control\r\n * @return {ol_control_Bar}\r\n */\r\nol_control_Toggle.prototype.getSubBar = function () {\r\n  return this.subbar_;\r\n};\r\n\r\n/** Set the subbar associated with a control\r\n * @param {ol_control_Bar} bar a subbar\r\n */\r\nol_control_Toggle.prototype.setSubBar = function (bar) {\r\n  var map = this.getMap();\r\n  if (map && this.subbar_) map.removeControl (this.subbar_);\r\n  this.subbar_ = bar;\r\n  this.subbar_.setTarget(this.element);\r\n  this.subbar_.element.classList.add(\"ol-option-bar\");\r\n  if (map) map.addControl (this.subbar_);\r\n};\r\n\r\n/**\r\n * Test if the control is disabled.\r\n * @return {bool}.\r\n * @api stable\r\n */\r\nol_control_Toggle.prototype.getDisable = function() {\r\n  var button = this.element.querySelector(\"button\");\r\n  return button && button.disabled;\r\n};\r\n\r\n/** Disable the control. If disable, the control will be deactivated too.\r\n* @param {bool} b disable (or enable) the control, default false (enable)\r\n*/\r\nol_control_Toggle.prototype.setDisable = function(b) {\r\n  if (this.getDisable()==b) return;\r\n  this.element.querySelector(\"button\").disabled = b;\r\n  if (b && this.getActive()) this.setActive(false);\r\n\r\n  this.dispatchEvent({ type:'change:disable', key:'disable', oldValue:!b, disable:b });\r\n};\r\n\r\n/**\r\n * Test if the control is active.\r\n * @return {bool}.\r\n * @api stable\r\n */\r\nol_control_Toggle.prototype.getActive = function() {\r\n  return this.element.classList.contains(\"ol-active\");\r\n};\r\n\r\n/** Toggle control state active/deactive\r\n */\r\nol_control_Toggle.prototype.toggle = function() {\r\n  if (this.getActive()) this.setActive(false);\r\n  else this.setActive(true);\r\n};\r\n\r\n/** Change control state\r\n * @param {bool} b activate or deactivate the control, default false\r\n */\r\nol_control_Toggle.prototype.setActive = function(b) {\t\r\n  if (this.interaction_) this.interaction_.setActive (b);\r\n  if (this.subbar_) this.subbar_.setActive(b);\r\n  if (this.getActive()===b) return;\r\n  if (b) this.element.classList.add(\"ol-active\");\r\n  else this.element.classList.remove(\"ol-active\");\r\n\r\n  this.dispatchEvent({ type:'change:active', key:'active', oldValue:!b, active:b });\r\n};\r\n\r\n/** Set the control interaction\r\n* @param {_ol_interaction_} i interaction to associate with the control\r\n*/\r\nol_control_Toggle.prototype.setInteraction = function(i) {\r\n  this.interaction_ = i;\r\n};\r\n\r\n/** Get the control interaction\r\n* @return {_ol_interaction_} interaction associated with the control\r\n*/\r\nol_control_Toggle.prototype.getInteraction = function() {\r\n  return this.interaction_;\r\n};\r\n\r\nexport default ol_control_Toggle\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO,\r\n\treleased under the CeCILL-B license (French BSD license)\r\n\t(http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Button from \"./Button\";\r\n\r\n/** A simple push button control drawn as text\r\n * @constructor\r\n * @extends {ol_control_Button}\r\n * @param {Object=} options Control options.\r\n *\t@param {String} options.className class of the control\r\n *\t@param {String} options.title title of the control\r\n *\t@param {String} options.html html to insert in the control\r\n *\t@param {function} options.handleClick callback when control is clicked (or use change:active event)\r\n */\r\n\r\nvar ol_control_TextButton = function(options)\r\n{\toptions = options || {};\r\n    options.className = (options.className||\"\") + \" ol-text-button\";\r\n    ol_control_Button.call(this, options);\r\n};\r\nol_ext_inherits(ol_control_TextButton, ol_control_Button);\r\n\r\nexport default ol_control_TextButton\r\n","/*\tCopyright (c) 2018 Jean-Marc VIGLINO, \r\n\treleased under the CeCILL-B license (French BSD license)\r\n\t(http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Select from 'ol/interaction/Select'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\n\r\n/** A Select interaction to delete features on click.\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires deletestart\r\n * @fires deleteend\r\n * @param {*} options ol.interaction.Select options\r\n */\r\nvar ol_interaction_Delete = function(options) {\r\n  ol_interaction_Select.call(this, options);\r\n  this.on('select', function(e) {\r\n    this.getFeatures().clear();\r\n    this.delete(e.selected);\r\n  }.bind(this));\r\n};\r\nol_ext_inherits(ol_interaction_Delete, ol_interaction_Select);\r\n\r\n/** Get vector source of the map\r\n * @return {Array<ol.source.Vector>}\r\n */\r\nol_interaction_Delete.prototype._getSources = function(layers) {\r\n  if (!this.getMap()) return [];\r\n  if (!layers) layers = this.getMap().getLayers();\r\n  var sources = [];\r\n  layers.forEach(function (l) {\r\n    // LayerGroup\r\n    if (l.getLayers) {\r\n      sources = sources.concat(this._getSources(l.getLayers()));\r\n    } else {\r\n      if (l.getSource && l.getSource() instanceof ol_source_Vector) {\r\n        sources.push(l.getSource());\r\n      }\r\n    }\r\n  }.bind(this));\r\n  return sources;\r\n};\r\n\r\n/** Delete features: remove the features from the map (from all layers in the map)\r\n * @param {ol.Collection<ol.Feature>|Array<ol.Feature>} features The features to delete\r\n * @api\r\n */\r\nol_interaction_Delete.prototype.delete = function(features) {\r\n  if (features && (features.length || features.getLength())) {\r\n    this.dispatchEvent({ type: 'deletestart', features: features });\r\n    var delFeatures = [];\r\n    // Get the sources concerned\r\n    this._getSources().forEach(function (source) {\r\n      try {\r\n        // Try to delete features in the source\r\n        features.forEach(function(f) {\r\n          source.removeFeature(f);\r\n          delFeatures.push(f);\r\n        });\r\n      } catch(e) { /* ok */ }\r\n    })\r\n    this.dispatchEvent({ type: 'deleteend', features: delFeatures });\r\n  }\r\n};\r\n\r\nexport default ol_interaction_Delete","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n\r\n  Usefull function to handle geometric operations\r\n*/\r\n\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_geom_LinearRing from 'ol/geom/LinearRing'\r\nimport ol_geom_MultiLineString from 'ol/geom/MultiLineString'\r\nimport ol_geom_MultiPoint from 'ol/geom/MultiPoint'\r\nimport ol_geom_MultiPolygon from 'ol/geom/MultiPolygon'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport ol_geom_Circle from 'ol/geom/Circle'\r\nimport {getCenter as ol_extent_getCenter} from 'ol/extent'\r\nimport {buffer as ol_extent_buffer} from 'ol/extent'\r\n\r\n/** Distance beetween 2 points\r\n *\tUsefull geometric functions\r\n * @param {ol.Coordinate} p1 first point\r\n * @param {ol.Coordinate} p2 second point\r\n * @return {number} distance\r\n */\r\nvar ol_coordinate_dist2d = function(p1, p2) {\r\n  var dx = p1[0]-p2[0];\r\n  var dy = p1[1]-p2[1];\r\n  return Math.sqrt(dx*dx+dy*dy);\r\n}\r\n\r\n/** 2 points are equal\r\n *\tUsefull geometric functions\r\n * @param {ol.Coordinate} p1 first point\r\n * @param {ol.Coordinate} p2 second point\r\n * @return {boolean}\r\n */\r\nvar ol_coordinate_equal = function(p1, p2) {\r\n  return (p1[0]==p2[0] && p1[1]==p2[1]);\r\n}\r\n\r\n/** Get center coordinate of a feature\r\n * @param {ol.Feature} f\r\n * @return {ol.coordinate} the center\r\n */\r\nvar ol_coordinate_getFeatureCenter = function(f) {\r\n  return ol_coordinate_getGeomCenter (f.getGeometry());\r\n};\r\n\r\n/** Get center coordinate of a geometry\r\n* @param {ol.geom.Geometry} geom\r\n* @return {ol.Coordinate} the center\r\n*/\r\nvar ol_coordinate_getGeomCenter = function(geom) {\r\n  switch (geom.getType()) {\r\n    case 'Point': \r\n      return geom.getCoordinates();\r\n    case \"MultiPolygon\":\r\n      geom = geom.getPolygon(0);\r\n      // fallthrough\r\n    case \"Polygon\":\r\n      return geom.getInteriorPoint().getCoordinates();\r\n    default:\r\n      return geom.getClosestPoint(ol_extent_getCenter(geom.getExtent()));\r\n  }\r\n};\r\n\r\n/** Offset a polyline\r\n * @param {Array<ol.Coordinate>} coords\r\n * @param {number} offset\r\n * @return {Array<ol.Coordinate>} resulting coord\r\n * @see http://stackoverflow.com/a/11970006/796832\r\n * @see https://drive.google.com/viewerng/viewer?a=v&pid=sites&srcid=ZGVmYXVsdGRvbWFpbnxqa2dhZGdldHN0b3JlfGd4OjQ4MzI5M2Y0MjNmNzI2MjY\r\n */\r\nvar ol_coordinate_offsetCoords = function (coords, offset) {\r\n  var path = [];\r\n  var N = coords.length-1;\r\n  var max = N;\r\n  var mi, mi1, li, li1, ri, ri1, si, si1, Xi1, Yi1;\r\n  var p0, p1, p2;\r\n  var isClosed = ol_coordinate_equal(coords[0],coords[N]);\r\n  if (!isClosed) {\r\n    p0 = coords[0];\r\n    p1 = coords[1];\r\n    p2 = [\r\n      p0[0] + (p1[1] - p0[1]) / ol_coordinate_dist2d(p0,p1) *offset,\r\n      p0[1] - (p1[0] - p0[0]) / ol_coordinate_dist2d(p0,p1) *offset\r\n    ];\r\n    path.push(p2);\r\n    coords.push(coords[N])\r\n    N++;\r\n    max--;\r\n  }\r\n  for (var i = 0; i < max; i++) {\r\n    p0 = coords[i];\r\n    p1 = coords[(i+1) % N];\r\n    p2 = coords[(i+2) % N];\r\n\r\n    mi = (p1[1] - p0[1])/(p1[0] - p0[0]);\r\n    mi1 = (p2[1] - p1[1])/(p2[0] - p1[0]);\r\n    // Prevent alignements\r\n    if (Math.abs(mi-mi1) > 1e-10) {\r\n      li = Math.sqrt((p1[0] - p0[0])*(p1[0] - p0[0])+(p1[1] - p0[1])*(p1[1] - p0[1]));\r\n      li1 = Math.sqrt((p2[0] - p1[0])*(p2[0] - p1[0])+(p2[1] - p1[1])*(p2[1] - p1[1]));\r\n      ri = p0[0] + offset*(p1[1] - p0[1])/li;\r\n      ri1 = p1[0] + offset*(p2[1] - p1[1])/li1;\r\n      si = p0[1] - offset*(p1[0] - p0[0])/li;\r\n      si1 = p1[1] - offset*(p2[0] - p1[0])/li1;\r\n      Xi1 = (mi1*ri1-mi*ri+si-si1) / (mi1-mi);\r\n      Yi1 = (mi*mi1*(ri1-ri)+mi1*si-mi*si1) / (mi1-mi);\r\n\r\n      // Correction for vertical lines\r\n      if(p1[0] - p0[0] == 0) {\r\n        Xi1 = p1[0] + offset*(p1[1] - p0[1])/Math.abs(p1[1] - p0[1]);\r\n        Yi1 = mi1*Xi1 - mi1*ri1 + si1;\r\n      }\r\n      if (p2[0] - p1[0] == 0 ) {\r\n        Xi1 = p2[0] + offset*(p2[1] - p1[1])/Math.abs(p2[1] - p1[1]);\r\n        Yi1 = mi*Xi1 - mi*ri + si;\r\n      }\r\n\r\n      path.push([Xi1, Yi1]);\r\n    }\r\n  }\r\n  if (isClosed) {\r\n    path.push(path[0]);\r\n  } else {\r\n    coords.pop();\r\n    p0 = coords[coords.length-1];\r\n    p1 = coords[coords.length-2];\r\n    p2 = [\r\n      p0[0] - (p1[1] - p0[1]) / ol_coordinate_dist2d(p0,p1) *offset,\r\n      p0[1] + (p1[0] - p0[0]) / ol_coordinate_dist2d(p0,p1) *offset\r\n    ];\r\n    path.push(p2);\r\n  }\r\n  return path;\r\n}\r\n\r\n/** Find the segment a point belongs to\r\n * @param {ol.Coordinate} pt\r\n * @param {Array<ol.Coordinate>} coords\r\n * @return {} the index (-1 if not found) and the segment\r\n */\r\nvar ol_coordinate_findSegment = function (pt, coords) {\r\n  for (var i=0; i<coords.length-1; i++) {\r\n    var p0 = coords[i];\r\n    var p1 = coords[i+1];\r\n    if (ol_coordinate_equal(pt, p0) || ol_coordinate_equal(pt, p1)) {\r\n      return { index:1, segment: [p0,p1] };\r\n    } else {\r\n      var d0 = ol_coordinate_dist2d(p0,p1);\r\n      var v0 = [ (p1[0] - p0[0]) / d0, (p1[1] - p0[1]) / d0 ];\r\n      var d1 = ol_coordinate_dist2d(p0,pt);\r\n      var v1 = [ (pt[0] - p0[0]) / d1, (pt[1] - p0[1]) / d1 ];\r\n      if (Math.abs(v0[0]*v1[1] - v0[1]*v1[0]) < 1e-10) {\r\n        return { index:1, segment: [p0,p1] };\r\n      }\r\n    }\r\n  }\r\n  return { index: -1 };\r\n};\r\n\r\n/**\r\n * Split a Polygon geom with horizontal lines\r\n * @param {Array<ol.Coordinate>} geom\r\n * @param {number} y the y to split\r\n * @param {number} n contour index\r\n * @return {Array<Array<ol.Coordinate>>}\r\n */\r\nvar ol_coordinate_splitH = function (geom, y, n) {\r\n  var x, abs;\r\n  var list = [];\r\n  for (var i=0; i<geom.length-1; i++) {\r\n    // Hole separator?\r\n    if (!geom[i].length || !geom[i+1].length) continue;\r\n    // Intersect\r\n    if (geom[i][1]<=y && geom[i+1][1]>y || geom[i][1]>=y && geom[i+1][1]<y) {\r\n      abs = (y-geom[i][1]) / (geom[i+1][1]-geom[i][1]);\r\n      x = abs * (geom[i+1][0]-geom[i][0]) + geom[i][0];\r\n      list.push ({ contour: n, index: i, pt: [x,y], abs: abs });\r\n    }\r\n  }\r\n  // Sort x\r\n  list.sort(function(a,b) { return a.pt[0] - b.pt[0] });\r\n  // Horizontal segment\r\n  var result = [];\r\n  for (var j=0; j<list.length-1; j += 2) {\r\n    result.push([list[j], list[j+1]])\r\n  }\r\n  return result;\r\n};\r\n\r\n/** Create a geometry given a type and coordinates */\r\nvar ol_geom_createFromType = function (type, coordinates) {\r\n  switch (type) {\r\n    case 'LineString': return new ol_geom_LineString(coordinates);\r\n    case 'LinearRing': return new ol_geom_LinearRing(coordinates);\r\n    case 'MultiLineString': return new ol_geom_MultiLineString(coordinates);\r\n    case 'MultiPoint': return new ol_geom_MultiPoint(coordinates);\r\n    case 'MultiPolygon': return new ol_geom_MultiPolygon(coordinates);\r\n    case 'Point': return new ol_geom_Point(coordinates);\r\n    case 'Polygon': return new ol_geom_Polygon(coordinates);\r\n    default:\r\n      console.error('[createFromType] Unsupported type: '+type);\r\n      return null;\r\n  }\r\n};\r\n\r\nexport {ol_geom_createFromType}\r\nexport {ol_coordinate_dist2d, ol_coordinate_equal, ol_coordinate_findSegment, ol_coordinate_getFeatureCenter, ol_coordinate_getGeomCenter, ol_coordinate_offsetCoords, ol_coordinate_splitH}\r\n\r\n/** Intersect 2 lines\r\n * @param {Arrar<ol.coordinate>} d1\r\n * @param {Arrar<ol.coordinate>} d2\r\n */\r\nvar ol_coordinate_getIntersectionPoint = function (d1, d2) {\r\n  var d1x = d1[1][0] - d1[0][0];\r\n  var d1y = d1[1][1] - d1[0][1];\r\n  var d2x = d2[1][0] - d2[0][0];\r\n  var d2y = d2[1][1] - d2[0][1];\r\n  var det = d1x * d2y - d1y * d2x;\r\n  if (det != 0) {\r\n    var k = (d1x * d1[0][1] - d1x * d2[0][1] - d1y * d1[0][0] + d1y * d2[0][0]) / det;\r\n    return [d2[0][0] + k*d2x, d2[0][1] + k*d2y];\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\nexport { ol_coordinate_getIntersectionPoint }\r\n\r\nvar ol_extent_intersection;\r\n\r\n(function() {\r\n// Split at x\r\nfunction splitX(pts, x) {\r\n  var pt;\r\n  for (let i=pts.length-1; i>0; i--) {\r\n    if ((pts[i][0]>x && pts[i-1][0]<x) || (pts[i][0]<x && pts[i-1][0]>x)) {\r\n      pt = [ x, (x - pts[i][0]) / (pts[i-1][0]-pts[i][0]) * (pts[i-1][1]-pts[i][1]) + pts[i][1]];\r\n      pts.splice(i, 0, pt);\r\n    }\r\n  }\r\n}\r\n// Split at y\r\nfunction splitY(pts, y) {\r\n  var pt;\r\n  for (let i=pts.length-1; i>0; i--) {\r\n    if ((pts[i][1]>y && pts[i-1][1]<y) || (pts[i][1]<y && pts[i-1][1]>y)) {\r\n      pt = [ (y - pts[i][1]) / (pts[i-1][1]-pts[i][1]) * (pts[i-1][0]-pts[i][0]) + pts[i][0], y];\r\n      pts.splice(i, 0, pt);\r\n    }\r\n  }\r\n}\r\n\r\n/** Fast polygon intersection with an extent (used for area calculation)\r\n * @param {ol_extent_Extent} extent\r\n * @param {ol_geom_Polygon|ol_geom_MultiPolygon} polygon\r\n * @returns {ol_geom_Polygon|ol_geom_MultiPolygon|null} return null if not a polygon geometry\r\n */\r\nol_extent_intersection = function(extent, polygon) {\r\n  var poly = (polygon.getType() === 'Polygon');\r\n  if (!poly && polygon.getType() !== 'MultiPolygon') return null;\r\n  var geom = polygon.getCoordinates();\r\n  if (poly) geom = [geom];\r\n  geom.forEach(function(g) {\r\n    g.forEach(function(c) {\r\n      splitX(c, extent[0]);\r\n      splitX(c, extent[2]);\r\n      splitY(c, extent[1]);\r\n      splitY(c, extent[3]);\r\n    });\r\n  })\r\n  // Snap geom to the extent \r\n  geom.forEach(function(g) {\r\n    g.forEach(function(c) {\r\n      c.forEach(function(p) {\r\n        if (p[0]<extent[0]) p[0] = extent[0];\r\n        else if (p[0]>extent[2]) p[0] = extent[2];\r\n        if (p[1]<extent[1]) p[1] = extent[1];\r\n        else if (p[1]>extent[3]) p[1] = extent[3];\r\n      })\r\n    })\r\n  })\r\n  if (poly) {\r\n    return new ol_geom_Polygon(geom[0]);\r\n  } else {\r\n    return new ol_geom_MultiPolygon(geom);\r\n  }\r\n};\r\n})();\r\n\r\nexport {ol_extent_intersection}\r\n\r\n/** Add points along a segment\r\n * @param {ol_Coordinate} p1 \r\n * @param {ol_Coordinate} p2 \r\n * @param {number} d \r\n * @param {boolean} start include starting point, default true\r\n * @returns {Array<ol_Coordinate>}\r\n */\r\nvar ol_coordinate_sampleAt = function(p1, p2, d, start) {\r\n  var pts = [];\r\n  if (start!==false) pts.push(p1);\r\n  var dl = ol_coordinate_dist2d(p1,p2);\r\n  if (dl) {\r\n    var nb = Math.round(dl/d);\r\n    if (nb>1) {\r\n      var dx = (p2[0]-p1[0]) / nb;\r\n      var dy = (p2[1]-p1[1]) / nb;\r\n      for (var i=1; i<nb; i++) {\r\n        pts.push([p1[0] + dx*i, p1[1] + dy*i])\r\n      }\r\n    }\r\n  }\r\n  pts.push(p2);\r\n  return pts;\r\n};\r\nexport { ol_coordinate_sampleAt }\r\n\r\n/** Sample a Polygon at a distance\r\n * @param {number} d\r\n * @returns {ol_geom_Polygon}\r\n */\r\nol_geom_Polygon.prototype.sampleAt = function(res) {\r\n  var poly = this.getCoordinates();\r\n  var result = [];\r\n  poly.forEach(function(p) {\r\n    var l = [];\r\n    for (var i=1; i<p.length; i++) {\r\n      l = l.concat(ol_coordinate_sampleAt(p[i-1], p[i], res, i===1));\r\n    }\r\n    result.push(l);\r\n  })\r\n  return new ol_geom_Polygon(result);\r\n};\r\n\r\n/** Sample a MultiPolygon at a distance\r\n * @param {number} res\r\n * @returns {ol_geom_MultiPolygon}\r\n */\r\nol_geom_MultiPolygon.prototype.sampleAt = function(res) {\r\n  var mpoly = this.getCoordinates();\r\n  var result = [];\r\n  mpoly.forEach(function(poly) {\r\n    var a = [];\r\n    result.push(a);\r\n    poly.forEach(function(p) {\r\n      var l = [];\r\n      for (var i=1; i<p.length; i++) {\r\n        l = l.concat(ol_coordinate_sampleAt(p[i-1], p[i], res, i===1));\r\n      }\r\n      a.push(l);\r\n    })\r\n  });\r\n  return new ol_geom_MultiPolygon(result);\r\n};\r\n\r\n/** Intersect a geometry using a circle\r\n * @param {ol_geom_Geometry} geom\r\n * @param {number} resolution circle resolution to sample the polygon on the circle, default 1\r\n * @returns {ol_geom_Geometry}\r\n */\r\nol_geom_Circle.prototype.intersection = function(geom, resolution) {\r\n  if (geom.sampleAt) {\r\n    var ext = ol_extent_buffer(this.getCenter().concat(this.getCenter()), this.getRadius());\r\n    geom = ol_extent_intersection(ext, geom);\r\n    geom = geom.simplify(resolution);\r\n    var c = this.getCenter();\r\n    var r = this.getRadius();\r\n    //var res = (resolution||1) * r / 100;\r\n    var g = geom.sampleAt(resolution).getCoordinates();\r\n    switch (geom.getType()) {\r\n      case 'Polygon': g = [g];\r\n        // fallthrough\r\n      case 'MultiPolygon': {\r\n        var hasout = false;\r\n        // var hasin = false;\r\n        var result = [];\r\n        g.forEach(function(poly) {\r\n          var a = [];\r\n          result.push(a);\r\n          poly.forEach(function(ring) {\r\n            var l = [];\r\n            a.push(l);\r\n            ring.forEach(function(p) {\r\n              var d = ol_coordinate_dist2d(c, p);\r\n              if (d > r) {\r\n                hasout = true;\r\n                l.push([\r\n                  c[0] + r / d * (p[0]-c[0]),\r\n                  c[1] + r / d * (p[1]-c[1])\r\n                ]);\r\n              } else {\r\n                // hasin = true;\r\n                l.push(p);\r\n              }\r\n            });\r\n          })\r\n        });\r\n        if (!hasout) return geom;\r\n        if (geom.getType() === 'Polygon') {\r\n          return new ol_geom_Polygon(result[0]);\r\n        } else {\r\n          return new ol_geom_MultiPolygon(result);\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    console.warn('[ol/geom/Circle~intersection] Unsupported geometry type: '+geom.getType());\r\n  }\r\n  return geom;\r\n};\r\n","import ol_style_Style from 'ol/style/Style'\r\nimport ol_style_Circle from 'ol/style/Circle'\r\nimport ol_style_Stroke from 'ol/style/Stroke'\r\nimport ol_style_Fill from 'ol/style/Fill'\r\n\r\nvar ol_style_Style_defaultStyle;\r\n\r\n(function() {\r\n\r\n// Style\r\nvar white = [255, 255, 255, 1];\r\nvar blue = [0, 153, 255, 1];\r\nvar width = 3;\r\n\r\nvar defaultEditStyle = [\r\n  new ol_style_Style({\r\n    stroke: new ol_style_Stroke({ color: white, width: width + 2 })\r\n  }),\r\n  new ol_style_Style({\r\n    image: new ol_style_Circle({\r\n      radius: width * 2,\r\n      fill: new ol_style_Fill({ color: blue }),\r\n      stroke: new ol_style_Stroke({ color: white, width: width / 2 })\r\n    }),\r\n    stroke: new ol_style_Stroke({ color: blue, width: width }),\r\n    fill: new ol_style_Fill({\r\n      color: [255, 255, 255, 0.5]\r\n    })\r\n  })\r\n];\r\n\r\n/**\r\n * Get the default style\r\n * @param {boolean|*} [edit] true to get editing style or a { color, fillColor } object, default get default blue style\r\n * @return {Array<ol.style.Style>}\r\n */\r\nol_style_Style_defaultStyle = function(edit) {\r\n  if (edit===true) {\r\n    return defaultEditStyle;\r\n  } else {\r\n    edit = edit || {};\r\n    var fill = new ol_style_Fill({\r\n      color: edit.fillColor || 'rgba(255,255,255,0.4)'\r\n    });\r\n    var stroke = new ol_style_Stroke({\r\n      color: edit.color || '#3399CC',\r\n      width: 1.25\r\n    });\r\n    var style = new ol_style_Style({\r\n      image: new ol_style_Circle({\r\n        fill: fill,\r\n        stroke: stroke,\r\n        radius: 5\r\n      }),\r\n      fill: fill,\r\n      stroke: stroke\r\n    });\r\n    return [ style ];\r\n  }\r\n};\r\n\r\n})();\r\n\r\nexport default ol_style_Style_defaultStyle\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n\treleased under the CeCILL-B license (French BSD license)\r\n\t(http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Pointer from 'ol/interaction/Pointer'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport {ol_coordinate_dist2d, ol_coordinate_findSegment, ol_coordinate_offsetCoords} from \"../geom/GeomUtils\";\r\n\r\nimport ol_style_Style_defaultStyle from '../style/defaultStyle'\r\n\r\n/** Offset interaction for offseting feature geometry\r\n * @constructor\r\n * @extends {ol_interaction_Pointer}\r\n * @fires offsetstart\r\n * @fires offsetting\r\n * @fires offsetend\r\n * @param {any} options\r\n *\t@param {ol.layer.Vector | Array<ol.layer.Vector>} options.layers list of feature to transform \r\n *\t@param {ol.Collection.<ol.Feature>} options.features collection of feature to transform\r\n *\t@param {ol.source.Vector | undefined} options.source source to duplicate feature when ctrl key is down\r\n *\t@param {boolean} options.duplicate force feature to duplicate (source must be set)\r\n *  @param {ol.style.Style | Array.<ol.style.Style> | ol.style.StyleFunction | undefined} style style for the sketch\r\n */\r\nvar ol_interaction_Offset = function(options) {\r\n  if (!options) options = {};\r\n\r\n\t// Extend pointer\r\n\tol_interaction_Pointer.call(this, {\r\n    handleDownEvent: this.handleDownEvent_,\r\n    handleDragEvent: this.handleDragEvent_,\r\n    handleMoveEvent: this.handleMoveEvent_,\r\n    handleUpEvent: this.handleUpEvent_\r\n  });\r\n    \r\n\t// Collection of feature to transform\r\n\tthis.features_ = options.features;\r\n\t// List of layers to transform\r\n  this.layers_ = options.layers ? (options.layers instanceof Array) ? options.layers:[options.layers] : null;\r\n  // duplicate\r\n  this.set('duplicate', options.duplicate);\r\n  this.source_ = options.source;\r\n  // Style\r\n  this._style = (typeof (options.style) === 'function') ? options.style : function () { \r\n    if (options.style) return options.style;\r\n    else return ol_style_Style_defaultStyle(true);\r\n  };\r\n\r\n  // init\r\n  this.previousCursor_ = false;\r\n};\r\nol_ext_inherits(ol_interaction_Offset, ol_interaction_Pointer);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_Offset.prototype.setMap = function(map) {\r\n\tol_interaction_Pointer.prototype.setMap.call (this, map);\r\n};\r\n\r\n/** Get Feature at pixel\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {any} a feature and the hit point\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.getFeatureAtPixel_ = function(e) {\r\n  var self = this;\r\n\treturn this.getMap().forEachFeatureAtPixel(e.pixel,\r\n\t\tfunction(feature, layer) {\r\n      var current;\r\n\t\t\t// feature belong to a layer\r\n\t\t\tif (self.layers_) {\r\n        for (var i=0; i<self.layers_.length; i++) {\r\n          if (self.layers_[i]===layer) {\r\n            current = feature;\r\n            break;\r\n          }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// feature in the collection\r\n\t\t\telse if (self.features_) {\r\n        self.features_.forEach (function(f) {\r\n          if (f===feature) {\r\n            current = feature \r\n          }\r\n        });\r\n\t\t\t}\r\n\t\t\t// Others\r\n\t\t\telse {\r\n        current = feature;\r\n      }\r\n\r\n      // Only poygon or linestring\r\n      var typeGeom = current.getGeometry().getType();\r\n      if (current && /Polygon|LineString/.test(typeGeom)) {\r\n        if (typeGeom==='Polygon' && current.getGeometry().getCoordinates().length>1) return false;\r\n        // test distance\r\n        var p = current.getGeometry().getClosestPoint(e.coordinate);\r\n        var dx = p[0]-e.coordinate[0];\r\n        var dy = p[1]-e.coordinate[1];\r\n        var d = Math.sqrt(dx*dx+dy*dy) / e.frameState.viewState.resolution;\r\n      \r\n        if (d<5) {\r\n          return { \r\n            feature: current, \r\n            hit: p, \r\n            coordinates: current.getGeometry().getCoordinates(),\r\n            geom: current.getGeometry().clone(),\r\n            geomType: typeGeom\r\n          }\r\n        } else {\r\n          return false;\r\n        }\r\n      } else {\r\n        return false;\r\n      }\r\n\t\t},  { hitTolerance: 5 });\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} e Map browser event.\r\n * @return {boolean} `true` to start the drag sequence.\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.handleDownEvent_ = function(e) {\t\r\n  this.current_ = this.getFeatureAtPixel_(e);\r\n  if (this.current_) {\r\n    this.currentStyle_ = this.current_.feature.getStyle();\r\n    if (this.source_ && (this.get('duplicate') || e.originalEvent.ctrlKey)) {\r\n      this.current_.feature = this.current_.feature.clone();\r\n      this.current_.feature.setStyle(this._style(this.current_.feature));\r\n      this.source_.addFeature(this.current_.feature);\r\n    } else {\r\n      // Modify the current feature\r\n      this.current_.feature.setStyle(this._style(this.current_.feature));\r\n      this._modifystart = true;\r\n    }\r\n    this.dispatchEvent({ type:'offsetstart', feature: this.current_.feature, offset: 0 });\r\n    return true;\r\n  } else  {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} e Map browser event.\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.handleDragEvent_ = function(e) {\r\n  if (this._modifystart) {\r\n    this.dispatchEvent({ type:'modifystart', features: [ this.current_.feature ] });\r\n    this._modifystart = false;\r\n  }\r\n  var p = this.current_.geom.getClosestPoint(e.coordinate);\r\n  var d = ol_coordinate_dist2d(p, e.coordinate);\r\n  var seg, v1, v2, offset;\r\n  switch (this.current_.geomType) {\r\n    case  'Polygon': {\r\n      seg = ol_coordinate_findSegment(p, this.current_.coordinates[0]).segment;\r\n      if (seg) {\r\n        v1 = [ seg[1][0]-seg[0][0], seg[1][1]-seg[0][1] ];\r\n        v2 = [ e.coordinate[0]-p[0], e.coordinate[1]-p[1] ];\r\n        if (v1[0]*v2[1] - v1[1]*v2[0] > 0) {\r\n          d = -d;\r\n        }\r\n\r\n        offset = [];\r\n        for (var i=0; i<this.current_.coordinates.length; i++) {\r\n          offset.push( ol_coordinate_offsetCoords(this.current_.coordinates[i], i==0 ? d : -d) );\r\n        }\r\n        this.current_.feature.setGeometry(new ol_geom_Polygon(offset));\r\n      }\r\n      break;\r\n    }\r\n    case 'LineString': {\r\n      seg = ol_coordinate_findSegment(p, this.current_.coordinates).segment;\r\n      if (seg) {\r\n        v1 = [ seg[1][0]-seg[0][0], seg[1][1]-seg[0][1] ];\r\n        v2 = [ e.coordinate[0]-p[0], e.coordinate[1]-p[1] ];\r\n        if (v1[0]*v2[1] - v1[1]*v2[0] > 0) {\r\n          d = -d;\r\n        }\r\n        offset = ol_coordinate_offsetCoords(this.current_.coordinates, d);\r\n        this.current_.feature.setGeometry(new ol_geom_LineString(offset));\r\n      }\r\n      break;\r\n    }\r\n    default: {\r\n      break;\r\n    }\r\n  }\r\n  this.dispatchEvent({ type:'offsetting', feature: this.current_.feature, offset: d, segment: [p, e.coordinate], coordinate: e.coordinate });  \r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} e Map browser event.\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.handleUpEvent_ = function(e) {\r\n  if (!this._modifystart) {\r\n    this.dispatchEvent({ type:'offsetend', feature: this.current_.feature, coordinate: e.coordinate }); \r\n  }\r\n  this.current_.feature.setStyle(this.currentStyle_);\r\n  this.current_ = false;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} e Event.\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.handleMoveEvent_ = function(e) {\t\r\n  var f = this.getFeatureAtPixel_(e);\r\n  if (f) {\r\n    if (this.previousCursor_ === false) {\r\n      this.previousCursor_ = e.map.getTargetElement().style.cursor;\r\n    }\r\n    e.map.getTargetElement().style.cursor = 'pointer';\r\n  } else {\r\n    e.map.getTargetElement().style.cursor = this.previousCursor_;\r\n    this.previousCursor_ = false;\r\n  }\r\n};\r\n\r\nexport default ol_interaction_Offset\r\n","import {ol_coordinate_equal} from \"./GeomUtils\";\r\nimport ol_geom_LineString from \"ol/geom/LineString\";\r\n\r\n/** Split a lineString by a point or a list of points\r\n *\tNB: points must be on the line, use getClosestPoint() to get one\r\n* @param {ol.Coordinate | Array<ol.Coordinate>} pt points to split the line\r\n* @param {Number} tol distance tolerance for 2 points to be equal\r\n*/\r\nol_geom_LineString.prototype.splitAt = function(pt, tol) {\r\n  var i;\r\n  if (!pt) return [this];\r\n    if (!tol) tol = 1e-10;\r\n    // Test if list of points\r\n    if (pt.length && pt[0].length) {\r\n      var result = [this];\r\n      for (i=0; i<pt.length; i++) {\r\n        var r = [];\r\n        for (var k=0; k<result.length; k++) {\r\n          var ri = result[k].splitAt(pt[i], tol);\r\n          r = r.concat(ri);\r\n        }\r\n        result = r;\r\n      }\r\n      return result;\r\n    }\r\n    // Nothing to do\r\n    if (ol_coordinate_equal(pt,this.getFirstCoordinate())\r\n    || ol_coordinate_equal(pt,this.getLastCoordinate())) {\r\n      return [this];\r\n    }\r\n    // Get\r\n    var c0 = this.getCoordinates();\r\n    var ci=[c0[0]];\r\n    var c = [];\r\n    for (i=0; i<c0.length-1; i++) {\r\n      // Filter equal points\r\n      if (ol_coordinate_equal(c0[i],c0[i+1])) continue;\r\n      // Extremity found\r\n      if (ol_coordinate_equal(pt,c0[i+1])) {\r\n        ci.push(c0[i+1]);\r\n        c.push(new ol_geom_LineString(ci));\r\n        ci = [];\r\n      }\r\n      // Test alignement\r\n      else if (!ol_coordinate_equal(pt,c0[i])) {\r\n        var d1, d2, split=false;\r\n        if (c0[i][0] == c0[i+1][0]) {\r\n          d1 = (c0[i][1]-pt[1]) / (c0[i][1]-c0[i+1][1]);\r\n          split = (c0[i][0] == pt[0]) && (0 < d1 && d1 <= 1)\r\n        } else if (c0[i][1] == c0[i+1][1]) {\r\n          d1 = (c0[i][0]-pt[0]) / (c0[i][0]-c0[i+1][0]);\r\n          split = (c0[i][1] == pt[1]) && (0 < d1 && d1 <= 1)\r\n        } else {\r\n          d1 = (c0[i][0]-pt[0]) / (c0[i][0]-c0[i+1][0]);\r\n          d2 = (c0[i][1]-pt[1]) / (c0[i][1]-c0[i+1][1]);\r\n          split = (Math.abs(d1-d2) <= tol && 0 < d1 && d1 <= 1)\r\n        }\r\n        // pt is inside the segment > split\r\n        if (split) {\r\n          ci.push(pt);\r\n          c.push (new ol_geom_LineString(ci));\r\n          ci = [pt];\r\n        }\r\n      }\r\n      ci.push(c0[i+1]);\r\n    }\r\n    if (ci.length>1) c.push (new ol_geom_LineString(ci));\r\n    if (c.length) return c;\r\n    else return [this];\r\n}\r\n\r\n// import('ol-ext/geom/LineStringSplitAt')","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Interaction from 'ol/interaction/Interaction'\r\nimport ol_style_Style from 'ol/style/Style'\r\nimport ol_style_Stroke from 'ol/style/Stroke'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\nimport ol_style_Fill from 'ol/style/Fill'\r\nimport ol_style_Circle from 'ol/style/Circle'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_Feature from 'ol/Feature'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport {ol_coordinate_dist2d} from \"../geom/GeomUtils\";\r\nimport '../geom/LineStringSplitAt'\r\n\r\n/** Interaction split interaction for splitting feature geometry\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires  beforesplit, aftersplit, pointermove\r\n * @param {*} \r\n *  @param {ol.source.Vector|Array<ol.source.Vector>} options.source a list of source to split (configured with useSpatialIndex set to true)\r\n *  @param {ol.Collection.<ol.Feature>} options.features collection of feature to split\r\n *  @param {integer} options.snapDistance distance (in px) to snap to an object, default 25px\r\n *\t@param {string|undefined} options.cursor cursor name to display when hovering an objet\r\n *  @param {function|undefined} opttion.filter a filter that takes a feature and return true if it can be clipped, default always split.\r\n *  @param ol_style_Style | Array<ol_style_Style> | false | undefined} options.featureStyle Style for the selected features, choose false if you don't want feature selection. By default the default edit style is used.\r\n *  @param {ol_style_Style | Array<ol_style_Style> | undefined} options.sketchStyle Style for the sektch features. \r\n *  @param {function|undefined} options.tolerance Distance between the calculated intersection and a vertex on the source geometry below which the existing vertex will be used for the split.  Default is 1e-10.\r\n */\r\nvar ol_interaction_Split = function(options) {\r\n  if (!options) options = {};\r\n\r\n  ol_interaction_Interaction.call(this, {\r\n    handleEvent: function(e) {\r\n      switch (e.type) {\r\n        case \"singleclick\":\r\n          return this.handleDownEvent(e);\r\n        case \"pointermove\":\r\n          return this.handleMoveEvent(e);\r\n        default: \r\n          return true;\r\n      }\r\n      //return true;\r\n    }\r\n  });\r\n\r\n  // Snap distance (in px)\r\n  this.snapDistance_ = options.snapDistance || 25;\r\n  // Split tolerance between the calculated intersection and the geometry\r\n  this.tolerance_ = options.tolerance || 1e-10;\r\n  // Cursor\r\n  this.cursor_ = options.cursor;\r\n\r\n  // List of source to split\r\n  this.sources_ = options.sources ? (options.sources instanceof Array) ? options.sources:[options.sources] : [];\r\n\r\n  if (options.features) {\r\n    this.sources_.push (new ol_source_Vector({ features: options.features }));\r\n  }\r\n\r\n  // Get all features candidate\r\n  this.filterSplit_ = options.filter || function(){ return true; };\r\n\r\n  // Default style\r\n  var white = [255, 255, 255, 1];\r\n  var blue = [0, 153, 255, 1];\r\n  var width = 3;\r\n  var fill = new ol_style_Fill({ color: 'rgba(255,255,255,0.4)' });\r\n  var stroke = new ol_style_Stroke({\r\n    color: '#3399CC',\r\n    width: 1.25\r\n  });\r\n  var sketchStyle = [\r\n    new ol_style_Style({\r\n      image: new ol_style_Circle({\r\n        fill: fill,\r\n        stroke: stroke,\r\n        radius: 5\r\n      }),\r\n      fill: fill,\r\n      stroke: stroke\r\n    })\r\n  ];\r\n  var featureStyle = [\r\n    new ol_style_Style({\r\n      stroke: new ol_style_Stroke({\r\n        color: white,\r\n        width: width + 2\r\n      })\r\n    }),\r\n    new ol_style_Style({\r\n      image: new ol_style_Circle({\r\n        radius: 2*width,\r\n        fill: new ol_style_Fill({\r\n          color: blue\r\n        }),\r\n        stroke: new ol_style_Stroke({\r\n          color: white,\r\n          width: width/2\r\n        })\r\n      }),\r\n      stroke: new ol_style_Stroke({\r\n          color: blue,\r\n          width: width\r\n        })\r\n    }),\r\n  ];\r\n\r\n  // Custom style\r\n  if (options.sketchStyle) sketchStyle = options.sketchStyle instanceof Array ? options.sketchStyle : [options.sketchStyle];\r\n  if (options.featureStyle) featureStyle = options.featureStyle instanceof Array ? options.featureStyle : [options.featureStyle];\r\n\r\n  // Create a new overlay for the sketch\r\n  this.overlayLayer_ = new ol_layer_Vector({\r\n    source: new ol_source_Vector({\r\n      useSpatialIndex: false\r\n    }),\r\n    name:'Split overlay',\r\n    displayInLayerSwitcher: false,\r\n    style: function(f) {\r\n      if (f._sketch_) return sketchStyle;\r\n      else return featureStyle;\r\n    }\r\n  });\r\n\r\n};\r\nol_ext_inherits(ol_interaction_Split, ol_interaction_Interaction);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_Split.prototype.setMap = function(map) {\r\n  if (this.getMap()) this.getMap().removeLayer(this.overlayLayer_);\r\n  ol_interaction_Interaction.prototype.setMap.call (this, map);\r\n  this.overlayLayer_.setMap(map);\r\n};\r\n\r\n/** Get closest feature at pixel\r\n * @param {ol.Pixel} \r\n * @return {ol.feature} \r\n * @private\r\n */\r\nol_interaction_Split.prototype.getClosestFeature = function(e) {\r\n  var source, f, c, g, d = this.snapDistance_+1;\r\n  // Look for closest point in the sources\r\n  this.sources_.forEach(function(si) {\r\n    var fi = si.getClosestFeatureToCoordinate(e.coordinate);\r\n    if (fi && fi.getGeometry().splitAt) {\r\n      var ci = fi.getGeometry().getClosestPoint(e.coordinate);\r\n      var gi = new ol_geom_LineString([e.coordinate,ci]);\r\n      var di = gi.getLength() / e.frameState.viewState.resolution;\r\n      if (di < d) {\r\n        source = si;\r\n        d = di;\r\n        f = fi;\r\n        g = gi;\r\n        c = ci;\r\n      }\r\n    }\r\n  });\r\n  // Snap ?\r\n  if (d > this.snapDistance_) {\r\n    return false;\r\n  } else {\r\n    // Snap to node\r\n    var coord = this.getNearestCoord (c, f.getGeometry().getCoordinates());\r\n    var p = this.getMap().getPixelFromCoordinate(coord);\r\n    if (ol_coordinate_dist2d(e.pixel, p) < this.snapDistance_) {\r\n      c = coord;\r\n    }\r\n    //\r\n    return { source:source, feature:f, coord: c, link: g };\r\n  }\r\n}\r\n\r\n/** Get nearest coordinate in a list \r\n* @param {ol.coordinate} pt the point to find nearest\r\n* @param {Array<ol.coordinate>} coords list of coordinates\r\n* @return {ol.coordinate} the nearest coordinate in the list\r\n*/\r\nol_interaction_Split.prototype.getNearestCoord = function(pt, coords) {\r\n  var d, dm=Number.MAX_VALUE, p0;\r\n  for (var i=0; i < coords.length; i++) {\r\n    d = ol_coordinate_dist2d (pt, coords[i]);\r\n    if (d < dm) {\r\n      dm = d;\r\n      p0 = coords[i];\r\n    }\r\n  }\r\n  return p0;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `true` to start the drag sequence.\r\n */\r\nol_interaction_Split.prototype.handleDownEvent = function(evt) {\r\n  // Something to split ?\r\n  var current = this.getClosestFeature(evt);\r\n\r\n  if (current) {\r\n    var self = this;\r\n    self.overlayLayer_.getSource().clear();\r\n    var split = current.feature.getGeometry().splitAt(current.coord, this.tolerance_);\r\n    var i;\r\n    if (split.length > 1) {\r\n      var tosplit = [];\r\n      for (i=0; i<split.length; i++) {\r\n        var f = current.feature.clone();\r\n        f.setGeometry(split[i]);\r\n        tosplit.push(f);\r\n      }\r\n      self.dispatchEvent({ type:'beforesplit', original: current.feature, features: tosplit });\r\n      current.source.dispatchEvent({ type:'beforesplit', original: current.feature, features: tosplit });\r\n      current.source.removeFeature(current.feature);\r\n      for (i=0; i<tosplit.length; i++) {\r\n        current.source.addFeature(tosplit[i]);\r\n      }\r\n      self.dispatchEvent({ type:'aftersplit', original: current.feature, features: tosplit });\r\n      current.source.dispatchEvent({ type:'aftersplit', original: current.feature, features: tosplit });\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Event.\r\n */\r\nol_interaction_Split.prototype.handleMoveEvent = function(e) {\r\n  var map = e.map;\r\n  this.overlayLayer_.getSource().clear();\r\n  var current = this.getClosestFeature(e);\r\n\r\n  if (current && this.filterSplit_(current.feature)) {\r\n    var p, l;\r\n    // Draw sketch\r\n    this.overlayLayer_.getSource().addFeature(current.feature);\r\n    p = new ol_Feature(new ol_geom_Point(current.coord));\r\n    p._sketch_ = true;\r\n    this.overlayLayer_.getSource().addFeature(p);\r\n    //\r\n    l = new ol_Feature(current.link);\r\n    l._sketch_ = true;\r\n    this.overlayLayer_.getSource().addFeature(l);\r\n    // move event\r\n    this.dispatchEvent({\r\n      type: 'pointermove',\r\n      coordinate: e.coordinate,\r\n      frameState: e.frameState,\r\n      originalEvent: e.originalEvent,\r\n      map: e.map,\r\n      pixel: e.pixel,\r\n      feature: current.feature,\r\n      linkGeometry: current.link\r\n    });\r\n  } else {\r\n    this.dispatchEvent(e);\r\n  }\r\n\r\n  var element = map.getTargetElement();\r\n  if (this.cursor_) {\r\n    if (current) {\r\n      if (element.style.cursor != this.cursor_) {\r\n        this.previousCursor_ = element.style.cursor;\r\n        element.style.cursor = this.cursor_;\r\n      }\r\n    } else if (this.previousCursor_ !== undefined) {\r\n      element.style.cursor = this.previousCursor_;\r\n      this.previousCursor_ = undefined;\r\n    }\r\n  }\r\n};\r\n\r\nexport default ol_interaction_Split\r\n","import ol_ext_inherits from '../util/ext'\r\nimport ol_style_Style from 'ol/style/Style'\r\nimport ol_style_Stroke from 'ol/style/Stroke'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\nimport ol_style_Fill from 'ol/style/Fill'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_Feature from 'ol/Feature'\r\nimport ol_Collection from 'ol/Collection'\r\nimport ol_interaction_Pointer from 'ol/interaction/Pointer'\r\nimport ol_style_RegularShape from 'ol/style/RegularShape'\r\nimport {fromExtent as ol_geom_Polygon_fromExtent} from 'ol/geom/Polygon'\r\nimport {boundingExtent as ol_extent_boundingExtent, buffer as ol_extent_buffer, createEmpty as ol_extent_createEmpty, extend as ol_extent_extend, getCenter as ol_extent_getCenter} from 'ol/extent'\r\nimport {unByKey as ol_Observable_unByKey} from 'ol/Observable'\r\n\r\n/** Interaction rotate\r\n * @constructor\r\n * @extends {ol_interaction_Pointer}\r\n * @fires select | rotatestart | rotating | rotateend | translatestart | translating | translateend | scalestart | scaling | scaleend\r\n * @param {any} options\r\n *  @param {function} options.filter A function that takes a Feature and a Layer and returns true if the feature may be transformed or false otherwise.\r\n *  @param {Array<ol.Layer>} options.layers array of layers to transform,\r\n *  @param {ol.Collection<ol.Feature>} options.features collection of feature to transform,\r\n *\t@param {ol.EventsConditionType|undefined} options.condition A function that takes an ol.MapBrowserEvent and a feature collection and returns a boolean to indicate whether that event should be handled. default: ol.events.condition.always.\r\n *\t@param {ol.EventsConditionType|undefined} options.addCondition A function that takes an ol.MapBrowserEvent and returns a boolean to indicate whether that event should be handled ie. the feature will be added to the transforms features. default: ol.events.condition.never.\r\n *\t@param {number | undefined} options.hitTolerance Tolerance to select feature in pixel, default 0\r\n *\t@param {bool} options.translateFeature Translate when click on feature\r\n *\t@param {bool} options.translate Can translate the feature\r\n *  @param {bool} options.translateBBox Enable translate when the user drags inside the bounding box\r\n *\t@param {bool} options.stretch can stretch the feature\r\n *\t@param {bool} options.scale can scale the feature\r\n *\t@param {bool} options.rotate can rotate the feature\r\n *\t@param {bool} options.noFlip prevent the feature geometry to flip, default false\r\n *\t@param {bool} options.selection the intraction handle selection/deselection, if not use the select prototype to add features to transform, default true\r\n *\t@param {ol.events.ConditionType | undefined} options.keepAspectRatio A function that takes an ol.MapBrowserEvent and returns a boolean to keep aspect ratio, default ol.events.condition.shiftKeyOnly.\r\n *\t@param {ol.events.ConditionType | undefined} options.modifyCenter A function that takes an ol.MapBrowserEvent and returns a boolean to apply scale & strech from the center, default ol.events.condition.metaKey or ol.events.condition.ctrlKey.\r\n *\t@param {boolean} options.enableRotatedTransform Enable transform when map is rotated\r\n *\t@param {} options.style list of ol.style for handles\r\n *\r\n */\r\nvar ol_interaction_Transform = function(options) {\r\n  if (!options) options = {};\r\n\tvar self = this;\r\n\r\n  this.selection_ = new ol_Collection();\r\n\r\n\t// Create a new overlay layer for the sketch\r\n\tthis.handles_ = new ol_Collection();\r\n\tthis.overlayLayer_ = new ol_layer_Vector({\r\n    source: new ol_source_Vector({\r\n      features: this.handles_,\r\n      useSpatialIndex: false,\r\n      wrapX: false // For vector editing across the -180° and 180° meridians to work properly, this should be set to false\r\n    }),\r\n    name:'Transform overlay',\r\n    displayInLayerSwitcher: false,\r\n    // Return the style according to the handle type\r\n    style: function (feature) {\r\n      return (self.style[(feature.get('handle')||'default')+(feature.get('constraint')||'')+(feature.get('option')||'')]);\r\n    },\r\n  });\r\n\r\n  // Extend pointer\r\n  ol_interaction_Pointer.call(this, {\r\n    handleDownEvent: this.handleDownEvent_,\r\n    handleDragEvent: this.handleDragEvent_,\r\n    handleMoveEvent: this.handleMoveEvent_,\r\n    handleUpEvent: this.handleUpEvent_\r\n  });\r\n\r\n  // Collection of feature to transform\r\n  this.features_ = options.features;\r\n  // Filter or list of layers to transform\r\n  if (typeof(options.filter)==='function') this._filter = options.filter;\r\n  this.layers_ = options.layers ? (options.layers instanceof Array) ? options.layers:[options.layers] : null;\r\n\r\n  this._handleEvent = options.condition || function() { return true; };\r\n  this.addFn_ = options.addCondition || function() { return false; };\r\n  /* Translate when click on feature */\r\n  this.set('translateFeature', (options.translateFeature!==false));\r\n  /* Can translate the feature */\r\n  this.set('translate', (options.translate!==false));\r\n  /* Translate when click on the bounding box */\r\n  this.set('translateBBox', (options.translateBBox===true));\r\n  /* Can stretch the feature */\r\n  this.set('stretch', (options.stretch!==false));\r\n  /* Can scale the feature */\r\n  this.set('scale', (options.scale!==false));\r\n  /* Can rotate the feature */\r\n  this.set('rotate', (options.rotate!==false));\r\n  /* Keep aspect ratio */\r\n  this.set('keepAspectRatio', (options.keepAspectRatio || function(e){ return e.originalEvent.shiftKey }));\r\n  /* Modify center */\r\n  this.set('modifyCenter', (options.modifyCenter || function(e){ return e.originalEvent.metaKey || e.originalEvent.ctrlKey }));\r\n  /* Prevent flip */\r\n  this.set('noFlip', (options.noFlip || false));\r\n  /* Handle selection */\r\n  this.set('selection', (options.selection !== false));\r\n  /*  */\r\n  this.set('hitTolerance', (options.hitTolerance || 0));\r\n  /* Enable view rotated transforms */\r\n  this.set('enableRotatedTransform', (options.enableRotatedTransform || false));\r\n\r\n\r\n  // Force redraw when changed\r\n  this.on ('propertychange', function() {\r\n    this.drawSketch_();\r\n  });\r\n\r\n  // setstyle\r\n  this.setDefaultStyle();\r\n};\r\nol_ext_inherits(ol_interaction_Transform, ol_interaction_Pointer);\r\n\r\n/** Cursors for transform\r\n*/\r\nol_interaction_Transform.prototype.Cursors = {\r\n  'default': 'auto',\r\n  'select': 'pointer',\r\n  'translate': 'move',\r\n  'rotate': 'move',\r\n  'rotate0': 'move',\r\n  'scale': 'nesw-resize',\r\n  'scale1': 'nwse-resize',\r\n  'scale2': 'nesw-resize',\r\n  'scale3': 'nwse-resize',\r\n  'scalev': 'ew-resize',\r\n  'scaleh1': 'ns-resize',\r\n  'scalev2': 'ew-resize',\r\n  'scaleh3': 'ns-resize'\r\n};\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_Transform.prototype.setMap = function(map) {\r\n  var oldMap = this.getMap();\r\n  if (oldMap) {\r\n    var targetElement = oldMap.getTargetElement();\r\n    oldMap.removeLayer(this.overlayLayer_);\r\n    if (this.previousCursor_ && targetElement) {\r\n      targetElement.style.cursor = this.previousCursor_;\r\n    }\r\n    this.previousCursor_ = undefined;\r\n  }\r\n  ol_interaction_Pointer.prototype.setMap.call (this, map);\r\n  this.overlayLayer_.setMap(map);\r\n  if (map === null) {\r\n    this.select(null);\r\n  }\r\n  if (map !== null) {\r\n    this.isTouch = /touch/.test(map.getViewport().className);\r\n    this.setDefaultStyle();\r\n  }\r\n};\r\n\r\n/**\r\n * Activate/deactivate interaction\r\n * @param {bool}\r\n * @api stable\r\n */\r\nol_interaction_Transform.prototype.setActive = function(b) {\r\n  this.select(null);\r\n  this.overlayLayer_.setVisible(b);\r\n  ol_interaction_Pointer.prototype.setActive.call (this, b);\r\n};\r\n\r\n/** Set default sketch style\r\n * @param {Object|undefined} options\r\n *  @param {ol_style_Stroke} stroke stroke style for selection rectangle\r\n *  @param {ol_style_Fill} fill fill style for selection rectangle\r\n *  @param {ol_style_Stroke} pointStroke stroke style for handles\r\n *  @param {ol_style_Fill} pointFill fill style for handles\r\n */\r\nol_interaction_Transform.prototype.setDefaultStyle = function(options) {\r\n  options = options || {}\r\n  // Style\r\n  var stroke = options.pointStroke || new ol_style_Stroke({ color: [255,0,0,1], width: 1 });\r\n  var strokedash = options.stroke || new ol_style_Stroke({ color: [255,0,0,1], width: 1, lineDash:[4,4] });\r\n  var fill0 = options.fill || new ol_style_Fill({ color:[255,0,0,0.01] });\r\n  var fill = options.pointFill || new ol_style_Fill({ color:[255,255,255,0.8] });\r\n  var circle = new ol_style_RegularShape({\r\n      fill: fill,\r\n      stroke: stroke,\r\n      radius: this.isTouch ? 12 : 6,\r\n      points: 15\r\n    });\r\n  circle.getAnchor()[0] = this.isTouch ? -10 : -5;\r\n  var bigpt = new ol_style_RegularShape({\r\n      fill: fill,\r\n      stroke: stroke,\r\n      radius: this.isTouch ? 16 : 8,\r\n      points: 4,\r\n      angle: Math.PI/4\r\n    });\r\n  var smallpt = new ol_style_RegularShape({\r\n      fill: fill,\r\n      stroke: stroke,\r\n      radius: this.isTouch ? 12 : 6,\r\n      points: 4,\r\n      angle: Math.PI/4\r\n    });\r\n  function createStyle (img, stroke, fill) {\r\n    return [ new ol_style_Style({image:img, stroke:stroke, fill:fill}) ];\r\n  }\r\n  /** Style for handles */\r\n  this.style = {\r\n    'default': createStyle (bigpt, strokedash, fill0),\r\n    'translate': createStyle (bigpt, stroke, fill),\r\n    'rotate': createStyle (circle, stroke, fill),\r\n    'rotate0': createStyle (bigpt, stroke, fill),\r\n    'scale': createStyle (bigpt, stroke, fill),\r\n    'scale1': createStyle (bigpt, stroke, fill),\r\n    'scale2': createStyle (bigpt, stroke, fill),\r\n    'scale3': createStyle (bigpt, stroke, fill),\r\n    'scalev': createStyle (smallpt, stroke, fill),\r\n    'scaleh1': createStyle (smallpt, stroke, fill),\r\n    'scalev2': createStyle (smallpt, stroke, fill),\r\n    'scaleh3': createStyle (smallpt, stroke, fill),\r\n  };\r\n  this.drawSketch_();\r\n}\r\n\r\n/**\r\n * Set sketch style.\r\n * @param {style} style Style name: 'default','translate','rotate','rotate0','scale','scale1','scale2','scale3','scalev','scaleh1','scalev2','scaleh3'\r\n * @param {ol.style.Style|Array<ol.style.Style>} olstyle\r\n * @api stable\r\n */\r\nol_interaction_Transform.prototype.setStyle = function(style, olstyle) {\r\n  if (!olstyle) return;\r\n  if (olstyle instanceof Array) this.style[style] = olstyle;\r\n  else this.style[style] = [ olstyle ];\r\n  for (var i=0; i<this.style[style].length; i++) {\r\n    var im = this.style[style][i].getImage();\r\n    if (im) {\r\n      if (style == 'rotate') im.getAnchor()[0] = -5;\r\n      if (this.isTouch) im.setScale(1.8);\r\n    }\r\n    var tx = this.style[style][i].getText();\r\n    if (tx) {\r\n      if (style == 'rotate') tx.setOffsetX(this.isTouch ? 14 : 7);\r\n      if (this.isTouch) tx.setScale(1.8);\r\n    }\r\n  }\r\n  this.drawSketch_();\r\n};\r\n\r\n/** Get Feature at pixel\r\n * @param {ol.Pixel}\r\n * @return {ol.feature}\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.getFeatureAtPixel_ = function(pixel) {\r\n  var self = this;\r\n  return this.getMap().forEachFeatureAtPixel(pixel,\r\n    function(feature, layer) {\r\n      var found = false;\r\n      // Overlay ?\r\n      if (!layer) {\r\n        if (feature===self.bbox_) {\r\n          if (self.get('translateBBox')) {\r\n            return { feature: feature, handle: 'translate', constraint:'', option: '' };\r\n          } else {\r\n            return false;\r\n          }\r\n        }\r\n        self.handles_.forEach (function(f) { if (f===feature) found=true; });\r\n        if (found) return { feature: feature, handle:feature.get('handle'), constraint:feature.get('constraint'), option:feature.get('option') };\r\n      }\r\n      // No seletion\r\n      if (!self.get('selection')) {\r\n        // Return the currently selected feature the user is interacting with.\r\n        if (self.selection_.getArray().some(function(f) { return feature === f; })) {\r\n          return { feature: feature };\r\n        }\r\n        return null;\r\n      }\r\n      // filter condition\r\n      if (self._filter) {\r\n        if (self._filter(feature,layer)) return { feature: feature };\r\n        else return null;\r\n      }\r\n      // feature belong to a layer\r\n      else if (self.layers_) {\r\n        for (var i=0; i<self.layers_.length; i++) {\r\n          if (self.layers_[i]===layer) return { feature: feature };\r\n        }\r\n        return null;\r\n      }\r\n      // feature in the collection\r\n      else if (self.features_) {\r\n        self.features_.forEach (function(f) { if (f===feature) found=true; });\r\n        if (found) return { feature: feature };\r\n        else return null;\r\n      }\r\n      // Others\r\n      else return { feature: feature };\r\n    },\r\n    { hitTolerance: this.get('hitTolerance') }\r\n  ) || {};\r\n}\r\n\r\n/** Rotate feature from map view rotation\r\n * @param {ol.Feature} f the feature\r\n * @param {boolean} clone clone resulting geom\r\n * @param {ol.geom.Geometry} rotated geometry\r\n */\r\nol_interaction_Transform.prototype.getGeometryRotateToZero_ = function(f, clone) {\r\n  var origGeom = f.getGeometry();\r\n  var viewRotation = this.getMap().getView().getRotation();\r\n  if (viewRotation === 0 || !this.get('enableRotatedTransform')) {\r\n    return (clone) ? origGeom.clone() : origGeom;\r\n  }\r\n  var rotGeom = origGeom.clone();\r\n  rotGeom.rotate(viewRotation * -1, this.getMap().getView().getCenter());\r\n  return rotGeom;\r\n}\r\n\r\n/** Draw transform sketch\r\n* @param {boolean} draw only the center\r\n*/\r\nol_interaction_Transform.prototype.drawSketch_ = function(center) {\r\n  var i, f, geom;\r\n  this.overlayLayer_.getSource().clear();\r\n  if (!this.selection_.getLength()) return;\r\n  var viewRotation = this.getMap().getView().getRotation();\r\n  var ext = this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent();\r\n  // Clone and extend\r\n  ext = ol_extent_buffer(ext, 0);\r\n  this.selection_.forEach(function (f) {\r\n    var extendExt = this.getGeometryRotateToZero_(f).getExtent();\r\n    ol_extent_extend(ext, extendExt);\r\n  }.bind(this));\r\n\r\n  if (center===true) {\r\n    if (!this.ispt_) {\r\n      this.overlayLayer_.getSource().addFeature(new ol_Feature( { geometry: new ol_geom_Point(this.center_), handle:'rotate0' }) );\r\n      geom = ol_geom_Polygon_fromExtent(ext);\r\n      if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n        geom.rotate(viewRotation, this.getMap().getView().getCenter())\r\n      }\r\n      f = this.bbox_ = new ol_Feature(geom);\r\n      this.overlayLayer_.getSource().addFeature (f);\r\n    }\r\n  }\r\n  else {\r\n    if (this.ispt_) {\r\n      var p = this.getMap().getPixelFromCoordinate([ext[0], ext[1]]);\r\n      ext = ol_extent_boundingExtent([\r\n        this.getMap().getCoordinateFromPixel([p[0]-10, p[1]-10]),\r\n        this.getMap().getCoordinateFromPixel([p[0]+10, p[1]+10])\r\n      ]);\r\n    }\r\n    geom = ol_geom_Polygon_fromExtent(ext);\r\n    if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n      geom.rotate(viewRotation, this.getMap().getView().getCenter())\r\n    }\r\n    f = this.bbox_ = new ol_Feature(geom);\r\n    var features = [];\r\n    var g = geom.getCoordinates()[0];\r\n    if (!this.ispt_) {\r\n      features.push(f);\r\n      // Middle\r\n      if (!this.iscircle_ && this.get('stretch') && this.get('scale')) for (i=0; i<g.length-1; i++) {\r\n        f = new ol_Feature( { geometry: new ol_geom_Point([(g[i][0]+g[i+1][0])/2,(g[i][1]+g[i+1][1])/2]), handle:'scale', constraint:i%2?\"h\":\"v\", option:i });\r\n        features.push(f);\r\n      }\r\n      // Handles\r\n      if (this.get('scale')) for (i=0; i<g.length-1; i++) {\r\n        f = new ol_Feature( { geometry: new ol_geom_Point(g[i]), handle:'scale', option:i });\r\n        features.push(f);\r\n      }\r\n      // Center\r\n      if (this.get('translate') && !this.get('translateFeature')) {\r\n        f = new ol_Feature( { geometry: new ol_geom_Point([(g[0][0]+g[2][0])/2, (g[0][1]+g[2][1])/2]), handle:'translate' });\r\n        features.push(f);\r\n      }\r\n    }\r\n    // Rotate\r\n    if (!this.iscircle_ && this.get('rotate')) {\r\n      f = new ol_Feature( { geometry: new ol_geom_Point(g[3]), handle:'rotate' });\r\n      features.push(f);\r\n    }\r\n    // Add sketch\r\n    this.overlayLayer_.getSource().addFeatures(features);\r\n  }\r\n\r\n};\r\n\r\n/** Select a feature to transform\r\n* @param {ol.Feature} feature the feature to transform\r\n* @param {boolean} add true to add the feature to the selection, default false\r\n*/\r\nol_interaction_Transform.prototype.select = function(feature, add) {\r\n  if (!feature) {\r\n    this.selection_.clear();\r\n    this.drawSketch_();\r\n    return;\r\n  }\r\n  if (!feature.getGeometry || !feature.getGeometry()) return;\r\n  // Add to selection\r\n  if (add) {\r\n    this.selection_.push(feature);\r\n  } else {\r\n\tvar index = this.selection_.getArray().indexOf(feature);\r\n\tthis.selection_.removeAt(index);\t\r\n  }\r\n  this.ispt_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Point\") : false);\r\n  this.iscircle_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Circle\") : false);\r\n  this.drawSketch_();\r\n  this.watchFeatures_();\r\n  // select event\r\n  this.dispatchEvent({ type:'select', feature: feature, features: this.selection_ });\r\n};\r\n\r\n/** Update the selection collection.\r\n* @param {ol.Collection<ol.Feature>} features the features to transform\r\n*/\r\nol_interaction_Transform.prototype.setSelection = function(features) {\r\n  this.selection_.clear();\r\n  features.forEach(function(feature) {\r\n    this.selection_.push(feature);\r\n  }.bind(this));\r\n\r\n  this.ispt_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Point\") : false);\r\n  this.iscircle_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Circle\") : false);\r\n  this.drawSketch_();\r\n  this.watchFeatures_();\r\n  // select event\r\n  this.dispatchEvent({ type:'select', features: this.selection_ });\r\n};\r\n\r\n/** Watch selected features\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.watchFeatures_ = function() {\r\n  // Listen to feature modification\r\n  if (this._featureListeners) {\r\n    this._featureListeners.forEach(function (l) {\r\n      ol_Observable_unByKey(l)\r\n    });\r\n  }\r\n  this._featureListeners = [];\r\n  this.selection_.forEach(function(f) {\r\n    this._featureListeners.push(\r\n      f.on('change', function() {\r\n        if (!this.isUpdating_) {\r\n          this.drawSketch_();\r\n        }\r\n      }.bind(this))\r\n    );\r\n  }.bind(this));\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `true` to start the drag sequence.\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.handleDownEvent_ = function(evt) {\r\n  if (!this._handleEvent(evt, this.selection_)) return;\r\n  var sel = this.getFeatureAtPixel_(evt.pixel);\r\n  var feature = sel.feature;\r\n  if (this.selection_.getLength()\r\n    && this.selection_.getArray().indexOf(feature) >= 0\r\n    && ((this.ispt_ && this.get('translate')) || this.get('translateFeature'))\r\n  ){\r\n    sel.handle = 'translate';\r\n  }\r\n  if (sel.handle) {\r\n    this.mode_ = sel.handle;\r\n    this.opt_ = sel.option;\r\n    this.constraint_ = sel.constraint;\r\n    // Save info\r\n    var viewRotation = this.getMap().getView().getRotation();\r\n    this.coordinate_ = evt.coordinate;\r\n    this.pixel_ = evt.pixel;\r\n    this.geoms_ = [];\r\n    this.rotatedGeoms_ = [];\r\n    var extent = ol_extent_createEmpty();\r\n    var rotExtent = ol_extent_createEmpty();\r\n    for (var i=0, f; f=this.selection_.item(i); i++) {\r\n      this.geoms_.push(f.getGeometry().clone());\r\n      extent = ol_extent_extend(extent, f.getGeometry().getExtent());\r\n      if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n        var rotGeom = this.getGeometryRotateToZero_(f, true);\r\n        this.rotatedGeoms_.push(rotGeom);\r\n        rotExtent = ol_extent_extend(rotExtent, rotGeom.getExtent());\r\n      }\r\n    }\r\n    this.extent_ = (ol_geom_Polygon_fromExtent(extent)).getCoordinates()[0];\r\n    if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n      this.rotatedExtent_ = (ol_geom_Polygon_fromExtent(rotExtent)).getCoordinates()[0];\r\n    }\r\n    if (this.mode_==='rotate') {\r\n      this.center_ = this.getCenter() || ol_extent_getCenter(extent);\r\n      // we are now rotating (cursor down on rotate mode), so apply the grabbing cursor\r\n      var element = evt.map.getTargetElement();\r\n      element.style.cursor = this.Cursors.rotate0;\r\n      this.previousCursor_ = element.style.cursor;\r\n    } else {\r\n      this.center_ = ol_extent_getCenter(extent);\r\n    }\r\n    this.angle_ = Math.atan2(this.center_[1]-evt.coordinate[1], this.center_[0]-evt.coordinate[0]);\r\n\r\n    this.dispatchEvent({\r\n      type: this.mode_+'start',\r\n      feature: this.selection_.item(0), // backward compatibility\r\n      features: this.selection_,\r\n      pixel: evt.pixel,\r\n      coordinate: evt.coordinate\r\n    });\r\n    return true;\r\n  }\r\n  else if (this.get('selection')) {\r\n    if (feature){\r\n      if (!this.addFn_(evt)) this.selection_.clear();\r\n      var index = this.selection_.getArray().indexOf(feature);\r\n      if (index < 0) this.selection_.push(feature);\r\n      else this.selection_.removeAt(index);\r\n    } else {\r\n      this.selection_.clear();\r\n    }\r\n    this.ispt_ = this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Point\") : false;\r\n    this.iscircle_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Circle\") : false);\r\n    this.drawSketch_();\r\n    this.watchFeatures_();\r\n    this.dispatchEvent({ type:'select', feature: feature, features: this.selection_, pixel: evt.pixel, coordinate: evt.coordinate });\r\n    return false;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Get features to transform\r\n * @return {ol.Collection<ol.Feature>}\r\n */\r\nol_interaction_Transform.prototype.getFeatures = function() {\r\n  return this.selection_;\r\n};\r\n\r\n/**\r\n * Get the rotation center\r\n * @return {ol.coordinates|undefined}\r\n */\r\nol_interaction_Transform.prototype.getCenter = function() {\r\n  return this.get('center');\r\n};\r\n\r\n/**\r\n * Set the rotation center\r\n * @param {ol.coordinates|undefined} c the center point, default center on the objet\r\n */\r\nol_interaction_Transform.prototype.setCenter = function(c) {\r\n  return this.set('center', c);\r\n}\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.handleDragEvent_ = function(evt) {\r\n  if (!this._handleEvent(evt, this.features_)) return;\r\n  var viewRotation = this.getMap().getView().getRotation();\r\n  var i, f, geometry;\r\n  var pt0 = [this.coordinate_[0], this.coordinate_[1]];\r\n  var pt = [evt.coordinate[0], evt.coordinate[1]];\r\n  this.isUpdating_ = true;\r\n  switch (this.mode_) {\r\n    case 'rotate': {\r\n      var a = Math.atan2(this.center_[1]-pt[1], this.center_[0]-pt[0]);\r\n      if (!this.ispt) {\r\n        // var geometry = this.geom_.clone();\r\n        // geometry.rotate(a-this.angle_, this.center_);\r\n        // this.feature_.setGeometry(geometry);\r\n        for (i=0, f; f=this.selection_.item(i); i++) {\r\n          geometry = this.geoms_[i].clone();\r\n          geometry.rotate(a - this.angle_, this.center_);\r\n          // bug: ol, bad calculation circle geom extent\r\n          if (geometry.getType() == 'Circle') geometry.setCenterAndRadius(geometry.getCenter(), geometry.getRadius());\r\n          f.setGeometry(geometry);\r\n        }\r\n      }\r\n      this.drawSketch_(true);\r\n      this.dispatchEvent({\r\n        type:'rotating',\r\n        feature: this.selection_.item(0),\r\n        features: this.selection_,\r\n        angle: a-this.angle_,\r\n        pixel: evt.pixel,\r\n        coordinate: evt.coordinate\r\n      });\r\n      break;\r\n    }\r\n    case 'translate': {\r\n      var deltaX = pt[0] - pt0[0];\r\n      var deltaY = pt[1] - pt0[1];\r\n\r\n      //this.feature_.getGeometry().translate(deltaX, deltaY);\r\n      for (i=0, f; f=this.selection_.item(i); i++) {\r\n        f.getGeometry().translate(deltaX, deltaY);\r\n      }\r\n      this.handles_.forEach(function(f) {\r\n        f.getGeometry().translate(deltaX, deltaY);\r\n      });\r\n\r\n      this.coordinate_ = evt.coordinate;\r\n      this.dispatchEvent({\r\n        type:'translating',\r\n        feature: this.selection_.item(0),\r\n        features: this.selection_,\r\n        delta:[deltaX,deltaY],\r\n        pixel: evt.pixel,\r\n        coordinate: evt.coordinate\r\n      });\r\n      break;\r\n    }\r\n    case 'scale': {\r\n      var center = this.center_;\r\n      if (this.get('modifyCenter')(evt)) {\r\n        var extentCoordinates = this.extent_;\r\n        if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n          extentCoordinates = this.rotatedExtent_;\r\n        }\r\n        center = extentCoordinates[(Number(this.opt_)+2)%4];\r\n      }\r\n\r\n      var downCoordinate = this.coordinate_;\r\n      var dragCoordinate = evt.coordinate;\r\n      if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n        var downPoint = new ol_geom_Point(this.coordinate_);\r\n        downPoint.rotate(viewRotation * -1, center);\r\n        downCoordinate = downPoint.getCoordinates();\r\n\r\n        var dragPoint = new ol_geom_Point(evt.coordinate);\r\n        dragPoint.rotate(viewRotation * -1, center);\r\n        dragCoordinate = dragPoint.getCoordinates();\r\n      }\r\n\r\n      var scx = ((dragCoordinate)[0] - (center)[0]) / (downCoordinate[0] - (center)[0]);\r\n      var scy = ((dragCoordinate)[1] - (center)[1]) / (downCoordinate[1] - (center)[1]);\r\n\r\n      if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n        var centerPoint = new ol_geom_Point(center);\r\n        centerPoint.rotate(viewRotation * -1, this.getMap().getView().getCenter());\r\n        center = centerPoint.getCoordinates();\r\n      }\r\n\r\n      if (this.get('noFlip')) {\r\n        if (scx<0) scx=-scx;\r\n        if (scy<0) scy=-scy;\r\n      }\r\n\r\n      if (this.constraint_) {\r\n        if (this.constraint_==\"h\") scx=1;\r\n        else scy=1;\r\n      } else {\r\n        if (this.get('keepAspectRatio')(evt)) {\r\n          scx = scy = Math.min(scx,scy);\r\n        }\r\n      }\r\n\r\n      for (i=0, f; f=this.selection_.item(i); i++) {\r\n        geometry = (viewRotation === 0 || !this.get('enableRotatedTransform')) ? this.geoms_[i].clone() : this.rotatedGeoms_[i].clone();\r\n        geometry.applyTransform(function(g1, g2, dim) {\r\n          if (dim<2) return g2;\r\n\r\n          for (var j=0; j<g1.length; j+=dim) {\r\n            if (scx!=1) g2[j] = center[0] + (g1[j]-center[0])*scx;\r\n            if (scy!=1) g2[j+1] = center[1] + (g1[j+1]-center[1])*scy;\r\n          }\r\n          // bug: ol, bad calculation circle geom extent\r\n          if (geometry.getType() == 'Circle') geometry.setCenterAndRadius(geometry.getCenter(), geometry.getRadius());\r\n          return g2;\r\n        });\r\n        if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n          //geometry.rotate(viewRotation, rotationCenter);\r\n          geometry.rotate(viewRotation, this.getMap().getView().getCenter());\r\n        }\r\n        f.setGeometry(geometry);\r\n      }\r\n      this.drawSketch_();\r\n      this.dispatchEvent({\r\n        type:'scaling',\r\n        feature: this.selection_.item(0),\r\n        features: this.selection_,\r\n        scale:[scx,scy],\r\n        pixel: evt.pixel,\r\n        coordinate: evt.coordinate\r\n      });\r\n      break;\r\n    }\r\n    default: break;\r\n  }\r\n  this.isUpdating_ = false;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Event.\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.handleMoveEvent_ = function(evt) {\r\n  if (!this._handleEvent(evt, this.features_)) return;\r\n  // console.log(\"handleMoveEvent\");\r\n  if (!this.mode_) {\r\n    var sel = this.getFeatureAtPixel_(evt.pixel);\r\n    var element = evt.map.getTargetElement();\r\n    if (sel.feature) {\r\n      var c = sel.handle ? this.Cursors[(sel.handle||'default')+(sel.constraint||'')+(sel.option||'')] : this.Cursors.select;\r\n\r\n      if (this.previousCursor_===undefined) {\r\n        this.previousCursor_ = element.style.cursor;\r\n      }\r\n      element.style.cursor = c;\r\n    } else {\r\n      if (this.previousCursor_!==undefined) element.style.cursor = this.previousCursor_;\r\n      this.previousCursor_ = undefined;\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `false` to stop the drag sequence.\r\n */\r\nol_interaction_Transform.prototype.handleUpEvent_ = function(evt) {\r\n  // remove rotate0 cursor on Up event, otherwise it's stuck on grab/grabbing\r\n  if (this.mode_ === 'rotate') {\r\n    var element = evt.map.getTargetElement();\r\n    element.style.cursor = this.Cursors.default;\r\n    this.previousCursor_ = undefined;\r\n  }\r\n\r\n  //dispatchEvent\r\n  this.dispatchEvent({\r\n    type:this.mode_+'end',\r\n    feature: this.selection_.item(0),\r\n    features: this.selection_,\r\n    oldgeom: this.geoms_[0],\r\n    oldgeoms: this.geoms_\r\n  });\r\n\r\n  this.drawSketch_();\r\n  this.mode_ = null;\r\n  return false;\r\n};\r\n\r\n/** Get the features that are selected for transform\r\n * @return ol.Collection\r\n */\r\nol_interaction_Transform.prototype.getFeatures = function() {\r\n  return this.selection_;\r\n};\r\n\r\nexport default ol_interaction_Transform\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Pointer from 'ol/interaction/Pointer'\r\nimport ol_style_Style from 'ol/style/Style'\r\nimport ol_style_Stroke from 'ol/style/Stroke'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\nimport ol_style_Fill from 'ol/style/Fill'\r\nimport ol_style_Circle from 'ol/style/Circle'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_Feature from 'ol/Feature'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_interaction_Interaction from 'ol/interaction/Interaction'\r\nimport {ol_coordinate_dist2d, ol_coordinate_equal} from \"../geom/GeomUtils\";\r\nimport {boundingExtent as ol_extent_boundingExtent} from 'ol/extent'\r\nimport {buffer as ol_extent_buffer} from 'ol/extent'\r\nimport {altKeyOnly as ol_events_condition_altKeyOnly} from 'ol/events/condition'\r\nimport {primaryAction as ol_events_condition_primaryAction} from 'ol/events/condition'\r\nimport {always as ol_events_condition_always} from 'ol/events/condition'\r\n\r\nimport '../geom/LineStringSplitAt'\r\n\r\n/** Interaction for modifying feature geometries. Similar to the core ol/interaction/Modify.\r\n * The interaction is more suitable to use to handle feature modification: only features concerned \r\n * by the modification are passed to the events (instead of all feature with ol/interaction/Modify)\r\n * - the modifystart event is fired before the feature is modified (no points still inserted)\r\n * - the modifyend event is fired after the modification\r\n * - it fires a modifying event\r\n * @constructor\r\n * @extends {ol_interaction_Pointer}\r\n * @fires modifystart\r\n * @fires modifying\r\n * @fires modifyend\r\n * @fires select\r\n * @param {*} options\r\n *\t@param {ol.source.Vector} options.source a source to modify (configured with useSpatialIndex set to true)\r\n *\t@param {ol.source.Vector|Array<ol.source.Vector>} options.sources a list of source to modify (configured with useSpatialIndex set to true)\r\n *  @param {ol.Collection.<ol.Feature>} options.features collection of feature to modify\r\n *  @param {integer} options.pixelTolerance Pixel tolerance for considering the pointer close enough to a segment or vertex for editing. Default is 10.\r\n *  @param {function|undefined} options.filter a filter that takes a feature and return true if it can be modified, default always true.\r\n *  @param {ol.style.Style | Array<ol.style.Style> | undefined} options.style Style for the sketch features.\r\n *  @param {ol.EventsConditionType | undefined} options.condition A function that takes an ol.MapBrowserEvent and returns a boolean to indicate whether that event will be considered to add or move a vertex to the sketch. Default is ol.events.condition.primaryAction.\r\n *  @param {ol.EventsConditionType | undefined} options.deleteCondition A function that takes an ol.MapBrowserEvent and returns a boolean to indicate whether that event should be handled. By default, ol.events.condition.singleClick with ol.events.condition.altKeyOnly results in a vertex deletion.\r\n *  @param {ol.EventsConditionType | undefined} options.insertVertexCondition A function that takes an ol.MapBrowserEvent and returns a boolean to indicate whether a new vertex can be added to the sketch features. Default is ol.events.condition.always\r\n *  @param {boolean} options.wrapX Wrap the world horizontally on the sketch overlay, default false\r\n */\r\nvar ol_interaction_ModifyFeature = function(options){\r\n  if (!options) options = {};\r\n\r\n  var dragging, modifying;\r\n  ol_interaction_Pointer.call(this,{\r\n    /*\r\n    handleDownEvent: this.handleDownEvent,\r\n    handleDragEvent: this.handleDragEvent,\r\n    handleMoveEvent: this.handleMoveEvent,\r\n    handleUpEvent: this.handleUpEvent,\r\n    */\r\n    handleEvent: function(e) {\r\n      switch(e.type) {\r\n        case 'pointerdown': {\r\n          dragging = this.handleDownEvent(e);\r\n          modifying = dragging || this._deleteCondition(e);\r\n          return !dragging;\r\n        }\r\n        case 'pointerup': {\r\n          dragging = false;\r\n          return this.handleUpEvent(e);\r\n        }\r\n        case 'pointerdrag': {\r\n          if (dragging) return this.handleDragEvent(e);\r\n          else return true;\r\n        }\r\n        case 'pointermove': {\r\n          if (!dragging) return this.handleMoveEvent(e);\r\n          else return true;\r\n        }\r\n        case 'singleclick':\r\n        case 'click': {\r\n          // Prevent click when modifying\r\n          return !modifying;\r\n        }\r\n        default: return true;\r\n      }\r\n    }\r\n  });\r\n\r\n  // Snap distance (in px)\r\n  this.snapDistance_ = options.pixelTolerance || 10;\r\n  // Split tolerance between the calculated intersection and the geometry\r\n  this.tolerance_ = 1e-10;\r\n  // Cursor\r\n  this.cursor_ = options.cursor;\r\n\r\n  // List of source to split\r\n  this.sources_ = options.sources ? (options.sources instanceof Array) ? options.sources:[options.sources] : [];\r\n  if (options.source) this.sources_.push (options.source);\r\n  if (options.features) this.sources_.push (new ol_source_Vector({ features: options.features }));\r\n\r\n  // Get all features candidate\r\n  this.filterSplit_ = options.filter || function(){ return true; };\r\n\r\n  this._condition = options.condition || ol_events_condition_primaryAction;\r\n  this._deleteCondition = options.deleteCondition || ol_events_condition_altKeyOnly;\r\n  this._insertVertexCondition = options.insertVertexCondition || ol_events_condition_always;\r\n\r\n  // Default style\r\n  var sketchStyle = function() {\r\n    return [ new ol_style_Style({\r\n        image: new ol_style_Circle({\r\n          radius: 6,\r\n          fill: new ol_style_Fill({ color: [0, 153, 255, 1] }),\r\n          stroke: new ol_style_Stroke({ color: '#FFF', width: 1.25 })\r\n        })\r\n      })\r\n    ];\r\n  }\r\n\r\n  // Custom style\r\n  if (options.style) {\r\n    if (typeof(options.style) === 'function') {\r\n      sketchStyle = options.style\r\n     } else {\r\n       sketchStyle = function() { return options.style; }\r\n     }\r\n  }\r\n\r\n  // Create a new overlay for the sketch\r\n  this.overlayLayer_ = new ol_layer_Vector({\r\n    source: new ol_source_Vector({\r\n      useSpatialIndex: false\r\n    }),\r\n    name:'Modify overlay',\r\n    displayInLayerSwitcher: false,\r\n    style: sketchStyle,\r\n    wrapX: options.wrapX\r\n  });\r\n\r\n};\r\nol_ext_inherits(ol_interaction_ModifyFeature, ol_interaction_Pointer);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_ModifyFeature.prototype.setMap = function(map) {\r\n  if (this.getMap()) this.getMap().removeLayer(this.overlayLayer_);\r\n  ol_interaction_Interaction.prototype.setMap.call (this, map);\r\n  this.overlayLayer_.setMap(map);\r\n};\r\n\r\n/**\r\n * Activate or deactivate the interaction + remove the sketch.\r\n * @param {boolean} active.\r\n * @api stable\r\n */\r\nol_interaction_ModifyFeature.prototype.setActive = function(active) {\r\n  ol_interaction_Interaction.prototype.setActive.call (this, active);\r\n  if (this.overlayLayer_) this.overlayLayer_.getSource().clear();\r\n};\r\n\r\n/** Get closest feature at pixel\r\n * @param {ol.Pixel} \r\n * @return {*} \r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.getClosestFeature = function(e) {\r\n  var f, c, d = this.snapDistance_+1;\r\n  for (var i=0; i<this.sources_.length; i++) {\r\n    var source = this.sources_[i];\r\n    f = source.getClosestFeatureToCoordinate(e.coordinate);\r\n    if (f && this.filterSplit_(f)) {\r\n      var ci = f.getGeometry().getClosestPoint(e.coordinate);\r\n      var di = ol_coordinate_dist2d(e.coordinate,ci) / e.frameState.viewState.resolution;\r\n      if (di < d){\r\n        d = di;\r\n        c = ci;\r\n      }\r\n      break;\r\n    }\r\n  }\r\n  if (d > this.snapDistance_) {\r\n    if (this.currentFeature) this.dispatchEvent({ type: 'select', selected: [], deselected: [this.currentFeature] })\r\n    this.currentFeature = null;\r\n    return false;\r\n  } else {\r\n    // Snap to node\r\n    var coord = this.getNearestCoord (c, f.getGeometry());\r\n    if (coord) {\r\n      coord = coord.coord;\r\n      var p = this.getMap().getPixelFromCoordinate(coord);\r\n      if (ol_coordinate_dist2d(e.pixel, p) < this.snapDistance_) {\r\n        c = coord;\r\n      }\r\n      //\r\n      if (this.currentFeature !== f) this.dispatchEvent({ type: 'select', selected: [f], deselected: [this.currentFeature] })\r\n      this.currentFeature = f;\r\n      return { source:source, feature:f, coord: c };\r\n    }\r\n  }\r\n}\r\n\r\n/** Get nearest coordinate in a list \r\n* @param {ol.coordinate} pt the point to find nearest\r\n* @param {ol.geom} coords list of coordinates\r\n* @return {*} the nearest point with a coord (projected point), dist (distance to the geom), ring (if Polygon)\r\n*/\r\nol_interaction_ModifyFeature.prototype.getNearestCoord = function(pt, geom) {\r\n  var i, l, p, p0, dm;\r\n  switch (geom.getType()) {\r\n    case 'Point': {\r\n      return { coord: geom.getCoordinates(), dist: ol_coordinate_dist2d(geom.getCoordinates(), pt) };\r\n    }\r\n    case 'MultiPoint': {\r\n      return this.getNearestCoord (pt, new ol_geom_LineString(geom.getCoordinates()));\r\n    }\r\n    case 'LineString':\r\n    case 'LinearRing': {\r\n      var d;\r\n      dm = Number.MAX_VALUE;\r\n      var coords = geom.getCoordinates();\r\n      for (i=0; i < coords.length; i++) {\r\n        d = ol_coordinate_dist2d (pt, coords[i]);\r\n        if (d < dm) {\r\n          dm = d;\r\n          p0 = coords[i];\r\n        }\r\n      }\r\n      return { coord: p0, dist: dm };\r\n    }\r\n    case 'MultiLineString': {\r\n      var lstring = geom.getLineStrings();\r\n      p0 = false, dm = Number.MAX_VALUE;\r\n      for (i=0; l=lstring[i]; i++) {\r\n        p = this.getNearestCoord(pt, l);\r\n        if (p && p.dist<dm) {\r\n          p0 = p;\r\n          dm = p.dist;\r\n          p0.ring = i;\r\n        }\r\n      }\r\n      return p0;\r\n    }\r\n    case 'Polygon': {\r\n      var lring = geom.getLinearRings();\r\n      p0 = false;\r\n      dm = Number.MAX_VALUE;\r\n      for (i=0; l=lring[i]; i++) {\r\n        p = this.getNearestCoord(pt, l);\r\n        if (p && p.dist<dm) {\r\n          p0 = p;\r\n          dm = p.dist;\r\n          p0.ring = i;\r\n        }\r\n      }\r\n      return p0;\r\n    }\r\n    case 'MultiPolygon': {\r\n      var poly = geom.getPolygons();\r\n      p0 = false;\r\n      dm = Number.MAX_VALUE;\r\n      for (i=0; l=poly[i]; i++) {\r\n        p = this.getNearestCoord(pt, l);\r\n        if (p && p.dist<dm) {\r\n          p0 = p;\r\n          dm = p.dist;\r\n          p0.poly = i;\r\n        }\r\n      }\r\n      return p0;\r\n    }\r\n    case 'GeometryCollection': {\r\n      var g = geom.getGeometries();\r\n      p0 = false;\r\n      dm = Number.MAX_VALUE;\r\n      for (i=0; l=g[i]; i++) {\r\n        p = this.getNearestCoord(pt, l);\r\n        if (p && p.dist<dm) {\r\n          p0 = p;\r\n          dm = p.dist;\r\n          p0.geom = i;\r\n        }\r\n      }\r\n      return p0;\r\n    }\r\n    default: return false;\r\n  }\r\n};\r\n\r\n/** Get arcs concerned by a modification \r\n * @param {ol.geom} geom the geometry concerned\r\n * @param {ol.coordinate} coord pointed coordinates\r\n */\r\nol_interaction_ModifyFeature.prototype.getArcs = function(geom, coord) {\r\n  var arcs = false;\r\n  var coords, i, s, l, g;\r\n  switch(geom.getType()) {\r\n    case 'Point': {\r\n      if (ol_coordinate_equal(coord, geom.getCoordinates())) {\r\n        arcs = { \r\n          geom: geom, \r\n          type: geom.getType(),\r\n          coord1: [],\r\n          coord2: [],\r\n          node: true\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiPoint': {\r\n      coords = geom.getCoordinates();\r\n      for (i=0; i < coords.length; i++) {\r\n        if (ol_coordinate_equal(coord, coords[i])) {\r\n          arcs = { \r\n            geom: geom, \r\n            type: geom.getType(),\r\n            index: i,\r\n            coord1: [],\r\n            coord2: [],\r\n            node: true\r\n          }\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'LinearRing': \r\n    case 'LineString': {\r\n      var p = geom.getClosestPoint(coord);\r\n      if (ol_coordinate_dist2d(p,coord) < 1.5*this.tolerance_) {\r\n        var split;\r\n        // Split the line in two\r\n        if (geom.getType() === 'LinearRing') {\r\n          g = new ol_geom_LineString(geom.getCoordinates());\r\n          split = g.splitAt(coord, this.tolerance_);\r\n        } else {\r\n          split = geom.splitAt(coord, this.tolerance_);\r\n        }\r\n        // If more than 2\r\n        if (split.length>2) {\r\n          coords = split[1].getCoordinates();\r\n          for (i=2; s=split[i]; i++) {\r\n            var c = s.getCoordinates();\r\n            c.shift();\r\n            coords = coords.concat(c);\r\n          }\r\n          split = [ split[0], new ol_geom_LineString(coords) ];\r\n        }\r\n        // Split in two\r\n        if (split.length === 2) {\r\n          var c0 = split[0].getCoordinates();\r\n          var c1 = split[1].getCoordinates();\r\n          var nbpt = c0.length + c1.length -1;\r\n          c0.pop();\r\n          c1.shift();\r\n          arcs = { \r\n            geom: geom, \r\n            type: geom.getType(),\r\n            coord1: c0, \r\n            coord2: c1,\r\n            node: (geom.getCoordinates().length === nbpt),\r\n            closed: false\r\n          }\r\n        } else if (split.length === 1) {\r\n          s = split[0].getCoordinates();\r\n          var start = ol_coordinate_equal(s[0], coord);\r\n          var end = ol_coordinate_equal(s[s.length-1], coord);\r\n          // Move first point\r\n          if (start) {\r\n            s.shift();\r\n            if (end) s.pop();\r\n            arcs = { \r\n              geom: geom, \r\n              type: geom.getType(),\r\n              coord1: [], \r\n              coord2: s,\r\n              node: true,\r\n              closed: end\r\n            }\r\n          } else if (end) {\r\n            // Move last point\r\n            s.pop()\r\n            arcs = { \r\n              geom: geom, \r\n              type: geom.getType(),\r\n              coord1: s, \r\n              coord2: [],\r\n              node: true,\r\n              closed: false\r\n            }\r\n          }\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiLineString': {\r\n      var lstring = geom.getLineStrings();\r\n      for (i=0; l=lstring[i]; i++) {\r\n        arcs = this.getArcs(l, coord);\r\n        if (arcs) {\r\n          arcs.geom = geom;\r\n          arcs.type = geom.getType();\r\n          arcs.lstring = i;\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'Polygon': {\r\n      var lring = geom.getLinearRings();\r\n      for (i=0; l=lring[i]; i++) {\r\n        arcs = this.getArcs(l, coord);\r\n        if (arcs) {\r\n          arcs.geom = geom;\r\n          arcs.type = geom.getType();\r\n          arcs.index = i;\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiPolygon': {\r\n      var poly = geom.getPolygons();\r\n      for (i=0; l=poly[i]; i++) {\r\n        arcs = this.getArcs(l, coord);\r\n        if (arcs) {\r\n          arcs.geom = geom;\r\n          arcs.type = geom.getType();\r\n          arcs.poly = i;\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'GeometryCollection': {\r\n      g = geom.getGeometries();\r\n      for (i=0; l=g[i]; i++) {\r\n        arcs = this.getArcs(l, coord);\r\n        if (arcs) {\r\n          arcs.geom = geom;\r\n          arcs.g = i;\r\n          arcs.typeg = arcs.type;\r\n          arcs.type = geom.getType();\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    default: {\r\n      console.error('ol/interaction/ModifyFeature '+geom.getType()+' not supported!');\r\n      break;\r\n    }\r\n  }\r\n  return arcs;\r\n};\r\n\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `true` to start the drag sequence.\r\n */\r\nol_interaction_ModifyFeature.prototype.handleDownEvent = function(evt) {\r\n  if (!this.getActive()) return false;\r\n\r\n  // Something to move ?\r\n  var current = this.getClosestFeature(evt);\r\n\r\n  if (current && (this._condition(evt) || this._deleteCondition(evt))) {\r\n    var features = [];\r\n    this.arcs = [];\r\n\r\n    // Get features concerned\r\n    this.sources_.forEach(function(s) {\r\n      var extent = ol_extent_buffer (ol_extent_boundingExtent([current.coord]), this.tolerance_);\r\n      features = features.concat(features, s.getFeaturesInExtent(extent));\r\n    }.bind(this));\r\n\r\n    // Get arcs concerned\r\n    this._modifiedFeatures = [];\r\n    features.forEach(function(f) {\r\n      var a = this.getArcs(f.getGeometry(), current.coord);\r\n      if (a) {\r\n        if (this._insertVertexCondition(evt) || a.node) {\r\n          a.feature = f;\r\n          this._modifiedFeatures.push(f);\r\n          this.arcs.push(a);\r\n        }\r\n      }\r\n    }.bind(this));\r\n\r\n    if (this._modifiedFeatures.length) {\r\n      if (this._deleteCondition(evt)) {\r\n        return !this._removePoint(current, evt); \r\n      } else {\r\n        this.dispatchEvent({ \r\n          type:'modifystart', \r\n          coordinate: current.coord,\r\n          originalEvent: evt.originalEvent,\r\n          features: this._modifiedFeatures\r\n        });\r\n        this.handleDragEvent({ \r\n          coordinate: current.coord,\r\n          originalEvent: evt.originalEvent\r\n        })\r\n        return true;\r\n      }\r\n    } else {\r\n      return true;\r\n    }\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\n/** Get modified features\r\n * @return {Array<ol.Feature>} list of modified features\r\n */\r\nol_interaction_ModifyFeature.prototype.getModifiedFeatures = function() {\r\n  return this._modifiedFeatures || [];\r\n};\r\n\r\n/** Removes the vertex currently being pointed.\r\n */\r\nol_interaction_ModifyFeature.prototype.removePoint = function() {\r\n  this._removePoint({},{});\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype._getModification = function(a) {\r\n  var coords = a.coord1.concat(a.coord2);\r\n  switch (a.type) {\r\n    case 'LineString': {\r\n      if (a.closed) coords.push(coords[0]);\r\n      if (coords.length>1) {\r\n        if (a.geom.getCoordinates().length != coords.length) {\r\n          a.coords = coords;\r\n          return true;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiLineString': {\r\n      if (a.closed) coords.push(coords[0]);\r\n      if (coords.length>1) {\r\n        var c = a.geom.getCoordinates();\r\n        if (c[a.lstring].length != coords.length) {\r\n          c[a.lstring] = coords;\r\n          a.coords = c;\r\n          return true;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'Polygon': {\r\n      if (a.closed) coords.push(coords[0]);\r\n      if (coords.length>3) {\r\n        c = a.geom.getCoordinates();\r\n        if (c[a.index].length != coords.length) {\r\n          c[a.index] = coords;\r\n          a.coords = c;\r\n          return true;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiPolygon': {\r\n      if (a.closed) coords.push(coords[0]);\r\n      if (coords.length>3) {\r\n        c = a.geom.getCoordinates();\r\n        if (c[a.poly][a.index].length != coords.length) {\r\n          c[a.poly][a.index] = coords;\r\n          a.coords = c;\r\n          return true;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'GeometryCollection': {\r\n      a.type = a.typeg;\r\n      var geom = a.geom;\r\n      var geoms = geom.getGeometries();\r\n      a.geom = geoms[a.g];\r\n      var found = this._getModification(a);\r\n      // Restore current arc\r\n      geom.setGeometries(geoms);\r\n      a.geom = geom;\r\n      a.type = 'GeometryCollection';\r\n      return found;\r\n    }\r\n    default: {\r\n      //console.error('ol/interaction/ModifyFeature '+a.type+' not supported!');\r\n      break;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n/** Removes the vertex currently being pointed.\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype._removePoint = function(current, evt) {\r\n  if (!this.arcs) return false;\r\n\r\n  this.overlayLayer_.getSource().clear();\r\n\r\n  var found = false;\r\n  // Get all modifications\r\n  this.arcs.forEach(function(a) {\r\n    found = found || this._getModification(a);\r\n  }.bind(this));\r\n\r\n  // Almost one point is removed\r\n  if (found) {\r\n    this.dispatchEvent({ \r\n      type:'modifystart', \r\n      coordinate: current.coord,\r\n      originalEvent: evt.originalEvent,\r\n      features: this._modifiedFeatures\r\n    });\r\n    this.arcs.forEach(function(a) {\r\n      if (a.geom.getType() === 'GeometryCollection') {\r\n        if (a.coords) {\r\n          var geoms = a.geom.getGeometries();\r\n          geoms[a.g].setCoordinates(a.coords);\r\n          a.geom.setGeometries(geoms);\r\n        }\r\n      } else {\r\n        if (a.coords) a.geom.setCoordinates(a.coords);\r\n      }\r\n    }.bind(this));\r\n    this.dispatchEvent({ \r\n      type:'modifyend', \r\n      coordinate: current.coord,\r\n      originalEvent: evt.originalEvent,\r\n      features: this._modifiedFeatures\r\n    });\r\n  }\r\n\r\n  this.arcs = [];\r\n  return found;\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.handleUpEvent = function(e) {\r\n  if (!this.getActive()) return false;\r\n  if (!this.arcs || !this.arcs.length) return true;\r\n\r\n  this.overlayLayer_.getSource().clear();\r\n  this.dispatchEvent({ \r\n    type:'modifyend', \r\n    coordinate: e.coordinate,\r\n    originalEvent: e.originalEvent,\r\n    features: this._modifiedFeatures\r\n  });\r\n  \r\n  this.arcs = [];\r\n  return true;\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.setArcCoordinates = function(a, coords) {\r\n  var c;\r\n  switch (a.type) {\r\n    case 'Point': {\r\n      a.geom.setCoordinates(coords[0]);\r\n      break;\r\n    }\r\n    case 'MultiPoint': {\r\n      c = a.geom.getCoordinates();\r\n      c[a.index] = coords[0];\r\n      a.geom.setCoordinates(c);\r\n      break;\r\n    }\r\n    case 'LineString': {\r\n      a.geom.setCoordinates(coords);\r\n      break;\r\n    }\r\n    case 'MultiLineString': {\r\n      c = a.geom.getCoordinates();\r\n      c[a.lstring] = coords;\r\n      a.geom.setCoordinates(c);\r\n      break;\r\n    }\r\n    case 'Polygon': {\r\n      c = a.geom.getCoordinates();\r\n      c[a.index] = coords;\r\n      a.geom.setCoordinates(c);\r\n      break;\r\n    }\r\n    case 'MultiPolygon': {\r\n      c = a.geom.getCoordinates();\r\n      c[a.poly][a.index] = coords;\r\n      a.geom.setCoordinates(c);\r\n      break;\r\n    }\r\n    case 'GeometryCollection': {\r\n      a.type = a.typeg;\r\n      var geom = a.geom;\r\n      var geoms = geom.getGeometries();\r\n      a.geom = geoms[a.g];\r\n      this.setArcCoordinates(a, coords);\r\n      geom.setGeometries(geoms);\r\n      a.geom = geom;\r\n      a.type = 'GeometryCollection';\r\n      break;\r\n    }\r\n  }\r\n};\r\n/**\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.handleDragEvent = function(e) {\r\n  if (!this.getActive()) return false;\r\n  if (!this.arcs) return true;\r\n\r\n  // Show sketch\r\n  this.overlayLayer_.getSource().clear();\r\n  var p = new ol_Feature(new ol_geom_Point(e.coordinate));\r\n  this.overlayLayer_.getSource().addFeature(p);\r\n\r\n  // Nothing to do\r\n  if (!this.arcs.length) return true;\r\n\r\n  // Move arcs\r\n  this.arcs.forEach(function(a) {\r\n    var coords = a.coord1.concat([e.coordinate], a.coord2);\r\n    if (a.closed) coords.push(e.coordinate);\r\n    this.setArcCoordinates(a, coords);\r\n  }.bind(this));\r\n\r\n  this.dispatchEvent({ \r\n    type:'modifying', \r\n    coordinate: e.coordinate,\r\n    originalEvent: e.originalEvent,\r\n    features: this._modifiedFeatures\r\n  });\r\n\r\n  return true;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Event.\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.handleMoveEvent = function(e) {\r\n  if (!this.getActive()) return false;\r\n\r\n  this.overlayLayer_.getSource().clear();\r\n  var current = this.getClosestFeature(e);\r\n\r\n  // Draw sketch\r\n  if (current) {\r\n    var p = new ol_Feature(new ol_geom_Point(current.coord));\r\n    this.overlayLayer_.getSource().addFeature(p);\r\n  }\r\n\r\n  // Show cursor\r\n  var element = e.map.getTargetElement();\r\n  if (this.cursor_) {\r\n    if (current) {\r\n      if (element.style.cursor != this.cursor_) {\r\n        this.previousCursor_ = element.style.cursor;\r\n        element.style.cursor = this.cursor_;\r\n      }\r\n    } else if (this.previousCursor_ !== undefined) {\r\n      element.style.cursor = this.previousCursor_;\r\n      this.previousCursor_ = undefined;\r\n    }\r\n  }\r\n};\r\n\r\n/** Get the current feature to modify\r\n * @return {ol.Feature} \r\n */\r\nol_interaction_ModifyFeature.prototype.getCurrentFeature = function() {\r\n  return this.currentFeature;\r\n};\r\n\r\nexport default ol_interaction_ModifyFeature","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Interaction from 'ol/interaction/Interaction'\r\nimport ol_style_Style_defaultStyle from '../style/defaultStyle'\r\nimport ol_Collection from 'ol/Collection'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\nimport ol_geom_Circle from 'ol/geom/Circle'\r\nimport {fromCircle as ol_geom_Polygon_fromCircle} from 'ol/geom/Polygon'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport ol_Feature from 'ol/Feature'\r\n\r\n/** Interaction rotate\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires drawstart, drawing, drawend, drawcancel\r\n * @param {olx.interaction.TransformOptions} options\r\n *  @param {Array<ol.Layer>} source Destination source for the drawn features\r\n *  @param {ol.Collection<ol.Feature>} features Destination collection for the drawn features \r\n *  @param {ol.style.Style | Array.<ol.style.Style> | ol.style.StyleFunction | undefined} style style for the sketch\r\n *  @param {integer} sides number of sides, default 0 = circle\r\n *  @param { ol.events.ConditionType | undefined } squareCondition A function that takes an ol.MapBrowserEvent and returns a boolean to draw square features.\r\n *  @param { ol.events.ConditionType | undefined } centerCondition A function that takes an ol.MapBrowserEvent and returns a boolean to draw centered features.\r\n *  @param { bool } canRotate Allow rotation when centered + square, default: true\r\n *  @param { number } clickTolerance click tolerance on touch devices, default: 6\r\n *  @param { number } maxCircleCoordinates Maximum number of point on a circle, default: 100\r\n */\r\nvar ol_interaction_DrawRegular = function(options) {\r\n  if (!options) options={};\r\n\r\n  this.squaredClickTolerance_ = options.clickTolerance ? options.clickTolerance * options.clickTolerance : 36;\r\n  this.maxCircleCoordinates_ = options.maxCircleCoordinates || 100;\r\n\r\n  // Collection of feature to transform \r\n  this.features_ = options.features;\r\n  // List of layers to transform \r\n  this.source_ = options.source;\r\n  // Square condition\r\n  this.squareFn_ = options.squareCondition;\r\n  // Centered condition\r\n  this.centeredFn_ = options.centerCondition;\r\n  // Allow rotation when centered + square\r\n  this.canRotate_ = (options.canRotate !== false);\r\n  // Specify custom geometry name\r\n  this.geometryName_ = options.geometryName\r\n\r\n  // Number of sides (default=0: circle)\r\n  this.setSides(options.sides);\r\n\r\n  // Style\r\n  var defaultStyle = ol_style_Style_defaultStyle(true);\r\n\r\n  // Create a new overlay layer for the sketch\r\n  this.sketch_ = new ol_Collection();\r\n  this.overlayLayer_ = new ol_layer_Vector({\r\n    source: new ol_source_Vector({\r\n      features: this.sketch_,\r\n      useSpatialIndex: false\r\n    }),\r\n    name:'DrawRegular overlay',\r\n    displayInLayerSwitcher: false,\r\n    style: options.style || defaultStyle\r\n  });\r\n\r\n  ol_interaction_Interaction.call(this, {\t\r\n      /*\r\n      handleDownEvent: this.handleDownEvent_,\r\n      handleMoveEvent: this.handleMoveEvent_,\r\n      handleUpEvent: this.handleUpEvent_,\r\n      */\r\n      handleEvent: this.handleEvent_\r\n    });\r\n};\r\nol_ext_inherits(ol_interaction_DrawRegular, ol_interaction_Interaction);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.setMap = function(map) {\r\n  if (this.getMap()) this.getMap().removeLayer(this.overlayLayer_);\r\n  ol_interaction_Interaction.prototype.setMap.call (this, map);\r\n  this.overlayLayer_.setMap(map);\r\n};\r\n\r\n/**\r\n * Activate/deactivate the interaction\r\n * @param {boolean}\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.setActive = function(b) {\r\n  this.reset();\r\n  ol_interaction_Interaction.prototype.setActive.call (this, b);\r\n}\r\n\r\n/**\r\n * Reset the interaction\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.reset = function() {\r\n  this.overlayLayer_.getSource().clear();\r\n  this.started_ = false;\r\n}\r\n\r\n/**\r\n * Set the number of sides.\r\n * @param {int} number of sides.\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.setSides = function (nb) {\r\n  nb = parseInt(nb);\r\n  this.sides_ = nb>2 ? nb : 0;\r\n}\r\n\r\n/**\r\n * Allow rotation when centered + square\r\n * @param {bool} \r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.canRotate = function (b) {\r\n  if (b===true || b===false) this.canRotate_ = b;\r\n  return this.canRotate_;\r\n}\r\n\r\n/**\r\n * Get the number of sides.\r\n * @return {int} number of sides.\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.getSides = function () {\r\n  return this.sides_;\r\n}\r\n\r\n/** Default start angle array for each sides\r\n*/\r\nol_interaction_DrawRegular.prototype.startAngle = {\r\n  'default':Math.PI/2,\r\n  3: -Math.PI/2,\r\n  4: Math.PI/4\r\n};\r\n\r\n/** Get geom of the current drawing\r\n* @return {ol.geom.Polygon | ol.geom.Point}\r\n*/\r\nol_interaction_DrawRegular.prototype.getGeom_ = function () {\r\n  this.overlayLayer_.getSource().clear();\r\n  if (!this.center_) return false;\r\n\r\n  var g;\r\n  if (this.coord_) {\r\n    var center = this.center_;\r\n    var coord = this.coord_;\r\n\r\n    // Specific case: circle\r\n    var d, dmax, r, circle, centerPx;\r\n    if (!this.sides_ && this.square_ && !this.centered_) {\r\n      center = [(coord[0] + center[0])/2, (coord[1] + center[1])/2];\r\n      d = [coord[0] - center[0], coord[1] - center[1]];\r\n      r = Math.sqrt(d[0]*d[0]+d[1]*d[1]);\r\n      circle = new ol_geom_Circle(center, r, 'XY');\r\n      // Optimize points on the circle\r\n      centerPx = this.getMap().getPixelFromCoordinate(center);\r\n      dmax = Math.max (100, Math.abs(centerPx[0]-this.coordPx_[0]), Math.abs(centerPx[1]-this.coordPx_[1]));\r\n      dmax = Math.min ( this.maxCircleCoordinates_, Math.round(dmax / 3 ));\r\n      return ol_geom_Polygon_fromCircle (circle, dmax, 0);\r\n    } else {\r\n      var hasrotation = this.canRotate_ && this.centered_ && this.square_;\r\n      d = [coord[0] - center[0], coord[1] - center[1]];\r\n      if (this.square_ && !hasrotation) {\r\n        //var d = [coord[0] - center[0], coord[1] - center[1]];\r\n        var dm = Math.max (Math.abs(d[0]), Math.abs(d[1])); \r\n        coord = [ \r\n          center[0] + (d[0]>0 ? dm:-dm),\r\n          center[1] + (d[1]>0 ? dm:-dm)\r\n        ];\r\n      }\r\n      r = Math.sqrt(d[0]*d[0]+d[1]*d[1]);\r\n      if (r>0) {\r\n        circle = new ol_geom_Circle(center, r, 'XY');\r\n        var a;\r\n        if (hasrotation) a = Math.atan2(d[1], d[0]);\r\n        else a = this.startAngle[this.sides_] || this.startAngle['default'];\r\n\r\n        if (this.sides_) {\r\n          g = ol_geom_Polygon_fromCircle (circle, this.sides_, a);\r\n        } else {\r\n          // Optimize points on the circle\r\n          centerPx = this.getMap().getPixelFromCoordinate(this.center_);\r\n          dmax = Math.max (100, Math.abs(centerPx[0]-this.coordPx_[0]), Math.abs(centerPx[1]-this.coordPx_[1]));\r\n          dmax = Math.min ( this.maxCircleCoordinates_, Math.round(dmax / (this.centered_ ? 3:5) ));\r\n          g = ol_geom_Polygon_fromCircle (circle, dmax, 0);\r\n        }\r\n\r\n        if (hasrotation) return g;\r\n      \r\n        // Scale polygon to fit extent\r\n        var ext = g.getExtent();\r\n        if (!this.centered_) center = this.center_;\r\n        else center = [ 2*this.center_[0]-this.coord_[0], 2*this.center_[1]-this.coord_[1] ];\r\n        var scx = (center[0] - coord[0]) / (ext[0] - ext[2]);\r\n        var scy = (center[1] - coord[1]) / (ext[1] - ext[3]);\r\n        if (this.square_) {\r\n          var sc = Math.min(Math.abs(scx),Math.abs(scy));\r\n          scx = Math.sign(scx)*sc;\r\n          scy = Math.sign(scy)*sc;\r\n        }\r\n        var t = [ center[0] - ext[0]*scx, center[1] - ext[1]*scy ];\r\n      \r\n        g.applyTransform(function(g1, g2, dim) {\r\n          for (var i=0; i<g1.length; i+=dim) {\r\n            g2[i] = g1[i]*scx + t[0];\r\n            g2[i+1] = g1[i+1]*scy + t[1];\r\n          }\r\n          return g2;\r\n        });\r\n        return g;\r\n      }\r\n    }\r\n  }\r\n\r\n  // No geom => return a point\r\n  return new ol_geom_Point(this.center_);\r\n};\r\n\r\n/** Draw sketch\r\n* @return {ol.Feature} The feature being drawn.\r\n*/\r\nol_interaction_DrawRegular.prototype.drawSketch_ = function(evt) {\r\n  this.overlayLayer_.getSource().clear();\r\n  if (evt) {\r\n    this.square_ = this.squareFn_ ? this.squareFn_(evt) : evt.originalEvent.shiftKey;\r\n    this.centered_ = this.centeredFn_ ? this.centeredFn_(evt) : evt.originalEvent.metaKey || evt.originalEvent.ctrlKey;\r\n    var g = this.getGeom_();\r\n    if (g) {\r\n      var f = this.feature_;\r\n      if (this.geometryName_) f.setGeometryName(this.geometryName_)\r\n\r\n      //f.setGeometry (g);\r\n      if (g.getType()==='Polygon') f.getGeometry().setCoordinates(g.getCoordinates());\r\n      this.overlayLayer_.getSource().addFeature(f);\r\n      if (this.coord_ \r\n        && this.square_ \r\n        && ((this.canRotate_ && this.centered_ && this.coord_) || (!this.sides_ && !this.centered_))) {\r\n        this.overlayLayer_.getSource().addFeature(new ol_Feature(new ol_geom_LineString([this.center_,this.coord_])));\r\n      }\r\n      return f;\r\n    }\r\n  }\r\n};\r\n\r\n/** Draw sketch (Point)\r\n*/\r\nol_interaction_DrawRegular.prototype.drawPoint_ = function(pt, noclear) {\r\n  if (!noclear) this.overlayLayer_.getSource().clear();\r\n  this.overlayLayer_.getSource().addFeature(new ol_Feature(new ol_geom_Point(pt)));\r\n};\r\n\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n */\r\nol_interaction_DrawRegular.prototype.handleEvent_ = function(evt) {\r\n  var dx, dy;\r\n  // Event date time\r\n  this._eventTime = new Date();\r\n  switch (evt.type) {\r\n    case \"pointerdown\": {\r\n      this.downPx_ = evt.pixel;\r\n      this.start_(evt);\r\n      // Test long touch\r\n      var dt = 500;\r\n      this._longTouch = false;\r\n      setTimeout(function() {\r\n        this._longTouch = (new Date() - this._eventTime > .9*dt);\r\n        if (this._longTouch) this.handleMoveEvent_(evt);\r\n      }.bind(this), dt);\r\n      break;\r\n    }\r\n    case \"pointerup\": {\r\n      // Started and fisrt move\r\n      if (this.started_ && this.coord_) {\r\n        dx = this.downPx_[0] - evt.pixel[0];\r\n        dy = this.downPx_[1] - evt.pixel[1];\r\n        if (dx*dx + dy*dy <= this.squaredClickTolerance_) {\r\n          // The pointer has moved\r\n          if ( this.lastEvent == \"pointermove\" || this.lastEvent == \"keydown\" ) {\r\n            this.end_(evt);\r\n          }\r\n          // On touch device there is no move event : terminate = click on the same point\r\n          else {\r\n            dx = this.upPx_[0] - evt.pixel[0];\r\n            dy = this.upPx_[1] - evt.pixel[1];\r\n            if ( dx*dx + dy*dy <= this.squaredClickTolerance_) {\r\n              this.end_(evt);\r\n            } else  {\r\n              this.handleMoveEvent_(evt);\r\n              this.drawPoint_(evt.coordinate,true);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      this.upPx_ = evt.pixel;\t\r\n      break;\r\n    }\r\n    case \"pointerdrag\": {\r\n      if (this.started_) {\r\n        var centerPx = this.getMap().getPixelFromCoordinate(this.center_);\r\n        dx = centerPx[0] - evt.pixel[0];\r\n        dy = centerPx[1] - evt.pixel[1];\r\n        if (dx*dx + dy*dy <= this.squaredClickTolerance_) {\r\n          this.reset();\r\n        }\r\n      }\r\n      return !this._longTouch;\r\n      // break;\r\n    }\r\n    case \"pointermove\": {\r\n      if (this.started_) {\r\n        dx = this.downPx_[0] - evt.pixel[0];\r\n        dy = this.downPx_[1] - evt.pixel[1];\r\n        if (dx*dx + dy*dy > this.squaredClickTolerance_) {\r\n          this.handleMoveEvent_(evt);\r\n          this.lastEvent = evt.type;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    default: {\r\n      this.lastEvent = evt.type;\r\n      // Prevent zoom in on dblclick\r\n      if (this.started_ && evt.type==='dblclick') {\r\n        //evt.stopPropagation();\r\n        return false;\r\n      }\r\n      break;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/** Stop drawing.\r\n */\r\nol_interaction_DrawRegular.prototype.finishDrawing = function() {\r\n  if (this.started_ && this.coord_) {\r\n    this.end_({ pixel: this.upPx_, coordinate: this.coord_});\r\n  }\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Event.\r\n */\r\nol_interaction_DrawRegular.prototype.handleMoveEvent_ = function(evt) {\r\n  if (this.started_) {\r\n    this.coord_ = evt.coordinate;\r\n    this.coordPx_ = evt.pixel;\r\n    var f = this.drawSketch_(evt);\r\n    this.dispatchEvent({ \r\n      type:'drawing', \r\n      feature: f, \r\n      pixel: evt.pixel, \r\n      startCoordinate: this.center_,\r\n      coordinate: evt.coordinate, \r\n      square: this.square_, \r\n      centered: this.centered_ \r\n    });\r\n  } else  {\r\n    this.drawPoint_(evt.coordinate);\r\n  }\r\n};\r\n\r\n/** Start an new draw\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `false` to stop the drag sequence.\r\n */\r\nol_interaction_DrawRegular.prototype.start_ = function(evt) {\r\n  if (!this.started_) {\r\n    this.started_ = true;\r\n    this.center_ = evt.coordinate;\r\n    this.coord_ = null;\r\n    var geom = new ol_geom_Polygon([[evt.coordinate,evt.coordinate,evt.coordinate]]);\r\n    var f = this.feature_ = new ol_Feature(geom);\r\n    this.drawSketch_(evt);\r\n    this.dispatchEvent({ type:'drawstart', feature: f, pixel: evt.pixel, coordinate: evt.coordinate });\r\n  } else {\r\n    this.coord_ = evt.coordinate;\r\n  }\r\n};\r\n\r\n/** End drawing\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `false` to stop the drag sequence.\r\n */\r\nol_interaction_DrawRegular.prototype.end_ = function(evt) {\r\n  this.coord_ = evt.coordinate;\r\n  this.started_ = false;\r\n  if (this.coord_ && (this.center_[0]!==this.coord_[0] || this.center_[1]!==this.coord_[1])) {\r\n    var f = this.feature_;\r\n    if (this.geometryName_) f.setGeometryName(this.geometryName_)\r\n\r\n    f.setGeometry(this.getGeom_());\r\n    if (this.source_) this.source_.addFeature(f);\r\n    else if (this.features_) this.features_.push(f);\r\n    this.dispatchEvent({ type:'drawend', feature: f, pixel: evt.pixel, coordinate: evt.coordinate, square: this.square_, centered: this.centered_ });\r\n  } else {\r\n    this.dispatchEvent({ type:'drawcancel', feature: null, pixel: evt.pixel, coordinate: evt.coordinate, square: this.square_, centered: this.centered_ });\r\n  }\r\n\r\n  this.center_ = this.coord_ = null;\r\n  this.drawSketch_();\r\n};\r\n\r\nexport default ol_interaction_DrawRegular\r\n","/*\tCopyright (c) 2017 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport ol_geom_MultiPolygon from 'ol/geom/MultiPolygon'\r\nimport ol_geom_LinearRing from 'ol/geom/LinearRing'\r\nimport ol_interaction_Draw from 'ol/interaction/Draw'\r\nimport ol_interaction_Select from 'ol/interaction/Select'\r\n\r\n/** Interaction to draw holes in a polygon.\r\n * It fires a drawstart, drawend event when drawing the hole\r\n * and a modifystart, modifyend event before and after inserting the hole in the feature geometry.\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires drawstart\r\n * @fires drawend\r\n * @fires modifystart\r\n * @fires modifyend\r\n * @param {olx.interaction.DrawHoleOptions} options extend olx.interaction.DrawOptions\r\n * \t@param {Array<ol.layer.Vector> | function | undefined} options.layers A list of layers from which polygons should be selected. Alternatively, a filter function can be provided. default: all visible layers\r\n * \t@param {Array<ol.Feature> | ol.Collection<ol.Feature> | function | undefined} options.features An array or a collection of features the interaction applies on or a function that takes a feature and a layer and returns true if the feature is a candidate\r\n * \t@param { ol.style.Style | Array<ol.style.Style> | StyleFunction | undefined }\tStyle for the selected features, default: default edit style\r\n */\r\nvar ol_interaction_DrawHole = function(options) {\r\n  if (!options) options = {};\r\n  var self = this;\r\n\r\n  // Select interaction for the current feature\r\n  this._select = new ol_interaction_Select({ style: options.style });\r\n  this._select.setActive(false);\r\n\r\n  // Geometry function that test points inside the current\r\n  var geometryFn, geomFn = options.geometryFunction;\r\n  if (geomFn) {\r\n    geometryFn = function(c,g) {\r\n      g = self._geometryFn (c, g);\r\n      return geomFn (c,g);\r\n    }\r\n  } else {\r\n    geometryFn = function(c,g) { return self._geometryFn (c, g); }\r\n  }\r\n\r\n  // Create draw interaction\r\n  options.type = \"Polygon\";\r\n  options.geometryFunction = geometryFn;\r\n  ol_interaction_Draw.call(this, options);\r\n\r\n  // Layer filter function\r\n  if (options.layers) {\r\n    if (typeof (options.layers) === 'function') {\r\n      this.layers_ = options.layers;\r\n    } else if (options.layers.indexOf) {\r\n      this.layers_ = function(l) {\r\n        return (options.layers.indexOf(l) >= 0); \r\n      };\r\n    }\r\n  }\r\n\r\n  // Features to apply on \r\n  if (typeof(options.features) === 'function') {\r\n    this._features = options.features;\r\n  } else if (options.features) {\r\n    var features = options.features;\r\n    this._features = function(f) {\r\n      if (features.indexOf) {\r\n        return !!features[features.indexOf(f)];\r\n      } else {\r\n        return !!features.item(features.getArray().indexOf(f));\r\n      }\r\n    }\r\n  } else {\r\n    this._features = function() { return true }\r\n  }\r\n\r\n  // Start drawing if inside a feature\r\n  this.on('drawstart', this._startDrawing.bind(this));\r\n  // End drawing add the hole to the current Polygon\r\n  this.on('drawend', this._finishDrawing.bind(this));\r\n};\r\nol_ext_inherits(ol_interaction_DrawHole, ol_interaction_Draw);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_DrawHole.prototype.setMap = function(map) {\r\n  if (this.getMap()) this.getMap().removeInteraction(this._select);\r\n  if (map) map.addInteraction(this._select);\r\n  ol_interaction_Draw.prototype.setMap.call (this, map);\r\n};\r\n\r\n/**\r\n * Activate/deactivate the interaction\r\n * @param {boolean}\r\n * @api stable\r\n */\r\nol_interaction_DrawHole.prototype.setActive = function(b) {\r\n  this._select.getFeatures().clear();\r\n  ol_interaction_Draw.prototype.setActive.call (this, b);\r\n};\r\n\r\n/**\r\n * Remove last point of the feature currently being drawn \r\n * (test if points to remove before).\r\n */\r\nol_interaction_DrawHole.prototype.removeLastPoint = function() {\r\n  if (this._feature && this._feature.getGeometry().getCoordinates()[0].length>2) {\r\n    ol_interaction_Draw.prototype.removeLastPoint.call(this);\r\n  }\r\n};\r\n\r\n/** \r\n * Get the current polygon to hole\r\n * @return {ol.Feature}\r\n */\r\nol_interaction_DrawHole.prototype.getPolygon = function() {\r\n  return this._polygon;\r\n  // return this._select.getFeatures().item(0).getGeometry();\r\n};\r\n\r\n/**\r\n * Get current feature to add a hole and start drawing\r\n * @param {ol_interaction_Draw.Event} e\r\n * @private\r\n */\r\nol_interaction_DrawHole.prototype._startDrawing = function(e) {\r\n  var map = this.getMap();\r\n  this._feature = e.feature;\r\n  var coord = e.feature.getGeometry().getCoordinates()[0][0];\r\n  this._current = null;\r\n  // Check object under the pointer\r\n  map.forEachFeatureAtPixel(\r\n    map.getPixelFromCoordinate(coord),\r\n    function(feature, layer) {\r\n      if (this._features(feature, layer)) {\r\n        var poly = feature.getGeometry();\r\n        if (poly.getType() === \"Polygon\"\r\n          && poly.intersectsCoordinate(coord)) {\r\n          this._polygonIndex = false;\r\n          this._polygon = poly;\r\n          this._current = feature;\r\n        } else if (poly.getType() === \"MultiPolygon\"\r\n          && poly.intersectsCoordinate(coord)) {\r\n          for (var i=0, p; p=poly.getPolygon(i); i++) {\r\n            if (p.intersectsCoordinate(coord)) {\r\n              this._polygonIndex = i;\r\n              this._polygon = p;\r\n              this._current = feature;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }.bind(this), {\r\n      layerFilter: this.layers_\r\n    }\r\n  );\r\n  this._select.getFeatures().clear();\r\n  if (!this._current) {\r\n    this.setActive(false);\r\n    this.setActive(true);\r\n  } else {\r\n    this._select.getFeatures().push(this._current);\r\n  }\r\n};\r\n\r\n/**\r\n * Stop drawing and add the sketch feature to the target feature. \r\n * @param {ol_interaction_Draw.Event} e\r\n * @private\r\n */\r\nol_interaction_DrawHole.prototype._finishDrawing = function(e) {\r\n  // The feature is the hole\r\n  e.hole = e.feature;\r\n  // Get the current feature\r\n  e.feature = this._select.getFeatures().item(0);\r\n  this.dispatchEvent({ type: 'modifystart', features: [ this._current ] });\r\n  // Create the hole\r\n  var c = e.hole.getGeometry().getCoordinates()[0];\r\n  if (c.length > 3) {\r\n    if (this._polygonIndex!==false) {\r\n      var geom = e.feature.getGeometry();\r\n      var newGeom = new ol_geom_MultiPolygon([]);\r\n      for (var i=0, pi; pi=geom.getPolygon(i); i++) {\r\n        if (i===this._polygonIndex) {\r\n          pi.appendLinearRing(new ol_geom_LinearRing(c));\r\n          newGeom.appendPolygon(pi);\r\n        } else {\r\n          newGeom.appendPolygon(pi);\r\n        }\r\n      }\r\n      e.feature.setGeometry(newGeom);\r\n    } else {\r\n      this.getPolygon().appendLinearRing(new ol_geom_LinearRing(c));\r\n    }\r\n  }\r\n  this.dispatchEvent({ type: 'modifyend', features: [ this._current ] });\r\n  // reset\r\n  this._feature = null;\r\n  this._select.getFeatures().clear();\r\n};\r\n\r\n/**\r\n * Function that is called when a geometry's coordinates are updated.\r\n * @param {Array<ol.coordinate>} coordinates\r\n * @param {ol_geom_Polygon} geometry\r\n * @return {ol_geom_Polygon}\r\n * @private\r\n */\r\nol_interaction_DrawHole.prototype._geometryFn = function(coordinates, geometry) {\r\n  var coord = coordinates[0].pop();\r\n  if (!this.getPolygon() || this.getPolygon().intersectsCoordinate(coord)) {\r\n    this.lastOKCoord = [coord[0],coord[1]];\r\n  }\r\n  coordinates[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]);\r\n\r\n  if (geometry) {\r\n    geometry.setCoordinates([coordinates[0].concat([coordinates[0][0]])]);\r\n  } else {\r\n    geometry = new ol_geom_Polygon(coordinates);\r\n  }\r\n  return geometry;\r\n};\r\n\r\nexport default ol_interaction_DrawHole\r\n","import ol_ext_inherits from '../util/ext'\r\nimport {shiftKeyOnly as ol_events_condition_shiftKeyOnly} from 'ol/events/condition'\r\nimport {click as ol_events_condition_click} from 'ol/events/condition'\r\nimport ol_interaction_Draw from 'ol/interaction/Draw'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport ol_interaction_Select from 'ol/interaction/Select'\r\n\r\nimport ol_control_Bar from './Bar'\r\nimport ol_control_Button from './Button'\r\nimport ol_control_Toggle from './Toggle'\r\nimport ol_control_TextButton from './TextButton'\r\nimport ol_interaction_Delete from '../interaction/Delete'\r\nimport ol_ext_element from '../util/element'\r\nimport ol_interaction_Offset from '../interaction/Offset'\r\nimport ol_interaction_Split from '../interaction/Split'\r\nimport ol_interaction_Transform from '../interaction/Transform'\r\nimport ol_interaction_ModifyFeature from '../interaction/ModifyFeature'\r\nimport ol_interaction_DrawRegular from '../interaction/DrawRegular'\r\nimport ol_interaction_DrawHole from '../interaction/DrawHole'\r\n\r\n/** Control bar for editing in a layer\r\n * @constructor\r\n * @extends {ol_control_Bar}\r\n * @fires info\r\n * @param {Object=} options Control options.\r\n *\t@param {String} options.className class of the control\r\n *\t@param {String} options.target Specify a target if you want the control to be rendered outside of the map's viewport.\r\n *\t@param {boolean} options.edition false to remove the edition tools, default true\r\n *\t@param {Object} options.interactions List of interactions to add to the bar \r\n *    ie. Select, Delete, Info, DrawPoint, DrawLine, DrawPolygon\r\n *    Each interaction can be an interaction or true (to get the default one) or false to remove it from bar\r\n *\t@param {ol.source.Vector} options.source Source for the drawn features. \r\n */\r\nvar ol_control_EditBar = function(options) {\r\n  options = options || {};\r\n  options.interactions = options.interactions || {};\r\n\r\n  // New bar\r\n\tol_control_Bar.call(this, {\r\n    className: (options.className ? options.className+' ': '') + 'ol-editbar',\r\n    toggleOne: true,\r\n\t\ttarget: options.target\r\n  });\r\n\r\n  this._source = options.source;\r\n  // Add buttons / interaction\r\n  this._interactions = {};\r\n  this._setSelectInteraction(options);\r\n  if (options.edition!==false) this._setEditInteraction(options);\r\n  this._setModifyInteraction(options);\r\n};\r\nol_ext_inherits(ol_control_EditBar, ol_control_Bar);\r\n\r\n/**\r\n * Set the map instance the control is associated with\r\n * and add its controls associated to this map.\r\n * @param {_ol_Map_} map The map instance.\r\n */\r\nol_control_EditBar.prototype.setMap = function (map) {\r\n  if (this.getMap()) {\r\n    if (this._interactions.Delete) this.getMap().removeInteraction(this._interactions.Delete);\r\n    if (this._interactions.ModifySelect) this.getMap().removeInteraction(this._interactions.ModifySelect);\r\n  }\r\n  \r\n  ol_control_Bar.prototype.setMap.call(this, map);\r\n\r\n  if (this.getMap()) {\r\n    if (this._interactions.Delete) this.getMap().addInteraction(this._interactions.Delete);\r\n    if (this._interactions.ModifySelect) this.getMap().addInteraction(this._interactions.ModifySelect);\r\n  }\r\n};\r\n\r\n/** Get an interaction associated with the bar\r\n * @param {string} name \r\n */\r\nol_control_EditBar.prototype.getInteraction = function (name) {\r\n  return this._interactions[name];\r\n};\r\n\r\n/** Get the option title */\r\nol_control_EditBar.prototype._getTitle = function (option) {\r\n  return (option && option.title) ? option.title : option;\r\n};\r\n\r\n/** Add selection tool:\r\n * 1. a toggle control with a select interaction\r\n * 2. an option bar to delete / get information on the selected feature\r\n * @private\r\n */\r\nol_control_EditBar.prototype._setSelectInteraction = function (options) {\r\n  var self = this;\r\n  \r\n  // Sub bar\r\n  var sbar = new ol_control_Bar();\r\n  var selectCtrl;\r\n\r\n  // Delete button\r\n  if (options.interactions.Delete !== false) {\r\n    if (options.interactions.Delete instanceof ol_interaction_Delete) {\r\n      this._interactions.Delete = options.interactions.Delete; \r\n    } else {\r\n      this._interactions.Delete = new ol_interaction_Delete();\r\n    }\r\n    var del = this._interactions.Delete;\r\n    del.setActive(false);\r\n    if (this.getMap()) this.getMap().addInteraction(del);\r\n    sbar.addControl (new ol_control_Button({\r\n      className: 'ol-delete',\r\n      title: this._getTitle(options.interactions.Delete) || \"Delete\",\r\n      name: 'Delete',\r\n      handleClick: function(e) {\r\n        // Delete selection\r\n        del.delete(selectCtrl.getInteraction().getFeatures());\r\n        var evt = {\r\n          type: 'select',\r\n          selected: [],\r\n          deselected: selectCtrl.getInteraction().getFeatures().getArray().slice(),\r\n          mapBrowserEvent: e.mapBrowserEvent\r\n        };\r\n        selectCtrl.getInteraction().getFeatures().clear();\r\n        selectCtrl.getInteraction().dispatchEvent(evt);\r\n      }\r\n    }));\r\n  }\r\n\r\n  // Info button\r\n  if (options.interactions.Info !== false) {\r\n    sbar.addControl (new ol_control_Button({\r\n      className: 'ol-info',\r\n      name: 'Info',\r\n      title: this._getTitle(options.interactions.Info) || \"Show informations\",\r\n      handleClick: function() {\r\n        self.dispatchEvent({ \r\n          type: 'info', \r\n          features: selectCtrl.getInteraction().getFeatures() \r\n        });\r\n      }\r\n    }));\r\n  }\r\n\r\n  // Select button\r\n  if (options.interactions.Select !== false) {\r\n    if (options.interactions.Select instanceof ol_interaction_Select) {\r\n      this._interactions.Select = options.interactions.Select\r\n    } else {\r\n      this._interactions.Select = new ol_interaction_Select({\r\n        condition: ol_events_condition_click\r\n      });\r\n    }\r\n    var sel = this._interactions.Select;\r\n    selectCtrl = new ol_control_Toggle({\r\n      className: 'ol-selection',\r\n      name: 'Select',\r\n      title: this._getTitle(options.interactions.Select) || \"Select\",\r\n      interaction: sel,\r\n      bar: sbar.getControls().length ? sbar : undefined,\r\n      autoActivate:true,\r\n      active:true\r\n    });\r\n\r\n    this.addControl(selectCtrl);\r\n    sel.on('change:active', function() {\r\n      sel.getFeatures().clear();\r\n    });\r\n  }\r\n};\r\n\r\n\r\n/** Add editing tools\r\n * @private\r\n */ \r\nol_control_EditBar.prototype._setEditInteraction = function (options) {\r\n  if (options.interactions.DrawPoint !== false) {\r\n    if (options.interactions.DrawPoint instanceof ol_interaction_Draw) {\r\n      this._interactions.DrawPoint = options.interactions.DrawPoint;\r\n    } else {\r\n      this._interactions.DrawPoint = new ol_interaction_Draw({\r\n        type: 'Point',\r\n        source: this._source\r\n      });\r\n    }\r\n    var pedit = new ol_control_Toggle({\r\n      className: 'ol-drawpoint',\r\n      name: 'DrawPoint',\r\n      title: this._getTitle(options.interactions.DrawPoint) || 'Point',\r\n      interaction: this._interactions.DrawPoint\r\n    });\r\n    this.addControl ( pedit );\r\n  }\r\n\r\n  if (options.interactions.DrawLine !== false) {\r\n    if (options.interactions.DrawLine instanceof ol_interaction_Draw) {\r\n      this._interactions.DrawLine = options.interactions.DrawLine\r\n    } else {\r\n      this._interactions.DrawLine = new ol_interaction_Draw ({\r\n        type: 'LineString',\r\n        source: this._source,\r\n        // Count inserted points\r\n        geometryFunction: function(coordinates, geometry) {\r\n          if (geometry) geometry.setCoordinates(coordinates);\r\n          else geometry = new ol_geom_LineString(coordinates);\r\n          this.nbpts = geometry.getCoordinates().length;\r\n          return geometry;\r\n        }\r\n      });\r\n    }\r\n    var ledit = new ol_control_Toggle({\r\n      className: 'ol-drawline',\r\n      title: this._getTitle(options.interactions.DrawLine) || 'LineString',\r\n      name: 'DrawLine',\r\n      interaction: this._interactions.DrawLine,\r\n      // Options bar associated with the control\r\n      bar: new ol_control_Bar ({\r\n        controls:[ \r\n          new ol_control_TextButton({\r\n            html: this._getTitle(options.interactions.UndoDraw) || 'undo',\r\n            title: this._getTitle(options.interactions.UndoDraw) || \"delete last point\",\r\n            handleClick: function() {\r\n              if (ledit.getInteraction().nbpts>1) ledit.getInteraction().removeLastPoint();\r\n            }\r\n          }),\r\n          new ol_control_TextButton ({\r\n            html: this._getTitle(options.interactions.FinishDraw) || 'finish',\r\n            title: this._getTitle(options.interactions.FinishDraw) || \"finish\",\r\n            handleClick: function() {\r\n              // Prevent null objects on finishDrawing\r\n              if (ledit.getInteraction().nbpts>2) ledit.getInteraction().finishDrawing();\r\n            }\r\n          })\r\n        ]\r\n      }) \r\n    });\r\n\r\n    this.addControl ( ledit );\r\n  }\r\n\r\n  if (options.interactions.DrawPolygon !== false) {\r\n    if (options.interactions.DrawPolygon instanceof ol_interaction_Draw){\r\n      this._interactions.DrawPolygon = options.interactions.DrawPolygon\r\n    } else {\r\n      this._interactions.DrawPolygon = new ol_interaction_Draw ({\r\n        type: 'Polygon',\r\n        source: this._source,\r\n        // Count inserted points\r\n        geometryFunction: function(coordinates, geometry) {\r\n          this.nbpts = coordinates[0].length;\r\n          if (geometry) geometry.setCoordinates([coordinates[0].concat([coordinates[0][0]])]);\r\n          else geometry = new ol_geom_Polygon(coordinates);\r\n          return geometry;\r\n        }\r\n      });\r\n    }\r\n    this._setDrawPolygon(\r\n      'ol-drawpolygon', \r\n      this._interactions.DrawPolygon, \r\n      this._getTitle(options.interactions.DrawPolygon) || 'Polygon', \r\n      'DrawPolygon',\r\n      options\r\n    );\r\n  }\r\n\r\n  // Draw hole\r\n  if (options.interactions.DrawHole !== false) {\r\n    if (options.interactions.DrawHole instanceof ol_interaction_DrawHole){\r\n      this._interactions.DrawHole = options.interactions.DrawHole;\r\n    } else {\r\n      this._interactions.DrawHole = new ol_interaction_DrawHole ();\r\n    }\r\n    this._setDrawPolygon(\r\n      'ol-drawhole', \r\n      this._interactions.DrawHole, \r\n      this._getTitle(options.interactions.DrawHole) || 'Hole',\r\n      'DrawHole', \r\n      options\r\n    );\r\n  }\r\n\r\n  // Draw regular\r\n  if (options.interactions.DrawRegular !== false) {\r\n    if (options.interactions.DrawRegular instanceof ol_interaction_DrawRegular) {\r\n      this._interactions.DrawRegular = options.interactions.DrawRegular\r\n    } else {\r\n      this._interactions.DrawRegular = new ol_interaction_DrawRegular ({\r\n        source: this._source,\r\n        sides: 4\r\n      });\r\n    }\r\n    var regular = this._interactions.DrawRegular;\r\n\r\n    var div = document.createElement('DIV');\r\n\r\n    var down = ol_ext_element.create('DIV', { parent: div });\r\n    ol_ext_element.addListener(down, ['click', 'touchstart'], function() {\r\n      var sides = regular.getSides() -1;\r\n      if (sides < 2) sides = 2;\r\n      regular.setSides (sides);\r\n      text.textContent = sides>2 ? sides+' pts' : 'circle';\r\n    }.bind(this));\r\n\r\n    var text = ol_ext_element.create('TEXT', { html:'4 pts', parent: div });\r\n    \r\n    var up = ol_ext_element.create('DIV', { parent: div });\r\n    ol_ext_element.addListener(up, ['click', 'touchstart'], function() {\r\n      var sides = regular.getSides() +1;\r\n      if (sides<3) sides=3;\r\n      regular.setSides(sides);\r\n      text.textContent = sides+' pts';\r\n    }.bind(this));\r\n\r\n    var ctrl = new ol_control_Toggle({\r\n      className: 'ol-drawregular',\r\n      title: this._getTitle(options.interactions.DrawRegular) || 'Regular',\r\n      name: 'DrawRegular',\r\n      interaction: this._interactions.DrawRegular,\r\n      // Options bar associated with the control\r\n      bar: new ol_control_Bar ({\r\n        controls:[ \r\n          new ol_control_TextButton({\r\n            html: div\r\n          })\r\n        ]\r\n      }) \r\n    });\r\n    this.addControl (ctrl);\r\n  }\r\n\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nol_control_EditBar.prototype._setDrawPolygon = function (className, interaction, title, name, options) {\r\n  var fedit = new ol_control_Toggle ({\r\n    className: className,\r\n    name: name,\r\n    title: title,\r\n    interaction: interaction,\r\n    // Options bar associated with the control\r\n    bar: new ol_control_Bar({\r\n      controls:[ \r\n        new ol_control_TextButton ({\r\n          html: this._getTitle(options.interactions.UndoDraw) || 'undo',\r\n          title: this._getTitle(options.interactions.UndoDraw) || 'undo last point',\r\n          handleClick: function(){\r\n            if (fedit.getInteraction().nbpts>1) fedit.getInteraction().removeLastPoint();\r\n          }\r\n        }),\r\n        new ol_control_TextButton({\r\n          html: this._getTitle(options.interactions.FinishDraw) || 'finish',\r\n          title: this._getTitle(options.interactions.FinishDraw) || 'finish',\r\n          handleClick: function() {\r\n            // Prevent null objects on finishDrawing\r\n            if (fedit.getInteraction().nbpts>3) fedit.getInteraction().finishDrawing();\r\n          }\r\n        })\r\n      ]\r\n    }) \r\n  });\r\n  this.addControl (fedit);\r\n  return fedit;\r\n};\r\n\r\n/** Add modify tools\r\n * @private\r\n */ \r\nol_control_EditBar.prototype._setModifyInteraction = function (options) {\r\n  // Modify on selected features\r\n  if (options.interactions.ModifySelect !== false && options.interactions.Select !== false) {\r\n    if (options.interactions.ModifySelect instanceof ol_interaction_ModifyFeature) {\r\n      this._interactions.ModifySelect = options.interactions.ModifySelect;\r\n    } else {\r\n      this._interactions.ModifySelect = new ol_interaction_ModifyFeature({\r\n        features: this.getInteraction('Select').getFeatures()\r\n      });\r\n    }\r\n    if (this.getMap()) this.getMap().addInteraction(this._interactions.ModifySelect);\r\n    // Activate with select\r\n    this._interactions.ModifySelect.setActive(this._interactions.Select.getActive());\r\n    this._interactions.Select.on('change:active', function() {\r\n      this._interactions.ModifySelect.setActive(this._interactions.Select.getActive());\r\n    }.bind(this));\r\n  }\r\n\r\n  if (options.interactions.Transform !== false) {\r\n    if (options.interactions.Transform instanceof ol_interaction_Transform) {\r\n      this._interactions.Transform = options.interactions.Transform;\r\n    } else {\r\n      this._interactions.Transform = new ol_interaction_Transform ({\r\n        addCondition: ol_events_condition_shiftKeyOnly\r\n      });\r\n    }\r\n    var transform = new ol_control_Toggle ({\r\n      html: '<i></i>',\r\n      className: 'ol-transform',\r\n      title: this._getTitle(options.interactions.Transform) || 'Transform',\r\n      name: 'Transform',\r\n      interaction: this._interactions.Transform\r\n    });\r\n    this.addControl (transform);\r\n  }\r\n\r\n  if (options.interactions.Split !== false) {\r\n    if (options.interactions.Split instanceof ol_interaction_Split) {\r\n      this._interactions.Split = options.interactions.Split;\r\n    } else {\r\n      this._interactions.Split = new ol_interaction_Split ({\r\n          sources: this._source\r\n      });\r\n    }\r\n    var split = new ol_control_Toggle ({\r\n      className: 'ol-split',\r\n      title: this._getTitle(options.interactions.Split) || 'Split',\r\n      name: 'Split', \r\n      interaction: this._interactions.Split\r\n    });\r\n    this.addControl (split);\r\n  }\r\n\r\n  if (options.interactions.Offset !== false) {\r\n    if (options.interactions.Offset instanceof ol_interaction_Offset) {\r\n      this._interactions.Offset = options.interactions.Offset;\r\n    } else {\r\n      this._interactions.Offset = new ol_interaction_Offset ({\r\n          source: this._source\r\n      });\r\n    }\r\n    var offset = new ol_control_Toggle ({\r\n      html: '<i></i>',\r\n      className: 'ol-offset',\r\n      title: this._getTitle(options.interactions.Offset) || 'Offset',\r\n      name: 'Offset',\r\n      interaction: this._interactions.Offset\r\n    });\r\n    this.addControl (offset);\r\n  }\r\n\r\n};\r\n\r\nexport default ol_control_EditBar\r\n","import ol_source_Vector from 'ol/source/Vector'\r\n\r\n(function () {\r\n  var clear = ol_source_Vector.prototype.clear;\r\n\r\n  /** Overwrite ol/source/Vector clear to fire clearstart / clearend event\r\n   */\r\n  ol_source_Vector.prototype.clear = function(opt_fast) {\r\n    this.dispatchEvent({ type: 'clearstart' });\r\n    clear.call(this, opt_fast)\r\n    this.dispatchEvent({ type: 'clearend' });\r\n  };\r\n})();\r\n","import ol_ext_inherits from '../util/ext'\r\nimport ol_Collection from 'ol/Collection'\r\nimport ol_interaction_Interaction from 'ol/interaction/Interaction'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport {unByKey as ol_Observable_unByKey} from 'ol/Observable'\r\nimport '../source/Vector' \r\n\r\n/** Undo/redo interaction\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires undo\r\n * @fires redo\r\n * @fires change:add\r\n * @fires change:remove\r\n * @fires change:clear\r\n * @param {Object} options\r\n *  @param {number=} options.maxLength max undo stack length (0=Infinity), default Infinity\r\n */\r\nvar ol_interaction_UndoRedo = function(options) {\r\n  if (!options) options = {};\r\n\r\n\tol_interaction_Interaction.call(this, {\t\r\n    handleEvent: function() { \r\n      return true; \r\n    }\r\n  });\r\n\r\n  this._undoStack = new ol_Collection();\r\n  this._redoStack = new ol_Collection();\r\n  // Zero level stack\r\n  this._undo = [];\r\n  this._redo = [];\r\n  this._undoStack.on('add', function(e) {\r\n    if (e.element.level === undefined) {\r\n      e.element.level = this._level;\r\n      if (!e.element.level) {\r\n        e.element.view = {\r\n          center: this.getMap().getView().getCenter(),\r\n          zoom: this.getMap().getView().getZoom()\r\n        };\r\n        this._undo.push(e.element);\r\n      }\r\n    } else {\r\n      if (!e.element.level) this._undo.push(this._redo.shift());\r\n    }\r\n    if (!e.element.level) {\r\n      this.dispatchEvent({ \r\n        type: 'stack:add', \r\n        action: e.element\r\n      });\r\n    }\r\n    this._reduce();\r\n  }.bind(this));\r\n  this._undoStack.on('remove', function(e) {\r\n    if (!e.element.level) {\r\n      if (this._doShift) {\r\n        this._undo.shift();\r\n      } else {\r\n        if (this._undo.length) this._redo.push(this._undo.pop());\r\n      }\r\n      if (!this._doClear) {\r\n        this.dispatchEvent({ \r\n          type: 'stack:remove', \r\n          action: e.element,\r\n          shift: this._doShift\r\n        });\r\n      }\r\n    }\r\n  }.bind(this));\r\n  // Block counter\r\n  this._block = 0;\r\n  this._level = 0;\r\n  // Shift an undo action ?\r\n  this._doShift = false;\r\n  // Start recording\r\n  this._record = true;\r\n  // Custom definitions\r\n  this._defs = {};\r\n};\r\nol_ext_inherits(ol_interaction_UndoRedo, ol_interaction_Interaction);\r\n\r\n/** Add a custom undo/redo\r\n * @param {string} action the action key name\r\n * @param {function} undoFn function called when undoing\r\n * @param {function} redoFn function called when redoing\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.define = function(action, undoFn, redoFn) {\r\n  this._defs[action] = { undo: undoFn, redo: redoFn };\r\n};\r\n\r\n/** Get first level undo / redo length\r\n * @param {string} [type] get redo stack length, default get undo\r\n * @return {number}\r\n */\r\nol_interaction_UndoRedo.prototype.length = function(type) {\r\n  return (type==='redo') ? this._redo.length : this._undo.length;\r\n};\r\n\r\n/** Set undo stack max length\r\n * @param {number} length\r\n */\r\nol_interaction_UndoRedo.prototype.setMaxLength = function(length) {\r\n  length = parseInt(length);\r\n  if (length && length<0) length = 0;\r\n  this.set('maxLength', length);\r\n  this._reduce();\r\n};\r\n\r\n/** Get undo / redo size (includes all block levels)\r\n * @param {string} [type] get redo stack length, default get undo\r\n * @return {number}\r\n */\r\nol_interaction_UndoRedo.prototype.size = function(type) {\r\n  return (type==='redo') ? this._redoStack.getLength() : this._undoStack.getLength();\r\n};\r\n\r\n/** Set undo stack max size\r\n * @param {number} size\r\n */\r\nol_interaction_UndoRedo.prototype.setMaxSize = function(size) {\r\n  size = parseInt(size);\r\n  if (size && size<0) size = 0;\r\n  this.set('maxSize', size);\r\n  this._reduce();\r\n};\r\n\r\n/** Reduce stack: shift undo to set size\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._reduce = function() {\r\n  if (this.get('maxLength')) {\r\n    while (this.length() > this.get('maxLength')) {\r\n      this.shift();\r\n    }\r\n  }\r\n  if (this.get('maxSize')) {\r\n    while (this.length() > 1 && this.size() > this.get('maxSize')) {\r\n      this.shift();\r\n    }\r\n  }\r\n};\r\n\r\n/** Get first level undo / redo first level stack\r\n * @param {string} [type] get redo stack, default get undo\r\n * @return {Array<*>}\r\n */\r\nol_interaction_UndoRedo.prototype.getStack = function(type) {\r\n  return (type==='redo') ? this._redo : this._undo;\r\n};\r\n\r\n/** Add a new custom undo/redo\r\n * @param {string} action the action key name\r\n * @param {any} prop an object that will be passed in the undo/redo functions of the action\r\n * @param {string} name action name\r\n * @return {boolean} true if the action is defined\r\n */\r\nol_interaction_UndoRedo.prototype.push = function(action, prop, name) {\r\n  if (this._defs[action]) {\r\n    this._undoStack.push({ \r\n      type: action,\r\n      name: name,\r\n      custom: true,\r\n      prop: prop \r\n    });\r\n    return true;\r\n  } else {\r\n    console.warn('[UndoRedoInteraction]: \"'+action+'\" is not defined.');\r\n    return false;\r\n  }\r\n};\r\n\r\n/** Remove undo action from the beginning of the stack. \r\n * The action is not returned.\r\n */\r\nol_interaction_UndoRedo.prototype.shift = function() {\r\n  this._doShift = true;\r\n  var a = this._undoStack.removeAt(0);\r\n  this._doShift = false;\r\n  // Remove all block\r\n  if (a.type==='blockstart') {\r\n    a = this._undoStack.item(0);\r\n    while (this._undoStack.getLength() && a.level>0) {\r\n      this._undoStack.removeAt(0);\r\n      a = this._undoStack.item(0);\r\n    }\r\n  }\r\n};\r\n\r\n/** Activate or deactivate the interaction, ie. records or not events on the map.\r\n * @param {boolean} active\r\n * @api stable\r\n */\r\nol_interaction_UndoRedo.prototype.setActive = function(active) {\r\n  ol_interaction_Interaction.prototype.setActive.call (this, active);\r\n  this._record = active;\r\n};\r\n\r\n/**\r\n * Remove the interaction from its current map, if any, and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_UndoRedo.prototype.setMap = function(map) {\r\n  if (this._mapListener) {\r\n    this._mapListener.forEach(function(l) { ol_Observable_unByKey(l); })\r\n  }\r\n  this._mapListener = [];\r\n  ol_interaction_Interaction.prototype.setMap.call (this, map);\r\n  // Watch blocks\r\n  if (map) {\r\n    this._mapListener.push(map.on('undoblockstart', this.blockStart.bind(this)));\r\n    this._mapListener.push(map.on('undoblockend', this.blockEnd.bind(this)));\r\n  }\r\n  // Watch sources\r\n  this._watchSources();\r\n  this._watchInteractions();\r\n};\r\n\r\n/** Watch for changes in the map sources\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._watchSources = function() {\r\n  var map = this.getMap();\r\n  // Clear listeners\r\n  if (this._sourceListener) {\r\n    this._sourceListener.forEach(function(l) { ol_Observable_unByKey(l); })\r\n  }\r\n  this._sourceListener = [];\r\n\r\n  // Ges vector layers \r\n  function getVectorLayers(layers, init) {\r\n    if (!init) init = [];\r\n    layers.forEach(function(l) {\r\n      if (l instanceof ol_layer_Vector) {\r\n        init.push(l);\r\n      } else if (l.getLayers) {\r\n        getVectorLayers(l.getLayers(), init);\r\n      }\r\n    });\r\n    return init;\r\n  }\r\n\r\n  if (map) {\r\n    // Watch the vector sources in the map \r\n    var vectors = getVectorLayers(map.getLayers());\r\n    vectors.forEach((function(l) {\r\n      var s = l.getSource();\r\n      this._sourceListener.push( s.on(['addfeature', 'removefeature'], this._onAddRemove.bind(this)) );\r\n      this._sourceListener.push( s.on('clearstart', function() {\r\n        this.blockStart('clear')\r\n      }.bind(this)));\r\n      this._sourceListener.push( s.on('clearend', this.blockEnd.bind(this)) );\r\n    }).bind(this));\r\n\r\n    // Watch new inserted/removed\r\n    this._sourceListener.push( map.getLayers().on(['add', 'remove'], this._watchSources.bind(this) ) );\r\n  }\r\n};\r\n\r\n/** Watch for interactions\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._watchInteractions = function() {\r\n  var map = this.getMap();\r\n  // Clear listeners\r\n  if (this._interactionListener) {\r\n    this._interactionListener.forEach(function(l) { ol_Observable_unByKey(l); })\r\n  }\r\n  this._interactionListener = [];\r\n\r\n  if (map) {\r\n    // Watch the interactions in the map \r\n    map.getInteractions().forEach((function(i) {\r\n      this._interactionListener.push(i.on(\r\n        ['setattributestart', 'modifystart', 'rotatestart', 'translatestart', 'scalestart', 'deletestart', 'deleteend', 'beforesplit', 'aftersplit'], \r\n        this._onInteraction.bind(this)\r\n      ));\r\n    }).bind(this));\r\n\r\n    // Watch new inserted / unwatch removed\r\n    this._interactionListener.push( map.getInteractions().on(\r\n      ['add', 'remove'], \r\n      this._watchInteractions.bind(this)\r\n    ));\r\n  }\r\n};\r\n\r\n/** A feature is added / removed\r\n */\r\nol_interaction_UndoRedo.prototype._onAddRemove = function(e) {\r\n  if (this._record) {\r\n    this._redoStack.clear();\r\n    this._redo.length = 0;\r\n    this._undoStack.push({\r\n      type: e.type, \r\n      source: e.target, \r\n      feature: e.feature\r\n    });\r\n  }\r\n};\r\n\r\n/** Perform an interaction\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._onInteraction = function(e) {\r\n  var fn = this._onInteraction[e.type];\r\n  if (fn) fn.call(this,e);\r\n};\r\n\r\n/** Set attribute\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._onInteraction.setattributestart = function(e) {\r\n  this.blockStart(e.target.get('name') || 'setattribute');\r\n  var newp = Object.assign({}, e.properties);\r\n  e.features.forEach(function(f) {\r\n    var oldp = {};\r\n    for (var p in newp) {\r\n      oldp[p] = f.get(p);\r\n    }\r\n    this._undoStack.push({\r\n      type: 'changeattribute', \r\n      feature: f,\r\n      newProperties: newp,\r\n      oldProperties: oldp\r\n    });\r\n  }.bind(this));\r\n  this.blockEnd();\r\n};\r\n\r\nol_interaction_UndoRedo.prototype._onInteraction.rotatestart = \r\nol_interaction_UndoRedo.prototype._onInteraction.translatestart = \r\nol_interaction_UndoRedo.prototype._onInteraction.scalestart = \r\nol_interaction_UndoRedo.prototype._onInteraction.modifystart = function (e) {\r\n  this.blockStart(e.type.replace(/start$/,''));\r\n  e.features.forEach(function(m) {\r\n    this._undoStack.push({ \r\n      type: 'changegeometry', \r\n      feature: m, \r\n      oldGeom: m.getGeometry().clone() \r\n    });\r\n  }.bind(this));\r\n  this.blockEnd();\r\n};\r\n\r\n/** Start an undo block\r\n * @param {string} [name] name f the action\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.blockStart = function (name) {\r\n  this._redoStack.clear();\r\n  this._redo.length = 0;\r\n  this._undoStack.push({ \r\n    type: 'blockstart', \r\n    name: name\r\n  });\r\n  this._level++;\r\n};\r\n\r\n/** @private\r\n */\r\nol_interaction_UndoRedo.prototype._onInteraction.beforesplit = function() {\r\n  this.blockStart('split');\r\n};\r\nol_interaction_UndoRedo.prototype._onInteraction.deletestart = function() {\r\n  this.blockStart('delete');\r\n}\r\n\r\n/** End an undo block\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.blockEnd = function () {\r\n  this._undoStack.push({ type: 'blockend' });\r\n  this._level--;\r\n};\r\n\r\n/** @private\r\n */\r\nol_interaction_UndoRedo.prototype._onInteraction.aftersplit =\r\nol_interaction_UndoRedo.prototype._onInteraction.deleteend =\r\nol_interaction_UndoRedo.prototype.blockEnd;\r\n\r\n/** handle undo/redo\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._handleDo = function(e, undo) {\r\n  // Not active\r\n  if (!this.getActive()) return;\r\n\r\n  // Stop recording while undoing\r\n  this._record = false;\r\n  if (e.custom) {\r\n    if (this._defs[e.type]) {\r\n      if (undo) this._defs[e.type].undo(e.prop);\r\n      else this._defs[e.type].redo(e.prop);\r\n    } else {\r\n      console.warn('[UndoRedoInteraction]: \"'+e.type+'\" is not defined.');\r\n    }\r\n  } else {\r\n    switch (e.type) {\r\n      case 'addfeature': {\r\n        if (undo) e.source.removeFeature(e.feature);\r\n        else e.source.addFeature(e.feature);\r\n        break;\r\n      }\r\n      case 'removefeature': {\r\n        if (undo) e.source.addFeature(e.feature);\r\n        else e.source.removeFeature(e.feature);\r\n        break;\r\n      }\r\n      case 'changegeometry': {\r\n        var geom = e.feature.getGeometry();\r\n        e.feature.setGeometry(e.oldGeom);\r\n        e.oldGeom = geom;\r\n        break;\r\n      }\r\n      case 'changeattribute': {\r\n        var newp = e.newProperties;\r\n        var oldp = e.oldProperties;\r\n        for (var p in oldp) {\r\n          if (oldp === undefined) e.feature.unset(p);\r\n          else e.feature.set(p, oldp[p]);\r\n        }\r\n        e.oldProperties = newp;\r\n        e.newProperties = oldp;\r\n        break;\r\n      }\r\n      case 'blockstart': {\r\n        this._block += undo ? -1 : 1;\r\n        break;\r\n      }\r\n      case 'blockend': {\r\n        this._block += undo ? 1 : -1;\r\n        break;\r\n      }\r\n      default: {\r\n        console.warn('[UndoRedoInteraction]: \"'+e.type+'\" is not defined.');\r\n      }\r\n    }\r\n  }\r\n\r\n  // Handle block\r\n  if (this._block<0) this._block = 0;\r\n  if (this._block) {\r\n    if (undo) this.undo();\r\n    else this.redo();\r\n  }\r\n  this._record = true;\r\n\r\n  // Dispatch event\r\n  this.dispatchEvent( { \r\n    type: undo ? 'undo' : 'redo',\r\n    action: e\r\n  });\r\n};\r\n\r\n/** Undo last operation\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.undo = function() {\r\n  var e = this._undoStack.item(this._undoStack.getLength() - 1);\r\n  if (!e) return;\r\n  this._redoStack.push(e);\r\n  this._undoStack.pop();\r\n  this._handleDo(e, true);\r\n};\r\n\r\n/** Redo last operation\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.redo = function() {\r\n  var e = this._redoStack.item(this._redoStack.getLength() - 1);\r\n  if (!e) return;\r\n  this._undoStack.push(e);\r\n  this._redoStack.pop();\r\n  this._handleDo(e, false);\r\n};\r\n\r\n/** Clear undo stack\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.clear = function() {\r\n  this._doClear = true;\r\n  this._undo.length = this._redo.length = 0;\r\n  this._undoStack.clear();\r\n  this._redoStack.clear();\r\n  this._doClear = false;\r\n  this.dispatchEvent({ type: 'stack:clear' });\r\n};\r\n\r\n/** Check if undo is avaliable\r\n * @return {number} the number of undo \r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.hasUndo = function() {\r\n  return this._undoStack.getLength();\r\n};\r\n\r\n/** Check if redo is avaliable\r\n * @return {number} the number of redo\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.hasRedo = function() {\r\n  return this._redoStack.getLength();\r\n};\r\n\r\nexport default ol_interaction_UndoRedo\r\n","/**\n * @module ol/Disposable\n */\n\n/**\n * @classdesc\n * Objects that need to clean up after themselves.\n */\nvar Disposable = function Disposable() {\n  /**\n   * The object has already been disposed.\n   * @type {boolean}\n   * @private\n   */\n  this.disposed_ = false;\n};\n\n/**\n * Clean up.\n */\nDisposable.prototype.dispose = function dispose () {\n  if (!this.disposed_) {\n    this.disposed_ = true;\n    this.disposeInternal();\n  }\n};\n\n/**\n * Extension point for disposable objects.\n * @protected\n */\nDisposable.prototype.disposeInternal = function disposeInternal () {};\n\nexport default Disposable;\n\n//# sourceMappingURL=Disposable.js.map","/**\n * @module ol/Collection\n */\nimport AssertionError from './AssertionError.js';\nimport CollectionEventType from './CollectionEventType.js';\nimport BaseObject from './Object.js';\nimport Event from './events/Event.js';\n\n\n/**\n * @enum {string}\n * @private\n */\nvar Property = {\n  LENGTH: 'length'\n};\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/Collection~Collection} instances are instances of this\n * type.\n */\nexport var CollectionEvent = /*@__PURE__*/(function (Event) {\n  function CollectionEvent(type, opt_element) {\n    Event.call(this, type);\n\n    /**\n     * The element that is added to or removed from the collection.\n     * @type {*}\n     * @api\n     */\n    this.element = opt_element;\n\n  }\n\n  if ( Event ) CollectionEvent.__proto__ = Event;\n  CollectionEvent.prototype = Object.create( Event && Event.prototype );\n  CollectionEvent.prototype.constructor = CollectionEvent;\n\n  return CollectionEvent;\n}(Event));\n\n\n/**\n * @typedef {Object} Options\n * @property {boolean} [unique=false] Disallow the same item from being added to\n * the collection twice.\n */\n\n/**\n * @classdesc\n * An expanded version of standard JS Array, adding convenience methods for\n * manipulation. Add and remove changes to the Collection trigger a Collection\n * event. Note that this does not cover changes to the objects _within_ the\n * Collection; they trigger events on the appropriate object, not on the\n * Collection as a whole.\n *\n * @fires CollectionEvent\n *\n * @template T\n * @api\n */\nvar Collection = /*@__PURE__*/(function (BaseObject) {\n  function Collection(opt_array, opt_options) {\n\n    BaseObject.call(this);\n\n    var options = opt_options || {};\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.unique_ = !!options.unique;\n\n    /**\n     * @private\n     * @type {!Array<T>}\n     */\n    this.array_ = opt_array ? opt_array : [];\n\n    if (this.unique_) {\n      for (var i = 0, ii = this.array_.length; i < ii; ++i) {\n        this.assertUnique_(this.array_[i], i);\n      }\n    }\n\n    this.updateLength_();\n\n  }\n\n  if ( BaseObject ) Collection.__proto__ = BaseObject;\n  Collection.prototype = Object.create( BaseObject && BaseObject.prototype );\n  Collection.prototype.constructor = Collection;\n\n  /**\n   * Remove all elements from the collection.\n   * @api\n   */\n  Collection.prototype.clear = function clear () {\n    while (this.getLength() > 0) {\n      this.pop();\n    }\n  };\n\n  /**\n   * Add elements to the collection.  This pushes each item in the provided array\n   * to the end of the collection.\n   * @param {!Array<T>} arr Array.\n   * @return {Collection<T>} This collection.\n   * @api\n   */\n  Collection.prototype.extend = function extend (arr) {\n    for (var i = 0, ii = arr.length; i < ii; ++i) {\n      this.push(arr[i]);\n    }\n    return this;\n  };\n\n  /**\n   * Iterate over each element, calling the provided callback.\n   * @param {function(T, number, Array<T>): *} f The function to call\n   *     for every element. This function takes 3 arguments (the element, the\n   *     index and the array). The return value is ignored.\n   * @api\n   */\n  Collection.prototype.forEach = function forEach (f) {\n    var array = this.array_;\n    for (var i = 0, ii = array.length; i < ii; ++i) {\n      f(array[i], i, array);\n    }\n  };\n\n  /**\n   * Get a reference to the underlying Array object. Warning: if the array\n   * is mutated, no events will be dispatched by the collection, and the\n   * collection's \"length\" property won't be in sync with the actual length\n   * of the array.\n   * @return {!Array<T>} Array.\n   * @api\n   */\n  Collection.prototype.getArray = function getArray () {\n    return this.array_;\n  };\n\n  /**\n   * Get the element at the provided index.\n   * @param {number} index Index.\n   * @return {T} Element.\n   * @api\n   */\n  Collection.prototype.item = function item (index) {\n    return this.array_[index];\n  };\n\n  /**\n   * Get the length of this collection.\n   * @return {number} The length of the array.\n   * @observable\n   * @api\n   */\n  Collection.prototype.getLength = function getLength () {\n    return this.get(Property.LENGTH);\n  };\n\n  /**\n   * Insert an element at the provided index.\n   * @param {number} index Index.\n   * @param {T} elem Element.\n   * @api\n   */\n  Collection.prototype.insertAt = function insertAt (index, elem) {\n    if (this.unique_) {\n      this.assertUnique_(elem);\n    }\n    this.array_.splice(index, 0, elem);\n    this.updateLength_();\n    this.dispatchEvent(\n      new CollectionEvent(CollectionEventType.ADD, elem));\n  };\n\n  /**\n   * Remove the last element of the collection and return it.\n   * Return `undefined` if the collection is empty.\n   * @return {T|undefined} Element.\n   * @api\n   */\n  Collection.prototype.pop = function pop () {\n    return this.removeAt(this.getLength() - 1);\n  };\n\n  /**\n   * Insert the provided element at the end of the collection.\n   * @param {T} elem Element.\n   * @return {number} New length of the collection.\n   * @api\n   */\n  Collection.prototype.push = function push (elem) {\n    if (this.unique_) {\n      this.assertUnique_(elem);\n    }\n    var n = this.getLength();\n    this.insertAt(n, elem);\n    return this.getLength();\n  };\n\n  /**\n   * Remove the first occurrence of an element from the collection.\n   * @param {T} elem Element.\n   * @return {T|undefined} The removed element or undefined if none found.\n   * @api\n   */\n  Collection.prototype.remove = function remove (elem) {\n    var arr = this.array_;\n    for (var i = 0, ii = arr.length; i < ii; ++i) {\n      if (arr[i] === elem) {\n        return this.removeAt(i);\n      }\n    }\n    return undefined;\n  };\n\n  /**\n   * Remove the element at the provided index and return it.\n   * Return `undefined` if the collection does not contain this index.\n   * @param {number} index Index.\n   * @return {T|undefined} Value.\n   * @api\n   */\n  Collection.prototype.removeAt = function removeAt (index) {\n    var prev = this.array_[index];\n    this.array_.splice(index, 1);\n    this.updateLength_();\n    this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE, prev));\n    return prev;\n  };\n\n  /**\n   * Set the element at the provided index.\n   * @param {number} index Index.\n   * @param {T} elem Element.\n   * @api\n   */\n  Collection.prototype.setAt = function setAt (index, elem) {\n    var n = this.getLength();\n    if (index < n) {\n      if (this.unique_) {\n        this.assertUnique_(elem, index);\n      }\n      var prev = this.array_[index];\n      this.array_[index] = elem;\n      this.dispatchEvent(\n        new CollectionEvent(CollectionEventType.REMOVE, prev));\n      this.dispatchEvent(\n        new CollectionEvent(CollectionEventType.ADD, elem));\n    } else {\n      for (var j = n; j < index; ++j) {\n        this.insertAt(j, undefined);\n      }\n      this.insertAt(index, elem);\n    }\n  };\n\n  /**\n   * @private\n   */\n  Collection.prototype.updateLength_ = function updateLength_ () {\n    this.set(Property.LENGTH, this.array_.length);\n  };\n\n  /**\n   * @private\n   * @param {T} elem Element.\n   * @param {number=} opt_except Optional index to ignore.\n   */\n  Collection.prototype.assertUnique_ = function assertUnique_ (elem, opt_except) {\n    for (var i = 0, ii = this.array_.length; i < ii; ++i) {\n      if (this.array_[i] === elem && i !== opt_except) {\n        throw new AssertionError(58);\n      }\n    }\n  };\n\n  return Collection;\n}(BaseObject));\n\n\nexport default Collection;\n\n//# sourceMappingURL=Collection.js.map","/*\tCopyright (c) 2016 Jean-Marc VIGLINO,\r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Control from 'ol/control/Control'\r\n\r\nimport ol_ext_element from '../util/element'\r\n\r\n/** A simple push button control\r\n * @constructor\r\n * @extends {ol_control_Control}\r\n * @param {Object=} options Control options.\r\n *  @param {String} options.className class of the control\r\n *  @param {String} options.title title of the control\r\n *  @param {String} options.name an optional name, default none\r\n *  @param {String} options.html html to insert in the control\r\n *  @param {function} options.handleClick callback when control is clicked (or use change:active event)\r\n */\r\nvar ol_control_Button = function(options){\r\n  options = options || {};\r\n\r\n  var element = document.createElement(\"div\");\r\n  element.className = (options.className || '') + \" ol-button ol-unselectable ol-control\";\r\n  var self = this;\r\n\r\n  var bt = this.button_ = document.createElement(/ol-text-button/.test(options.className) ? \"div\": \"button\");\r\n  bt.type = \"button\";\r\n  if (options.title) bt.title = options.title;\r\n  if (options.name) bt.name = options.name;\r\n  if (options.html instanceof Element) bt.appendChild(options.html)\r\n  else bt.innerHTML = options.html || \"\";\r\n  var evtFunction = function(e) {\r\n    if (e && e.preventDefault) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    if (options.handleClick) {\r\n      options.handleClick.call(self, e);\r\n    }\r\n  };\r\n  bt.addEventListener(\"click\", evtFunction);\r\n  bt.addEventListener(\"touchstart\", evtFunction);\r\n  element.appendChild(bt);\r\n\r\n  // Try to get a title in the button content\r\n  if (!options.title && bt.firstElementChild) {\r\n    bt.title = bt.firstElementChild.title;\r\n  }\r\n\r\n  ol_control_Control.call(this, {\r\n    element: element,\r\n    target: options.target\r\n  });\r\n\r\n  if (options.title) {\r\n    this.set(\"title\", options.title);\r\n  }\r\n  if (options.title) this.set(\"title\", options.title);\r\n  if (options.name) this.set(\"name\", options.name);\r\n};\r\nol_ext_inherits(ol_control_Button, ol_control_Control);\r\n\r\n/** Set the control visibility\r\n* @param {boolean} b \r\n*/\r\nol_control_Button.prototype.setVisible = function (val) {\r\n  if (val) ol_ext_element.show(this.element);\r\n  else ol_ext_element.hide(this.element);\r\n};\r\n\r\n/**\r\n * Set the button title\r\n * @param {string} title\r\n */\r\nol_control_Button.prototype.setTitle = function(title) {\r\n  this.button_.setAttribute('title', title);\r\n};\r\n\r\n/**\r\n * Set the button html\r\n * @param {string} html\r\n */\r\nol_control_Button.prototype.setHtml = function(html) {\r\n  ol_ext_element.setHTML (this.button_, html);\r\n};\r\n\r\n/**\r\n * Get the button element\r\n * @returns {Element}\r\n */\r\nol_control_Button.prototype.getButtonElement = function() {\r\n  return this.button_;\r\n};\r\n\r\nexport default ol_control_Button\r\n","/**\n * @module ol/ImageBase\n */\nimport {abstract} from './util.js';\nimport EventTarget from './events/Target.js';\nimport EventType from './events/EventType.js';\n\n/**\n * @abstract\n */\nvar ImageBase = /*@__PURE__*/(function (EventTarget) {\n  function ImageBase(extent, resolution, pixelRatio, state) {\n\n    EventTarget.call(this);\n\n    /**\n     * @protected\n     * @type {import(\"./extent.js\").Extent}\n     */\n    this.extent = extent;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.pixelRatio_ = pixelRatio;\n\n    /**\n     * @protected\n     * @type {number|undefined}\n     */\n    this.resolution = resolution;\n\n    /**\n     * @protected\n     * @type {import(\"./ImageState.js\").default}\n     */\n    this.state = state;\n\n  }\n\n  if ( EventTarget ) ImageBase.__proto__ = EventTarget;\n  ImageBase.prototype = Object.create( EventTarget && EventTarget.prototype );\n  ImageBase.prototype.constructor = ImageBase;\n\n  /**\n   * @protected\n   */\n  ImageBase.prototype.changed = function changed () {\n    this.dispatchEvent(EventType.CHANGE);\n  };\n\n  /**\n   * @return {import(\"./extent.js\").Extent} Extent.\n   */\n  ImageBase.prototype.getExtent = function getExtent () {\n    return this.extent;\n  };\n\n  /**\n   * @abstract\n   * @return {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} Image.\n   */\n  ImageBase.prototype.getImage = function getImage () {\n    return abstract();\n  };\n\n  /**\n   * @return {number} PixelRatio.\n   */\n  ImageBase.prototype.getPixelRatio = function getPixelRatio () {\n    return this.pixelRatio_;\n  };\n\n  /**\n   * @return {number} Resolution.\n   */\n  ImageBase.prototype.getResolution = function getResolution () {\n    return /** @type {number} */ (this.resolution);\n  };\n\n  /**\n   * @return {import(\"./ImageState.js\").default} State.\n   */\n  ImageBase.prototype.getState = function getState () {\n    return this.state;\n  };\n\n  /**\n   * Load not yet loaded URI.\n   * @abstract\n   */\n  ImageBase.prototype.load = function load () {\n    abstract();\n  };\n\n  return ImageBase;\n}(EventTarget));\n\n\nexport default ImageBase;\n\n//# sourceMappingURL=ImageBase.js.map","/**\n * @module ol/ImageCanvas\n */\nimport ImageBase from './ImageBase.js';\nimport ImageState from './ImageState.js';\n\n\n/**\n * A function that is called to trigger asynchronous canvas drawing.  It is\n * called with a \"done\" callback that should be called when drawing is done.\n * If any error occurs during drawing, the \"done\" callback should be called with\n * that error.\n *\n * @typedef {function(function(Error=))} Loader\n */\n\n\nvar ImageCanvas = /*@__PURE__*/(function (ImageBase) {\n  function ImageCanvas(extent, resolution, pixelRatio, canvas, opt_loader) {\n\n    var state = opt_loader !== undefined ? ImageState.IDLE : ImageState.LOADED;\n\n    ImageBase.call(this, extent, resolution, pixelRatio, state);\n\n    /**\n     * Optional canvas loader function.\n     * @type {?Loader}\n     * @private\n     */\n    this.loader_ = opt_loader !== undefined ? opt_loader : null;\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement}\n     */\n    this.canvas_ = canvas;\n\n    /**\n     * @private\n     * @type {Error}\n     */\n    this.error_ = null;\n\n  }\n\n  if ( ImageBase ) ImageCanvas.__proto__ = ImageBase;\n  ImageCanvas.prototype = Object.create( ImageBase && ImageBase.prototype );\n  ImageCanvas.prototype.constructor = ImageCanvas;\n\n  /**\n   * Get any error associated with asynchronous rendering.\n   * @return {Error} Any error that occurred during rendering.\n   */\n  ImageCanvas.prototype.getError = function getError () {\n    return this.error_;\n  };\n\n  /**\n   * Handle async drawing complete.\n   * @param {Error=} err Any error during drawing.\n   * @private\n   */\n  ImageCanvas.prototype.handleLoad_ = function handleLoad_ (err) {\n    if (err) {\n      this.error_ = err;\n      this.state = ImageState.ERROR;\n    } else {\n      this.state = ImageState.LOADED;\n    }\n    this.changed();\n  };\n\n  /**\n   * @inheritDoc\n   */\n  ImageCanvas.prototype.load = function load () {\n    if (this.state == ImageState.IDLE) {\n      this.state = ImageState.LOADING;\n      this.changed();\n      this.loader_(this.handleLoad_.bind(this));\n    }\n  };\n\n  /**\n   * @return {HTMLCanvasElement} Canvas element.\n   */\n  ImageCanvas.prototype.getImage = function getImage () {\n    return this.canvas_;\n  };\n\n  return ImageCanvas;\n}(ImageBase));\n\n\nexport default ImageCanvas;\n\n//# sourceMappingURL=ImageCanvas.js.map","/*\tCopyright (c) 2016 Jean-Marc VIGLINO,\r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Control from 'ol/control/Control'\r\n\r\n/** Control bar for OL3\r\n * The control bar is a container for other controls. It can be used to create toolbars.\r\n * Control bars can be nested and combined with ol.control.Toggle to handle activate/deactivate.\r\n * @class\r\n * @constructor\r\n * @extends ol_control_Control\r\n * @param {Object=} options Control options.\r\n *  @param {String} options.className class of the control\r\n *  @param {boolean} options.group is a group, default false\r\n *  @param {boolean} options.toggleOne only one toggle control is active at a time, default false\r\n *  @param {boolean} options.autoDeactivate used with subbar to deactivate all control when top level control deactivate, default false\r\n *  @param {Array<ol_control_Control> } options.controls a list of control to add to the bar\r\n */\r\nvar ol_control_Bar = function(options) {\r\n  if (!options) options={};\r\n  var element = document.createElement(\"div\");\r\n      element.classList.add('ol-unselectable', 'ol-control', 'ol-bar');\r\n  if (options.className) {\r\n    var classes = options.className.split(' ').filter(function(className) {\r\n      return className.length > 0;\r\n    });\r\n    element.classList.add.apply(element.classList, classes)\r\n  }\r\n  if (options.group) element.classList.add('ol-group');\r\n\r\n  ol_control_Control.call(this, {\r\n    element: element,\r\n    target: options.target\r\n  });\r\n\r\n  this.set('toggleOne', options.toggleOne);\r\n  this.set('autoDeactivate', options.autoDeactivate);\r\n\r\n  this.controls_ = [];\r\n  if (options.controls instanceof Array) {\r\n    for (var i=0; i<options.controls.length; i++) {\r\n      this.addControl(options.controls[i]);\r\n    }\r\n  }\r\n};\r\nol_ext_inherits(ol_control_Bar, ol_control_Control);\r\n\r\n/** Set the control visibility\r\n * @param {boolean} val\r\n */\r\nol_control_Bar.prototype.setVisible = function (val) {\r\n  if (val) this.element.style.display = '';\r\n  else this.element.style.display = 'none';\r\n}\r\n\r\n/** Get the control visibility\r\n * @return {boolean} b\r\n */\r\nol_control_Bar.prototype.getVisible = function () {\r\n  return this.element.style.display != 'none';\r\n}\r\n\r\n/**\r\n * Set the map instance the control is associated with\r\n * and add its controls associated to this map.\r\n * @param {ol_Map} map The map instance.\r\n */\r\nol_control_Bar.prototype.setMap = function (map) {\r\n  ol_control_Control.prototype.setMap.call(this, map);\r\n\r\n  for (var i=0; i<this.controls_.length; i++) {\r\n    var c = this.controls_[i];\r\n    // map.addControl(c);\r\n    c.setMap(map);\r\n  }\r\n};\r\n\r\n/** Get controls in the panel\r\n *\t@param {Array<ol_control_Control>}\r\n */\r\nol_control_Bar.prototype.getControls = function () {\r\n  return this.controls_;\r\n};\r\n\r\n/** Set tool bar position\r\n * @param {string} pos a combinaison of top|left|bottom|right\r\n */\r\nol_control_Bar.prototype.setPosition = function (pos) {\r\n  this.element.classList.remove('ol-left', 'ol-top', 'ol-bottom', 'ol-right');\r\n  pos = pos.split ('-');\r\n  for (var i=0; i<pos.length; i++) {\r\n    switch (pos[i]) {\r\n      case 'top':\r\n      case 'left':\r\n      case 'bottom':\r\n      case 'right':\r\n        this.element.classList.add(\"ol-\"+pos[i]);\r\n        break;\r\n      default: break;\r\n    }\r\n  }\r\n};\r\n\r\n/** Add a control to the bar\r\n *\t@param {ol_control_Control} c control to add\r\n */\r\nol_control_Bar.prototype.addControl = function (c) {\r\n  this.controls_.push(c);\r\n  c.setTarget(this.element);\r\n  if (this.getMap()) {\r\n    this.getMap().addControl(c);\r\n  }\r\n  // Activate and toogleOne\r\n  c.on ('change:active', function(e) { this.onActivateControl_(e, c); }.bind(this));\r\n  if (c.getActive) {\r\n    // c.dispatchEvent({ type:'change:active', key:'active', oldValue:false, active:true });\r\n    this.onActivateControl_({ target: c, active: c.getActive() }, c);\r\n  }\r\n};\r\n\r\n/** Deativate all controls in a bar\r\n * @param {ol_control_Control} [except] a control\r\n */\r\nol_control_Bar.prototype.deactivateControls = function (except) {\r\n  for (var i=0; i<this.controls_.length; i++) {\r\n  if (this.controls_[i] !== except && this.controls_[i].setActive) {\r\n      this.controls_[i].setActive(false);\r\n    }\r\n  }\r\n};\r\n\r\n/** Get active control in the bar\r\n * @returns {Array<ol_control_Control>}\r\n */\r\nol_control_Bar.prototype.getActiveControls = function () {\r\n  var active = [];\r\n  for (var i=0, c; c=this.controls_[i]; i++) {\r\n    if (c.getActive && c.getActive()) active.push(c);\r\n  }\r\n  return active;\r\n}\r\n\r\n/** Auto activate/deactivate controls in the bar\r\n * @param {boolean} b activate/deactivate\r\n */\r\nol_control_Bar.prototype.setActive = function (b) {\r\n  if (!b && this.get(\"autoDeactivate\")) {\r\n    this.deactivateControls();\r\n  }\r\n  if (b) {\r\n    var ctrls = this.getControls();\r\n    for (var i=0, sb; (sb = ctrls[i]); i++) {\r\n      if (sb.get(\"autoActivate\")) sb.setActive(true);\r\n    }\r\n  }\r\n}\r\n\r\n/** Post-process an activated/deactivated control\r\n *\t@param {ol.event} e :an object with a target {_ol_control_} and active flag {bool}\r\n */\r\nol_control_Bar.prototype.onActivateControl_ = function (e, ctrl) {\r\n  if (this.get('toggleOne')) {\r\n    if (e.active) {\r\n      var n;\r\n      //var ctrl = e.target;\r\n      for (n=0; n<this.controls_.length; n++) {\r\n        if (this.controls_[n]===ctrl) break;\r\n      }\r\n      // Not here!\r\n      if (n==this.controls_.length) return;\r\n      this.deactivateControls (this.controls_[n]);\r\n    } else {\r\n      // No one active > test auto activate\r\n      if (!this.getActiveControls().length) {\r\n        for (var i=0, c; c=this.controls_[i]; i++) {\r\n          if (c.get(\"autoActivate\")) {\r\n            c.setActive(true);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * @param {string} name of the control to search\r\n * @return {ol.control.Control}\r\n */\r\nol_control_Bar.prototype.getControlsByName = function(name) {\r\n  var controls = this.getControls();\r\n  return controls.filter(\r\n    function(control) {\r\n      return (control.get('name') === name);\r\n    }\r\n  );\r\n};\r\n\r\nexport default ol_control_Bar\r\n"],"sourceRoot":""}